---
title: 'Vue3 composition API ç ”ç©¶'
description: 'éƒ½å¯« Vue3 äº†é‚„èƒ½ä¸ç”¨ Composition API å—ï¼Ÿè±ˆä¸æ˜¯å¾ˆè™§ï¼Ÿ'
pubDate: 'Jul 02 2023'
heroImage: '../../assets/images/vue.webp'
category: 'æŠ€è¡“'
tags: ['å‰ç«¯','JavaScript', 'Vue']
---


# Vue3 composition API ä»‹ç´¹

å»ºè­°é–±è®€: [https://cn.vuejs.org/guide/introduction.html](https://cn.vuejs.org/guide/introduction.html)


## ä¸€ã€ åŸºæœ¬ä»‹ç´¹

### 1-1. ç”šéº¼æ˜¯ composition api ?

Composition API æ˜¯ Vue 3 ä¸­å¼•å…¥çš„ä¸€ç¨®æ–°çš„ç·¨å¯«æ–¹æ³•ï¼Œå®ƒæä¾›äº†ä¸€ç¨®æ›´éˆæ´»ã€æ¨¡å¡ŠåŒ–çš„æ–¹å¼çµ„ç¹”å’Œé‡ç”¨çµ„ä»¶çš„é‚è¼¯ã€‚å‚³çµ±çš„ Vue 2.x ä½¿ç”¨ Options API ä¾†ç·¨å¯«çµ„ä»¶ï¼Œè€Œ Composition API çš„å¼•å…¥ä¸»è¦æ˜¯ç‚ºäº†è§£æ±ºåœ¨å¤§å‹æ‡‰ç”¨ä¸­çµ„ä»¶é‚è¼¯è®Šå¾—è¤‡é›œé›£ä»¥ç¶­è­·çš„å•é¡Œã€‚

### 1-2. **Composition API çš„ä¸»è¦ç‰¹é»ï¼š**

1. **`setup` å‡½æ•¸ ( æ›´éˆæ´»çš„å…¥å£é» )ï¼š** Composition API çš„æ ¸å¿ƒæ˜¯ **`setup`** å‡½æ•¸ï¼Œå®ƒå–ä»£äº† Vue 2.x ä¸­çš„ **`data`**ã€**`methods`**ã€**`computed`** ç­‰é¸é …ï¼Œä¸¦æä¾›äº†ä¸€å€‹æ›´éˆæ´»çš„å…¥å£é»ï¼Œç”¨æ–¼é…ç½®çµ„ä»¶çš„ç‹€æ…‹å’Œé‚è¼¯ã€‚
2. **æ›´ç›´è§€çš„ä»£ç¢¼çµ„ç¹”ï¼š** Composition API å…è¨±**å°‡ç›¸é—œçš„é‚è¼¯æŒ‰åŠŸèƒ½æˆ–ç‰¹æ€§é€²è¡Œçµ„ç¹”ä¸¦æ”¾åœ¨ä¸€èµ· (** è€Œ option api å‰‡ä¸è¡Œï¼Œå…¶å¿…é ˆä¾ data, methodsâ€¦ç­‰åˆ†é¡åˆ†é–‹æ”¾ç½® **)**ï¼Œå°‡å…¶æ”¾å…¥ **`setup`** å‡½æ•¸ä¸­ã€‚é€™ä½¿å¾—ä»£ç¢¼æ›´åŠ æ¸…æ™°å’Œå¯è®€ï¼Œä¸¦ä¸”æ›´å®¹æ˜“é€²è¡Œæ¨¡å¡ŠåŒ–çš„çµ„åˆã€‚
3. **æ¨¡å¡ŠåŒ–å’Œå¯é‡ç”¨ï¼š** Composition API æ”¯æŒå°‡çµ„ä»¶é‚è¼¯æ¨¡å¡ŠåŒ–ï¼Œå¯ä»¥æ›´è¼•é¬†åœ°æŠ½å–å’Œå…±ç”¨ä»£ç¢¼ç‰‡æ®µï¼Œé€™æœ‰åŠ©æ–¼æ¸›å°‘ä»£ç¢¼é‡è¤‡ä¸¦æé«˜ä»£ç¢¼çš„å¯ç¶­è­·æ€§ã€‚ ( å–ä»£ä¸¦è§£æ±ºåˆ° åŸ option api å¯«æ³•ä¸­ï¼Œå›  mixin å°è‡´å‘½åèˆ‡ç©ºé–“æ±™æŸ“ç­‰å•é¡Œ )
4. **æ›´å¥½çš„æ”¯æ´ TypeScriptï¼š** Composition API æä¾›äº†æ›´å¥½çš„æ”¯æ´ TypeScriptï¼Œèƒ½å¤ æ›´å®¹æ˜“åœ°æ¨æ–·å’Œæª¢æŸ¥é¡å‹ï¼Œé€™åœ¨å¤§å‹é …ç›®ä¸­å°¤ç‚ºé‡è¦ã€‚
5. **æ›´å¤šçš„ç”Ÿå‘½é€±æœŸï¼š** Composition API å¼•å…¥äº†æ›´å¤šçš„ç”Ÿå‘½é€±æœŸé‰¤å­ï¼Œå¦‚ **`onMounted`**ã€**`onUpdated`**ã€**`onBeforeUnmount`** ç­‰ï¼Œä½¿å¾—é–‹ç™¼è€…å¯ä»¥æ›´éˆæ´»åœ°è™•ç†çµ„ä»¶çš„ä¸åŒéšæ®µã€‚

### 1-3. **ç‚ºä»€éº¼ Vue 3 å¼•å…¥ Composition APIï¼š**

1. **è§£æ±ºä»£ç¢¼çµ„ç¹”å•é¡Œï¼š** åœ¨å¤§å‹æ‡‰ç”¨ä¸­ï¼Œçµ„ä»¶çš„é‚è¼¯è®Šå¾—è¤‡é›œï¼Œè€Œ Options API çš„æ–¹å¼å¯èƒ½å°è‡´ä»£ç¢¼çµ„ç¹”å›°é›£ï¼Œä½¿å¾—çµ„ä»¶é›£ä»¥ç†è§£å’Œç¶­è­·ã€‚
2. **æé«˜çµ„ä»¶çš„å¯é‡ç”¨æ€§å’Œæ¨¡å¡Šæ€§ï¼š** Composition API ä½¿å¾—çµ„ä»¶çš„é‚è¼¯å¯ä»¥æ›´å®¹æ˜“åœ°åˆ†é›¢å’Œé‡ç”¨ï¼Œé€™æœ‰åŠ©æ–¼æé«˜ä»£ç¢¼çš„æ¨¡å¡Šæ€§å’Œå¯ç¶­è­·æ€§ã€‚
3. **æ›´å¥½çš„æ”¯æ´ TypeScriptï¼š** Vue 3 çš„ Composition API æ›´å¥½çš„æ”¯æ´ TypeScript ï¼Œä½¿å¾—åœ¨å¤§å‹é …ç›®ä¸­ä½¿ç”¨ TypeScript æ›´ç‚ºæ–¹ä¾¿ã€‚
4. **è·Ÿéš¨ JavaScript ç”Ÿæ…‹ç³»çµ±çš„è¶¨å‹¢ï¼š** Composition API çš„è¨­è¨ˆæ›´ç¬¦åˆç¾ä»£ JavaScript ç”Ÿæ…‹ç³»çµ±çš„è¶¨å‹¢ï¼Œå°¤å…¶æ˜¯èˆ‡ React Hooks ç­‰ç›¸ä¼¼çš„æ¦‚å¿µã€‚

ç¸½çš„ä¾†èªªï¼ŒComposition API çš„å¼•å…¥ä½¿å¾— Vue æ›´é©åˆé–‹ç™¼å¤§å‹æ‡‰ç”¨ï¼Œæä¾›äº†æ›´å¼·å¤§ã€æ›´éˆæ´»çš„çµ„ä»¶ç·¨å¯«æ–¹å¼ï¼Œæœ‰åŠ©æ–¼æé«˜ä»£ç¢¼çš„å¯ç¶­è­·æ€§å’Œå¯è®€æ€§ã€‚

### 1-4. **ç›¸è¼ƒæ–¼ Option api, Composition API å¯«æ³•çš„ç¼ºé»ï¼š**

1. **å­¸ç¿’æ›²ç·šè¼ƒé«˜ï¼š** å°æ–¼å·²ç¶“ç¿’æ…£ Options API çš„é–‹ç™¼è€…ä¾†èªªï¼Œé©æ‡‰ Composition API å¯èƒ½éœ€è¦äº›è¨±çš„æ™‚é–“ï¼Œè€Œé›–èªªå…¶å¯«æ³•è¼ƒ Options API è‡ªç”± ( ä¸å†åˆ†é¡ data, methods, èˆ‡ç”Ÿå‘½é€±æœŸï¼Œå…¶å¯«æ³•æ›´åƒåŸç”Ÿçš„ js å¯«æ³• )ï¼Œä½†åŒæ™‚ä¹Ÿæ›´è¦æ±‚é–‹ç™¼è€…çš„åŸ¹é¤Šè‰¯å¥½çš„é–‹ç™¼ç¿’æ…£ï¼Œä»¥åŠå°æ–¼åŸç”Ÿ JavaScript æœ‰æ›´æ·±çš„æŒæ¡ã€‚
2. **éœ€è¦Vue 3ï¼š** Composition API åªåœ¨ Vue 3 ä¸­å¼•å…¥ï¼Œæ‰€ä»¥å¦‚æœé …ç›®ä»åœ¨ä½¿ç”¨ Vue 2ï¼Œå‰‡ç„¡æ³•ç›´æ¥ä½¿ç”¨ã€‚

### 1-5. è‹¥å¾ŒçºŒæœ‰éœ€è¦**éæ¸¡åˆ° React æœƒæ¯”è¼ƒå¥½ä¸Šæ‰‹:**

1. **ç›¸ä¼¼çš„èªæ³•ï¼š** Vue 3 Composition API çš„èªæ³•åœ¨æŸäº›æ–¹é¢èˆ‡ React Hooks ç›¸ä¼¼ï¼Œä¾‹å¦‚ **`useState`** å°æ‡‰æ–¼ **`reactive`** å’Œ **`ref`**ï¼Œ**`useEffect`** å°æ‡‰æ–¼ Vue 3 çš„ç”Ÿå‘½é€±æœŸé‰¤å­ã€‚
2. **React ç”Ÿæ…‹ç³»çµ±çš„å»£æ³›ä½¿ç”¨ï¼š** å¦‚æœä½ å·²ç¶“ç†Ÿæ‚‰ Vue 3 Composition APIï¼Œéæ¸¡åˆ° React æœƒç›¸å°å®¹æ˜“ï¼Œå› ç‚ºä½ å·²ç¶“ç­è§£äº†è¨±å¤šç›¸ä¼¼çš„æ¦‚å¿µã€‚
3. **æ›´å»£æ³›çš„è³‡æºå’Œç¤¾å€æ”¯æŒï¼š** React æ“æœ‰æ›´å¤§è¦æ¨¡çš„ç¤¾å€å’Œè±å¯Œçš„è³‡æºï¼Œé€™ä½¿å¾—åœ¨å­¸ç¿’å’Œä½¿ç”¨ React æ™‚èƒ½å¤ æ›´å®¹æ˜“æ‰¾åˆ°å¹«åŠ©å’Œè§£æ±ºå•é¡Œçš„è³‡æºã€‚

```jsx
// ä½¿ç”¨ React Hook

import React, { useState, useEffect } from 'react';

function ReactComponent() {
  const [message, setMessage] = useState("Hello from React!");
  const [count, setCount] = useState(0);

  const increment = () => {
    setCount(count + 1);
  };

  useEffect(() => {
    console.log("Component is mounted");
    return () => {
      console.log("Component will unmount");
    };
  }, []);

  return (
    <div>
      <p>{message}</p>
      <button onClick={increment}>Increment</button>
    </div>
  );
}

export default ReactComponent;
```

```jsx
// ä½¿ç”¨ Vue Compositon api
<template>
  <div>
    <p>{{ message }}</p>
    <button @click="increment">Increment</button>
  </div>
</template>

<script>
import { ref, onMounted, onBeforeUnmount } from 'vue';

export default {
  setup() {
    const message = ref("Hello from Vue!");
    const count = ref(0);

    const increment = () => {
      count.value++;
    };

    onMounted(() => {
      console.log("Component is mounted");
    });

    onBeforeUnmount(() => {
      console.log("Component will unmount");
    });

    return {
      message,
      increment,
    };
  },
};
</script>
```

## äºŒã€ æ ¸å¿ƒéŸ¿æ‡‰å¼èªæ³•ä»‹ç´¹

**å®˜ç¶²**: [https://vuejs.org/api/reactivity-core.html](https://vuejs.org/api/reactivity-core.html)

### 2-1. **ä½¿ç”¨ setup å–ä»£ Options API çµæ§‹**

 Composition API æ˜¯ç”¨ **`setup`** å‡½æ•¸å–ä»£æ‰åŸ  Vue 2.x ä¸­çš„ **`data`**ã€**`methods`**ã€**`computed`** ç­‰é¸é …ï¼Œè€Œå…¶å…§éƒ¨çš„å¯«æ³•æ›´åƒåŸç”Ÿçš„ JavaScript ä½¿å…¶æ›´éˆæ´»ï¼Œä¹Ÿè®“ç›¸é—œè¯å•†æ¥­é‚è¼¯ä»£ç¢¼èƒ½å¤ è¢«æ­¸é¡å†ä¸€èµ·

- setup ä¸­å«æœ‰å…©å€‹åƒæ•¸ï¼Œåˆ†åˆ¥æ˜¯ props èˆ‡ context
    - props é€šéçˆ¶å±¤çµ„ä»¶æ‰€å‚³å…¥çš„ç‰©ä»¶ï¼Œå…¶æ˜¯æ‰€æœ‰ prop è¿‘ä¾†å±¬æ€§çš„é›†åˆï¼Œæ¯å€‹ç‰©ä»¶å±¬æ€§å°±æ˜¯å…·é«”è¢«å‚³å…¥æ­¤çµ„ä»¶çš„å±¬æ€§èˆ‡å€¼
        
        ```jsx
        setup(props) {
          // ç›´æ¥ä½¿ç”¨æ•´å€‹ props å°è±¡
          console.log(props.propName);
        
          // æˆ–è€…ä½¿ç”¨è§£æ§‹è³¦å€¼æå–å–®ä¸€çš„å±¬æ€§
          const { propName } = props;
        }
        ```
        
    - context å…¶ç‚ºç‰©ä»¶åŠŸèƒ½ç‚ºæª¢è¦–è©²çµ„ä»¶ä¸Šä¸‹æ–‡çš„èƒ½åŠ›ï¼Œå…¶å…§éƒ¨æœ‰å››å€‹å±¬æ€§åˆ†åˆ¥ç‚º
        - emit: ( è¼ƒå¸¸ç”¨ ) åŒç‚º option api ä¸­çš„ emit åŠŸèƒ½ï¼Œç‚ºè‡ªè¨‚ä¸€äº‹ä»¶
            
            ```jsx
            export default {
              setup(props, { emit }) {
                const handleClick = () => {
                  // è§¸ç™¼ä¸€å€‹è‡ªå®šç¾©äº‹ä»¶ï¼Œé€šçŸ¥çˆ¶çµ„ä»¶
                  emit('customEvent', 'Hello from child!');
                };
            
                return {
                  handleClick,
                };
              },
            };
            ```
            
        - attrs: ä»£è¡¨æ­¤çµ„ä»¶ä¸­æœªè¢«åœ¨è©²çµ„ä»¶ä¸­è²æ˜ä¸¦ä½¿ç”¨åˆ°çš„ props æœƒåœ¨é€™é‚Š
            
            ```jsx
            <!-- MyComponent.vue -->
            <template>
              <div>
                {{ message }}
              </div>
            </template>
            
            <script>
            export default {
              props: {
                message: String,
                additionalProp: String,
              },
              setup(props, context) {
                // åœ¨é€™è£¡ï¼ŒadditionalProp å°±æœƒåŒ…å«åœ¨ context.attrs ä¸­
                console.log(context.attrs.additionalProp);
            
                return {
                  // ...
                };
              },
            };
            </script>
            ```
            
        - slots: ä»£è¡¨æ­¤çµ„ä»¶çš„æ‰€æœ‰æ’æ§½ï¼Œå¯ä»¥é€šéè©² å‘½åçš„å±¬æ€§æ‰¾åˆ°ç›¸é—œçš„æ’æ§½å…§å®¹
            
            ```jsx
            // çˆ¶çµ„ä»¶
            <!-- ParentComponent.vue -->
            <template>
              <div>
                <ChildComponent>
                  <!-- çˆ¶çµ„ä»¶æ’æ§½å…§å®¹ -->
                  <p>Content from parent</p>
                </ChildComponent>
              </div>
            </template>
            
            <script>
            import ChildComponent from './ChildComponent.vue';
            
            export default {
              components: {
                ChildComponent,
              },
            };
            </script>
            
            // å­çµ„ä»¶
            <!-- ChildComponent.vue -->
            <template>
              <div>
                <p>Child Component Content</p>
                <!-- å­çµ„ä»¶æ’æ§½ -->
                <slot></slot>
              </div>
            </template>
            
            <script>
            export default {
              setup(_, context) {
                // è¨ªå•çˆ¶çµ„ä»¶æ’æ§½çš„å…§å®¹
                const parentSlotContent = context.slots.default();
            
                return {
                  parentSlotContent,
                };
              },
            };
            </script>
            ```
            
        - expose: å…è¨±å‘çˆ¶çµ„ä»¶æš´éœ²æ­¤çµ„ä»¶çš„ data æˆ– methodsï¼Œæ–¹ä¾¿çˆ¶çµ„ä»¶ç›´æ¥èª¿ç”¨ ( è‹¥æ²’ç”¨ expose åœ¨ composition api  ä¸­ç„¡æ³•ç›´æ¥åœ¨çˆ¶å±¤ç”¨ ref ä¾†èª¿ç”¨å­å…ƒä»¶çš„æ–¹æ³• )
            
            ```jsx
            // å­å…ƒä»¶
            <!-- ChildComponent.vue -->
            <template>
              <div>
                <p>Internal Value: {{ internalValue }}</p>
                <button @click="increment">Increment in Child</button>
              </div>
            </template>
            
            <script setup>
            import { ref, defineExpose } from 'vue';
            
                const internalValue = ref(0);
            
                const increment = () => {
                  internalValue.value++;
                };
            
                // å°‡ increment æ–¹æ³•ç”¨ expose æš´éœ²ç»™çˆ¶ç»„ä»¶
            		defineExpose({ increment})
            
            </script>
            
            // çˆ¶å…ƒä»¶
            <!-- ParentComponent.vue -->
            <template>
              <div>
                <ChildComponent ref="childRef" />
                <button @click="callChildIncrement">Call Child Increment</button>
              </div>
            </template>
            
            <script>
            import { ref } from 'vue';
            
            import ChildComponent from './ChildComponent.vue';
            
            export default {
              components: {
                ChildComponent,
              },
              setup() {
                // è·å–å­ç»„ä»¶ instance çš„ ref
                const childRef = ref(null);
            
                // çˆ¶ç»„ä»¶èª¿ç”¨å­ç»„ä»¶ expose çš„ increment æ–¹æ³•
                const callChildIncrement = () => {
                  childRef.value.increment();
                };
            
                return {
                  childRef,
                  callChildIncrement,
                };
              },
            };
            </script>
            ```
            

**éœ€è¦æ³¨æ„:** 

- åœ¨setup ä¸­æ²’æœ‰ this
- æ‰€æœ‰çš„data èˆ‡ methods è¦èƒ½å¤ èˆ‡ template éŸ¿æ‡‰çš„è©±ï¼Œéƒ½å¿…é ˆè¦ return ï¼Œ
    - è€Œéœ€è¦åœ¨ template ä¸­ä½¿ç”¨çš„éŸ¿æ‡‰è³‡æ–™åœ¨å®šç¾©æ™‚æ˜¯ç”¨ ref() ( ref ä¹Ÿæœ‰é›™å‘ç¶å®šçš„æ•ˆæœ )ï¼Œè€Œ ref å®šç¾©çš„è®Šæ•¸åœ¨ setup ä¸­å…¶å®ƒå‡½å¼æˆ–ç”Ÿå‘½é€±æœŸåœ¨èª¿ç”¨è©²è®Šæ•¸æ™‚ï¼Œæ˜¯ç”¨ `è®Šæ•¸.value`

è£œå……: setup ç°¡å¯«æ–¹å¼

- å®˜ç¶² ( [https://vuejs.org/api/sfc-script-setup.html](https://vuejs.org/api/sfc-script-setup.html) )

```jsx
// setup åŸæœ¬å¯«æ³•
<script>
export default {
	setup(){
		const user = reactive({
      name: 'John',
      age: 25,
    });
		
		return {
			user
		}
	}
}
</script>

// setup çš„ç°¡å¯«æˆ
// é€™æ¨£å¯«æ³•ä¸‹ï¼Œå…¶å…§çš„æ‰€æœ‰å®£å‘Šçš„è®Šæ•¸æˆ–å‡½å¼é è¨­ç‚º returnï¼Œä¹Ÿå°±æ˜¯èªªä¸Šä¸‹å…©å€‹å¯«æ³•åŸ·è¡Œèµ·ä¾†ç›¸åŒ
<script setup>
	const user = reactive({
    name: 'John',
    age: 25,
  });
</script>
```

- ä½†éœ€è¦æ³¨æ„çš„æ˜¯åœ¨setup ç°¡å¯«çš„ç’°å¢ƒä¸‹ï¼ŒåŸå…ˆåœ¨ setup ä¸­çš„åƒæ•¸ props èˆ‡ context å¯«æ³•
    - Props çš„å–ç”¨æ–¹å¼: ä½¿ç”¨ defineProps()
        
        å®˜ç¶²: [https://cn.vuejs.org/guide/components/props.html](https://cn.vuejs.org/guide/components/props.html)
        
        ```jsx
        // ä½¿ç”¨ç‰©ä»¶å½¢å¼å¯ä»¥å®šç¾©è¡Œåˆ¥
        // defineProps æ˜¯ vue3 å…§å»ºçš„èªæ³•ä¸éœ€è¦å¼•å…¥ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨
        
        // å¯«æˆç‰©ä»¶å¯ä»¥å®šç¾©å‚³å…¥çš„å‹åˆ¥
        const props = defineProps({
          foo: String
        })
        
        // ä¹Ÿå¯å¯«æˆé™£åˆ—
        const props = defineProps(['foo'])
        
        // åœ¨ template ä¸­ä½¿ç”¨æ™‚å¯ä»¥ç”¨ props.foo æˆ–ç›´æ¥æ˜¯ foo
        // ä½†åœ¨ script ä¸­ä½¿ç”¨çš„è©±è¦ç”¨ props.foo ä¸èƒ½ç”¨ foo
        // å¦å¤– props æ˜¯åªè®€çš„
        ```
        
    - context å…§åŸæœ‰çš„åƒæ•¸ emit, expose, slots , attr å‰‡åˆ†åˆ¥è¢«æ‹†åˆ†
        
        ```jsx
        <script setup>
        // emit çš„å¯«æ³•ç¯„ä¾‹
        // å…ˆå®šç¾© emit
        const emit = defineEmits(['customEvent', 'delete'])
        
        const handleClick = () => {
          // æ­£å¸¸ä½¿ç”¨
          emit('customEvent', 'Hello from child!');
        };
        
        // expose å¯«æ³•
        
        import { ref } from 'vue'
        
        const a = 1
        const b = ref(2)
        
        defineExpose({
          a,
          b
        })
        
        // slots ä»¥åŠ attrs å–ç”¨çš„å¯«æ³•
        
        import { useSlots, useAttrs } from 'vue'
        
        const slots = useSlots()
        const attrs = useAttrs()
        </script>
        ```
        
    - emit çš„å¯«æ³•è£œå……
        
        å®˜ç¶²: [https://cn.vuejs.org/guide/components/events.html](https://cn.vuejs.org/guide/components/events.html)
        
        ```jsx
        // script ä¸­ scope æ²’å¯«åœ¨ä¸€èµ·
        export default {
          emits: ['inFocus', 'submit'], // emit çš„è²æ˜ä½ç½®
          setup(props, ctx) {
            ctx.emit('submit')
          }
        } 
        
        // script èˆ‡ setup å¯«åœ¨ä¸€èµ· ( <script setup> )
        <script setup>
        const emit = defineEmits(['inFocus', 'submit'])
        
        function buttonClick() {
          emit('submit')
        }
        </script>
        
        // åœ¨ template ä¸­è¢«ä½¿ç”¨ ç›´æ¥ç”¨ $emit
        <button @click="$emit('increaseBy', 1)">
          Increase by 1
        </button>
        ```
        
- è£œå…… å…ƒä»¶å±€éƒ¨æ›è¼‰ ( å±€éƒ¨è¨»å†Š ) å¯«æ³•
    
    å®˜ç¶²: [https://cn.vuejs.org/guide/components/registration.html](https://cn.vuejs.org/guide/components/registration.html)
    
    ```jsx
    // script ä¸­ scope æ²’å¯«åœ¨ä¸€èµ·
    import ComponentA from './ComponentA.js'
    
    export default {
      components: {
        ComponentA
      },
      setup() {
        // ...
      }
    }
    
    // script èˆ‡ setup å¯«åœ¨ä¸€èµ· ( <script setup> )
    import ComponentA from './ComponentA.js'
    
    export default {
      components: {
        ComponentA
      },
      setup() {
        // ...
      }
    }
    ```
    

### 2-2. **ä½¿ç”¨ reactive å®šç¾©éŸ¿æ‡‰å¼è³‡æ–™**

**è¨»: æ‰€è¬‚éŸ¿æ‡‰å¼ï¼Œå°±æ˜¯æŒ‡è©²è³‡æ–™è®ŠåŒ–æ™‚ï¼Œèˆ‡è©²è³‡æ–™é—œè¯çš„ç•«é¢æœƒä¸æœƒæ›´æ–°**

å› ç‚ºåœ¨ setup ä¸­ï¼Œæ’°å¯«åŸºæœ¬ä¸Šèˆ‡åŸç”Ÿ javaScript é›·åŒï¼Œè€Œåœ¨é€™é‚Šå®šç¾©èˆ‡å®£å‘Šçš„è³‡æ–™ç‚ºå–®å‘è³‡æ–™æµï¼Œå°±ç®—æ­¤æ™‚åœ¨ html çš„ Input  è¨­å®š v-model åšé€£çµï¼Œä¹Ÿæ˜¯ä¸æœƒç”¢ç”Ÿé›™å‘ç¶å®š 

- å› æ­¤è‹¥éœ€è¦é›™å‘ç¶å®šå°æ‡‰è³‡æ–™ï¼Œå‰‡è¦ç”¨ reactive æˆ–æ˜¯ ref ä¾†ç¶å®šè³‡æ–™ï¼Œref å› ç‚ºé™åˆ¶è¼ƒå°‘ï¼Œæ‰€ä»¥åœ¨å¯¦æˆ°ä¸­è¼ƒå¸¸ç”¨
- ä½¿ç”¨ Vue.reactive() å®šç¾©è³‡æ–™ï¼Œä½¿è©²å®£å‘Šè³‡æ–™ç‰©ä»¶è½‰æˆ proxy ç‰©ä»¶
    
    æ³¨æ„ : ä¹Ÿæ˜¯å› ç‚ºè½‰æ›æˆæ¨™æº–çš„proxyç‰©ä»¶ï¼Œå› æ­¤è™•ç†çš„åƒæ•¸(å°è±¡)**ä¹Ÿå¿…é ˆæ˜¯ç‰©ä»¶ï¼Œè‹¥å‚³å…¥ç´”å€¼æœƒå‡ºç¾éŒ¯èª¤**
    

- **ç¯„ä¾‹ç¨‹å¼ç¢¼**
    
    ```jsx
    
    <template>
      <div>
        <p>{{ user.name }} is {{ user.age }} years old.</p>
      </div>
    </template>
    
    <script>
    import { reactive } from 'vue'; // éœ€å…ˆè‡ª vue import é€²ä¾†
    
    export default {
      setup() {
        // åœ¨ setup å‡½æ•¸ä¸­ä½¿ç”¨ reactive å‰µå»ºéŸ¿æ‡‰å¼å°è±¡
        const user = reactive({
          name: 'John',
          age: 25,
        });
    
    		const updateAge = () => {
          // ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ user çš„å±¬æ€§
          user.age += 1;
        };
    
        return {
          user,
        };
      },
    };
    </script>
    
    ```
    

### 2-3. **ä½¿ç”¨ ref å®šç¾©éŸ¿æ‡‰å¼è³‡æ–™**

**è¨»: æ‰€è¬‚éŸ¿æ‡‰å¼ï¼Œå°±æ˜¯æŒ‡è©²è³‡æ–™è®ŠåŒ–æ™‚ï¼Œèˆ‡è©²è³‡æ–™é—œè¯çš„ç•«é¢æœƒä¸æœƒæ›´æ–°**

- åŠŸèƒ½: èˆ‡ reactive ç›¸ä¼¼ï¼Œéƒ½æ˜¯ç‚ºäº†ç”¨ä¾†é›™å‘ç¶å®šå°æ‡‰è³‡æ–™
- èˆ‡ reactive çš„å·®ç•°ï¼Œæ–¹æ³•å‚³å…¥çš„åƒæ•¸ä¸ä¸€å®šè¦æ˜¯ç‰©ä»¶ï¼Œå¯ä»¥æ˜¯**ç´”å€¼**ï¼Œ**ä¹Ÿå¯ä»¥æ˜¯ç‰©ä»¶ ( è‹¥æ˜¯å¤šå±¤ç‰©ä»¶ä¸€æ¨£ä¹Ÿå¯ä»¥é‹ä½œ )**
    
    è¨»: é›–èªªæœ‰äº›æ–‡ç« è¡¨ç¤º reactive ç”¨åœ¨è¤‡é›œçš„ç‰©ä»¶ä¸”æœ‰æ·±å±¤ç›£æ¸¬çš„æ•ˆæœï¼Œè€Œ ref å¤šç”¨åœ¨ç´”å€¼å¾—éŸ¿æ‡‰ä¸Šï¼Œä½†ç­†è€…å¯¦éš›æ¸¬è©¦ ref æ™‚ï¼Œå…¶ä¹Ÿæ˜¯èƒ½ç›£æ¸¬å·¢ç‹€ç‰©ä»¶ï¼Œè€Œåœ¨ Vue Mastery é‡å° ref çš„ä»‹ç´¹æœ‰ä¸€æ®µæ˜¯å¦‚æ­¤æ•˜è¿°çš„ â€˜â€™If an object is assigned as a ref's value, the object is made deeply reactive withÂ **[reactive()](https://vuejs.org/api/reactivity-core.html#reactive)**. This also means if the object contains nested refs, they will be deeply unwrapped. â€ ä¹Ÿä½è­‰äº†ç­†è€…çš„è§€é»
    
- ref æ–¹æ³•æ‰€å‚³å‡ºçš„ æ˜¯ RefImpl çš„ç‰©ä»¶ ( ä¸æ˜¯proxy )ï¼Œéœ€è¦åœ¨ setup ä¸­å–å…¶å€¼çš„è©±ï¼Œè¦ä½¿ç”¨ `ç‰©ä»¶.value` å–å‡º
    - è¨»: æ˜¯åœ¨ **æœªreturn** å‰å–å€¼çš„æ–¹å¼ï¼Œ**return å¾Œå°±æ˜¯æ­£å¸¸å–å¾—ç‰©ä»¶å€¼** ex: `ç‰©ä»¶.å±¬æ€§`
    
    ```jsx
    <script>
    import { ref } from 'vue';
    
    export default {
      setup() {
        // åœ¨ setup å‡½æ•¸ä¸­ä½¿ç”¨ ref å‰µå»ºéŸ¿æ‡‰å¼å°è±¡
    	const count = ref(0);
        
    		const addCount = () => {
    			// ref ä¿®æ”¹è¦ç”¨ .value æ‰èƒ½å–åˆ°å€¼
          coun.value++;
        };
    
        return {
    			count, 
    			addCount
        };
      },
    };
    </script>
    ```
    

### 2-4. ä½¿ç”¨ computed ä¾†å®šç¾©é—œè¯è³‡æ–™

- åŠŸèƒ½: èˆ‡ option api ä¸­çš„ computed åŠŸèƒ½ä¸€æ¨£ï¼Œå…¶åªèƒ½å›é¥‹ä¸€å€‹ readonly çš„è³‡æ–™ï¼Œä¸¦ä¸”æœƒä¾ç…§é—œè¯çš„è³‡æ–™éŸ¿æ‡‰è€Œæ”¹è®Š

ç”¨æ³•ç¯„ä¾‹å¦‚ä¸‹

```jsx
import { computed, onMounted } from 'vue';

export default {
  setup() {
	...
	const name = ref('Johnny')
	// ä½¿ç”¨ computed å…§åŒ…ä¸€å€‹ç‰©ä»¶ è£¡é¢æœ‰ get èˆ‡ set å±¬æ€§
	const personSaid = computed({
    get: ()=>`${name.value} say hi`,
    set:(val) => {
      name.value = val;
    }
  })

// è‹¥åªæœ‰ get å¯ä»¥å¯«æˆå¦‚ä¸‹å¯«æ³•
// const personSaid = computed(()=>`${name.value} say hi`)
	
		onMounted(() => {
		console.log(personSaid.value) // Johnny say hi
      name.value = 'wilson'
      console.log(name.value) // wilson
      personSaid.value ='Nike'
      console.log(name.value) // Nike
      console.log(personSaid.value) // Nike say hi
	})
}
```

### 2-5. ä½¿ç”¨ readonly ä¾†ç¢ºèªè³‡æ–™ä¸è¢«ä¿®æ”¹

åŠŸèƒ½: åœ¨æŸäº›æƒ…æ³ä¸‹ï¼Œæ¯”å¦‚ prop é€²ä¾†çš„æ•¸å€¼ä¸å¸Œæœ›è¢«å­çµ„ä»¶æ„å¤–ä¿®æ”¹ï¼Œæˆ–æ˜¯å…¨åŸŸå…±ç”¨çš„è³‡æ–™ä½ ä¸æƒ³å…¶è¢«æ„å¤–ä¿®æ”¹ï¼Œæ­¤æ™‚å°±èƒ½ä½¿ç”¨ readonly

```jsx
// çˆ¶ç»„ä»¶
import { readonly } from 'vue';

const data = readonly({ propValue: 'Hello' });
```

### 2-6. ä½¿ç”¨ watchEffect ä½œç‚ºç›£æ¸¬è³‡æ–™è®Šå‹•æ™‚è¡Œç‚ºçš„è¨­å®š

**åŠŸèƒ½:** æ­¤åŠŸèƒ½èˆ‡ React ä¸­çš„ useEffect å¾ˆåƒï¼Œåœ¨è©²å…ƒä»¶è¢«æ¸²æŸ“æˆ–æ˜¯å…¶å…§éƒ¨è³‡æ–™æœ‰è®Šå‹•æ™‚ï¼Œå…¶éƒ½æœƒè‡ªå‹•åŸ·è¡Œ

è¢«ç›£æ¸¬çš„æ•¸å€¼è¦æ±‚: è¦æ˜¯éŸ¿æ‡‰å¼çš„ ( å¦‚:  getter, ref, reactiveâ€¦etc. )

å…¶æœ‰å¹¾å€‹ç‰¹é»:

- åœ¨åˆæ¬¡è¼‰å…¥æ™‚å°±æœƒå…ˆåŸ·è¡Œä¸€æ¬¡å…§éƒ¨å‡½å¼çš„å…§å®¹
- å¯ä»¥æ·±å±¤ç›£è½æ•¸å€¼
- åªæœ‰åœ¨å…¶å‡½å¼å…§éƒ¨æœ‰ä½¿ç”¨åˆ°çš„å€¼æœ‰æ›´æ–°æ‰æœƒè¢«è§¸ç™¼
- watchEffect å¯ä»¥è¢«åœæ­¢
- watch èˆ‡ watchEffect() æ¯”è¼ƒ
    - watch åªèƒ½ç›£è½ç‰¹å®šè®Šæ•¸ ( watchEffect 1å€‹æˆ–å¤šå€‹ )
    - watch çš„åƒæ•¸æœƒå«å‰ä¸€æ¬¡çš„ä¿®æ”¹å€¼ ( watchEffect æ²’æœ‰ )

- **watchEffect( callback function, \{ flush: â€˜preâ€™  \} ) å…¶å…§å«å…©å€‹åƒæ•¸**
    1. callback function: åƒæ•¸ 1 æ˜¯ä¸€å€‹å‡½å¼ï¼Œå…¶å…§å®¹å¯ä»¥è‡ªè¨‚ï¼Œå…¶æœƒåœ¨è©²çµ„ä»¶è¢«é‡æ–°æ¸²æŸ“( å…§éƒ¨è¨­å®šçš„æ•¸å€¼æœ‰æ›´æ–°æ™‚ä¹Ÿæœƒè§¸ç™¼é‡æ–°æ¸²æŸ“ ) å‰æœƒåŸ·è¡Œ ( é è¨­æƒ…æ³ä¸‹ )
    2.  flush: åœ¨ç¬¬äºŒå€‹åƒæ•¸å…§ï¼Œå…¶ç‚ºç‰©ä»¶ä¸­çš„å…¶ä¸­ä¹‹ä¸€å€‹å±¬æ€§ï¼Œåœ¨é è¨­æƒ…æ³ä¸‹ï¼Œflush æ˜¯ â€˜preâ€™ ä»£è¡¨åœ¨çµ„ä»¶æ¸²æŸ“å‰åŸ·è¡Œï¼Œä½†ä¹Ÿå¯ä»¥è¨­å®šçµ„ä»¶æ¸²æŸ“å¾Œå†åŸ·è¡Œ â€˜postâ€™ã€‚å…¶é‚„æœ‰ä¸€å€‹å€¼æ˜¯ â€˜syncâ€™ ä»£è¡¨ç«‹å³åŸ·è¡Œï¼Œä½†ä½¿ç”¨ä¸Šéœ€è¦å°å¿ƒ (  å¯èƒ½æœƒæœ‰æ•ˆèƒ½ä»¥åŠè³‡æ–™ä¸€è‡´æ€§çš„å•é¡Œ )
    - **watchPostEffect()** ä¹Ÿå°±ç­‰æ–¼ watchEffect() åŠ ä¸Š flush: â€˜postâ€™ çš„è¨­å®š
    - **watchSyncEffect()** ä¹Ÿå°±ç­‰æ–¼ watchEffect() åŠ ä¸Š flush: â€˜syncâ€™ çš„è¨­å®š
    
    ```jsx
    // ç¯„ä¾‹
    const original = reactive({ count: 0 })
    
    const copy = readonly(original)
    
    watchEffect(() => {
      // works for reactivity tracking
      console.log(copy.count)
    })
    ```
    
    - watchEffect å¯ä»¥åœæ­¢ç›£è¦–
        - æ³¨æ„: å¿…é ˆå°‡ watchEffect **å…ˆè³¦å€¼åˆ°ä¸€å€‹è®Šæ•¸**ä¸Šï¼Œéœ€è¦åœæ­¢æ™‚å†ä½¿ç”¨è©²è®Šæ•¸ä½†ä¸å¸¶å…¥åƒæ•¸çš„æ–¹å¼åœæ­¢åŸ·è¡Œç›£è½
        - å› ç‚ºç•¶ watchEffect è¢«åŸ·è¡Œæ™‚ï¼Œå…¶å‡½å¼æœƒå›å‚³ä¸€å€‹åœæ­¢ç›£è½çš„å‡½å¼ï¼Œå› æ­¤ç•¶æˆ‘å€‘ä½¿ç”¨è®Šæ•¸æ¥æ­¤åœæ­¢ç›£è½çš„å‡½å¼ä¸¦åŸ·è¡Œæ™‚ï¼Œå…¶å°±æœƒåœæ­¢æ­¤ watchEffect çš„ç›£è½
        
        ```jsx
        let num = ref(1) // æ³¨æ„: é€™é‚Šè¦ç”¨ ref æˆ– reactive å¦å‰‡ watchEffect ç›£è½ä¸åˆ°
        
        setTimeout(()=>{
              console.log('æœ‰è¢«è§¸ç™¼1',  num.value)
              return num.value+=1
            } , 1000)
            setTimeout(()=>{
              console.log('æœ‰è¢«è§¸ç™¼2', num.value)
              return num.value+=1
            } , 2000)
            setTimeout(()=>{
              console.log('æœ‰è¢«è§¸ç™¼3',  num.value)
              return num.value+=1
            } , 3000)
        
        const stopWatchEffect = watchEffect(() => {
              console.log('watchEffect', num.value);
              if (num.value === 2) { // åŸ·è¡Œ ç›£è¦– 2 æ¬¡å°±åœæ­¢ç›£è¦–
                stopWatchEffect();
              }
            });
        
        // å›å‚³çµæœ
        // watchEffect  1 => åˆæ­¥æ¸²æŸ“æ™‚è§¸ç™¼
        // æœ‰è¢«è§¸ç™¼1 1
        // watchEffect  2 => è§€å¯Ÿåˆ° num è¢«æ”¹è®Šäº†
        // ç”±æ–¼ç­‰æ–¼ 2 å°±åœæ­¢ç›£è¦–äº† æ‰€ä»¥ä¸‹æ–¹ num è®Šæ›´å°±ä¸æœƒå†è§¸ç™¼ watchEffect äº†
        // æœ‰è¢«è§¸ç™¼2 2 
        // æœ‰è¢«è§¸ç™¼3 3 
        ```
        

### 2-7. ä½¿ç”¨ watch ç›£è¦–ç‰¹å®šæ•¸æ“š

åŠŸèƒ½: èˆ‡ option api åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯ç›£æ¸¬ç‰¹å®šå€¼çš„è®ŠåŒ–å†åŸ·è¡Œç‰¹å®šè¡Œç‚ºï¼Œä½†å¯«æ³•ä¸åŒ

è¢«ç›£æ¸¬çš„æ•¸å€¼è¦æ±‚: è¦æ˜¯éŸ¿æ‡‰å¼çš„ ( å¦‚:  getter, ref, reactiveâ€¦etc. )

- **watch( ) ä¸­æœ‰ä¸‰å€‹åƒæ•¸:**
    1. è¢«ç›£è¦–çš„å°è±¡
    2. åŸ·è¡Œçš„å‡½å¼ ( callback )
    3. ç‰©ä»¶æœ‰ä»¥ä¸‹ä¸‰å€‹å±¬æ€§
        1. immediate: åœ¨æ­¤ watcher åˆæ­¥å»ºç«‹æ™‚å°±æœƒè¢«è§¸ç™¼ ( èˆŠå€¼æœƒæ˜¯ undefined )
        2. deep: æ˜¯å¦è¦æ·±å±¤ç›£è¦–
        3. flush: callback è¢«åŸ·è¡Œçš„æ™‚æ©Ÿ ( å¦‚ watchEffectï¼Œæ¸²æŸ“å‰æˆ–æ¸²æŸ“å¾Œ )
- ç›¸è¼ƒæ–¼ watchEffectï¼Œwatch çš„ç‰¹æ€§
    - æ›´å°ˆæ³¨èˆ‡ç‰¹å®šå€¼çš„ç›£è½
    - åŒæ™‚æœ‰æ–°èˆŠå€¼å…©å€‹å€¼èƒ½å–å¾—

```jsx
// getter or éŸ¿æ‡‰å¼ç‰©ä»¶å…§å–®ä¸€å±¬æ€§
const state = reactive({ count: 0 })
watch(
  () => state.count,
  (count, prevCount) => {
    /* ... */
  }
)

// ç›£è¦–ç´”å€¼
const count = ref(0)
watch(count, (count, prevCount) => {
  /* ... */
})

// åŒæ™‚ç›£è¦–å¤šå€¼ï¼Œç”¨é™£åˆ— ( æˆ–ç”¨ watchEffect )
watch([fooRef, barRef], ([foo, bar], [prevFoo, prevBar]) => {
  /* ... */
})

// æ·±å±¤ç›£è¦–
const state = reactive({ count: 0 })
watch(
  () => state,
  (newValue, oldValue) => {
    // newValue === oldValue
  },
  { deep: true } // åŠ å…¥ deep: true
)
```

- watch å¯ä»¥åœæ­¢ç›£è¦– ( åŒ watchEffect )
    - æ³¨æ„: å¿…é ˆå°‡ watch **å…ˆè³¦å€¼åˆ°ä¸€å€‹è®Šæ•¸**ä¸Šï¼Œéœ€è¦åœæ­¢æ™‚å†ä½¿ç”¨è©²è®Šæ•¸ä½†ä¸å¸¶å…¥åƒæ•¸çš„æ–¹å¼åŸ·è¡Œåœæ­¢ç›£è½
    
    ```jsx
    let num = ref(1)
    
    setTimeout(()=>{
          console.log('æœ‰è¢«è§¸ç™¼1', num.value)
          return num.value+=1
        } , 100)
        setTimeout(()=>{
          console.log('æœ‰è¢«è§¸ç™¼2', num.value)
          return num.value+=1
        } , 2000)
        setTimeout(()=>{
          console.log('æœ‰è¢«è§¸ç™¼3', num.value)
          return num.value+=1
        } , 3000)
    
    const stopWatchEffect = watch(num, (newVal, oldVal) => {
    			// æ³¨æ„: åœ¨ watch å…§éƒ¨ ref å¸¶å…¥çš„åƒæ•¸ newVal, oldVal ä¸ç”¨å†ç”¨ val
    			// ä½†è‹¥æ˜¯ä¸ç”¨åƒæ•¸è€Œç›´æ¥ç”¨ num çš„è©±ï¼Œref å–å€¼ä»æ˜¯ä»¥ num.value
    			console.log('watch', 'newVal', newVal, 'oldVal' ,oldVal)
          if (newVal === 2) { // åŸ·è¡Œ ç›£è¦– 2 æ¬¡å°±åœæ­¢ç›£è¦–
            stopWatchEffect();
          }
        }, {immediate: true,});// æœ‰æ²’æœ‰ immediate çš„å·®ç•°åœ¨æ–¼å‰›è¼‰å…¥çµ„ä»¶æ™‚æ­¤ watch æ˜¯å¦è¢«è§¸ç™¼
    
    // watch newVal 1 oldVal undefined => åªæœ‰è¨­ immediate æ™‚æœƒåœ¨ä¸€é–‹å§‹å°±è§¸ç™¼
    // æœ‰è¢«è§¸ç™¼1 1
    // watch newVal 2 oldVal 1 => watch è¢«è§¸ç™¼
    // ç”±æ–¼ num.value ç­‰æ–¼ 2 åœæ­¢ç›£è¦–äº† æ‰€ä»¥ä¸‹æ–¹ num è®Šæ›´å°±ä¸æœƒå†è§¸ç™¼ watch äº†
    // æœ‰è¢«è§¸ç™¼2 2
    // æœ‰è¢«è§¸ç™¼3 3
    ```
    

## ä¸‰ã€å·¥å…·éŸ¿æ‡‰å¼èªæ³•ä»‹ç´¹

**å®˜ç¶²**: [https://vuejs.org/api/reactivity-core.html](https://vuejs.org/api/reactivity-utilities.html)

### 3-1. isRef()

ç¢ºèªè©²å€¼æ˜¯å¦æ˜¯ ref å€¼ï¼Œå›å‚³æ˜¯ boolean

```jsx
import { onMounted, isRef } from 'vue';

onMounted(()=>{
  console.log('isRef', isRef(num)) // isRef true
})
```

### 3-2. unref()

è‹¥åƒæ•¸æœ¬èº«æ˜¯ ref å‰‡è¿”å›å…¶ value å€¼ï¼Œè‹¥åƒæ•¸æœ¬èº«ä¸æ˜¯ ref å‰‡è¿”å›å…¶åƒæ•¸å€¼

åŒç­‰æ–¼ val = isRef(val) ? val.value : val

```jsx
import { onMounted, unref } from 'vue'

const num = ref(1)
const abc ='abc'

onMounted(()=>{
  console.log('unref ref', unref(num)) // unref ref  1
  console.log('unref not ref', unref(abc)) //  unref not ref abc

})
```

### 3-3. toRefs()

åŠŸèƒ½: å…¶å¯ä»¥å°‡éŸ¿æ‡‰å¼ ( reactive ) çš„ç‰©ä»¶ä¸­çš„æ¯å€‹å±¬æ€§éƒ½è½‰åŒ–ç‚º ref ç‰©ä»¶ ( è‹¥ä¸æ˜¯ reactive çš„ç‰©ä»¶å‰‡éœ€è¦è½‰æ›æˆ reactive å¾Œæ‰èƒ½ä½¿ç”¨ )

å…¶åŠŸèƒ½ç­‰æ–¼æ˜¯å°‡ reactive ä¸­æ¯å€‹å±¬æ€§éƒ½ç”¨ toRef() è™•ç†éä¸€æ¬¡

```jsx
import { ref, reactive, toRefs } from 'vue';

const person = {
      name: 'John',
      age: 30,
    };

// è‹¥è¦ä½¿ç”¨ toRef å¿…é ˆè½‰æ›æˆ reactive ç‰©ä»¶
const reactivePerson = reactive(person);

// ä½¿ç”¨ toRefsï¼Œè®“éŸ¿æ‡‰å¼ç‰©ä»¶å…§çš„å±¬æ€§éƒ½è®Šæˆ ref ç‰©ä»¶ï¼Œä½¿ç”¨è§£æ§‹å°‡ç‰©ä»¶è§£é–‹
 const { name, age } = toRefs(reactivePerson);

// ä¿®æ”¹å±æ€§å€¼
    const updatePerson = () => {
      name.value = 'Jane';
      age.value = 25;
    };
```

### 3-4. isProxy()

ç¢ºèªè©²ç›®æ¨™æ˜¯å¦ç‚º proxy ç‰©ä»¶ï¼Œå›å‚³ Boolean

è¨»: è‹¥æ˜¯ä»¥ **`[reactive()](https://vuejs.org/api/reactivity-core#reactive)`**,Â **`[readonly()](https://vuejs.org/api/reactivity-core#readonly)`**,Â **`[shallowReactive()](https://vuejs.org/api/reactivity-advanced#shallowreactive)`**Â orÂ **`[shallowReadonly()](https://vuejs.org/api/reactivity-advanced#shallowreadonly)`** å»ºç«‹å‡ºä¾†çš„å€¼éƒ½æ˜¯ Proxy ç‰©ä»¶

```jsx
import { onMounted, reactive, isProxy } from 'vue';

const person = reactive({
      name: 'John',
      age: 30,
 });

onMounted(()=>{
	console.log(isProxy(person))// true
})

```

### 3-5. isReactive()

ç¢ºèªè©²ç›®æ¨™æ˜¯å¦ç‚º**`[reactive()](https://vuejs.org/api/reactivity-core#reactive)`**Â orÂ **`[shallowReactive()](https://vuejs.org/api/reactivity-advanced#shallowreactive)`** å»ºç«‹çš„ proxy ç‰©ä»¶ï¼Œå›å‚³ Boolean

```jsx
import { onMounted, reactive,  isReactive} from 'vue';

const person = reactive({
      name: 'John',
      age: 30,
 });

onMounted(()=>{
	console.log(isReactive(person))// true
})
```

### 3-6. isReadonly()

ç¢ºèªè©²ç›®æ¨™æ˜¯å¦ç‚º readonly ç‰©ä»¶ï¼Œåœ¨ä»¥ä¸‹å¹¾å€‹ç‹€æ³å»ºç«‹çš„ proxy éƒ½æ˜¯ readonly ç‰©ä»¶

- è¢« **`[readonly()](https://vuejs.org/api/reactivity-core#readonly)`**Â andÂ **`[shallowReadonly()](https://vuejs.org/api/reactivity-advanced#shallowreadonly)`** å»ºç«‹çš„å°è±¡éƒ½æ˜¯
- `computed` æ²’æœ‰ set function ä¹Ÿæ˜¯

```jsx
import { onMounted, readonly, isReadonly} from 'vue';

const person = readonly({
      name: 'John',
      age: 30,
 });

onMounted(()=>{
	console.log(isReadonly(person))// true
})
```

### 3-7. toRef() ( vue 3.3+)

**è¨»: é€™æ˜¯ Vue 3.3 ç‰ˆæœ¬å¾Œæ‰æœ‰çš„åŠŸèƒ½**

toRef() æœƒè½‰è®Šå¸¶å…¥çš„æ™®é€šæ•¸å€¼ã€reactive æ•¸å€¼ï¼Œä¸¦**å›å‚³æˆä¸€å€‹ ref çš„æ•¸å€¼**

```jsx
// ç”¨ reactive object çµæœä¹Ÿæ˜¯ç›¸åŒçš„
const testToRef = {
  name: 'Kate'
}
const afterToRef = toRef(testToRef) // æ³¨æ„: æ˜¯å›å‚³ï¼Œæ‰€ä»¥è¦ç”¨è®Šæ•¸æ¥
console.log(isRef( afterToRef)) // true
console.log(isRef( testToRef)) // false
```

- å¦ä¸€ç¨®ç”¨æ³•: ä¹Ÿå¯ä»¥ç”¨ä¾†ä½œç‚ºç°¡åŒ–å·¢ç‹€ç‰©ä»¶çš„ç›®æ¨™å…§å®¹ï¼Œä¸”ä»ä¿æŒé›™å‘ç¶å®šçš„æ•ˆæœ

```jsx
// éå¸¸å·¢ç‹€çš„éŸ¿æ‡‰å¼ç‰©ä»¶
// reactive
const testToRef = reactive({
  name: 'Kate',
  layerOne: {
    name: 'John',
    layerTwo: {
      name: 'Tom',
      layerThree: {
        name: 'inner_child'
      }
    }
  },
})

// å–æœ€å…§å±¤çš„ name ä¸¦ç”¨ toRef åšæˆ ref
// æ­¤å€¼æœƒé›™å‘ç¶å®šåœ¨ testToRef æœ€å…§å±¤çš„ name
const afterToRef = toRef(testToRef.layerOne.layerTwo.layerThree, 'name') 
afterToRef.value ='changed_child' // åœ¨ ref æ”¹è®Šå€¼
console.log(testToRef.layerOne.layerTwo.layerThree.name) // 'changed_child' åŸ reactive ç‰©ä»¶å…§ä¹Ÿè¢«æ›´æ–°
testToRef.layerOne.layerTwo.layerThree.name ='shift_child'// ç›´æ¥åœ¨ reactive ç‰©ä»¶æ›´æ”¹å€¼
console.log(afterToRef.value) // 'shift_child' toRef å‡ºä¾†çš„ç‰©ä»¶ä¹Ÿè¢«æ›´æ–°

// è‹¥ç”¨ ref ä¹Ÿæ˜¯åŒæ¨£çš„æ•ˆæœ
const testToRef = ref({
  name: 'Kate',
  layerOne: {
    name: 'John',
    layerTwo: {
      name: 'Tom',
      layerThree: {
        name: 'inner_child'
      }
    }
  },
})
const afterToRef = toRef(testToRef.value.layerOne.layerTwo.layerThree, 'name')
afterToRef.value ='changed_child' // åœ¨ ref æ”¹è®Šå€¼
console.log(testToRef.value.layerOne.layerTwo.layerThree) // 'changed_child' åŸ ref ç‰©ä»¶å…§ä¹Ÿè¢«æ›´æ–°
testToRef.value.layerOne.layerTwo.layerThree.name ='shift_child'// ç›´æ¥åœ¨ ref ç‰©ä»¶æ›´æ”¹å€¼
console.log(afterToRef.value) // 'shift_child' toRef å‡ºä¾†çš„ç‰©ä»¶ä¹Ÿè¢«æ›´æ–°

// å–®ç´”ç‰©ä»¶ä¹Ÿå¯ä»¥
const testToRef ={
  name: 'Kate',
  layerOne: {
    name: 'John',
    layerTwo: {
      name: 'Tom',
      layerThree: {
        name: 'inner_child'
      }
    }
  },
}
const afterToRef = toRef(testToRef.layerOne.layerTwo.layerThree, 'name')
afterToRef.value ='changed_child' // åœ¨ ref æ”¹è®Šå€¼
console.log(testToRef.layerOne.layerTwo.layerThree) // 'changed_child' åŸç‰©ä»¶å…§ä¹Ÿè¢«æ›´æ–°
testToRef.layerOne.layerTwo.layerThree.name ='shift_child'// ç›´æ¥åœ¨ç‰©ä»¶æ›´æ”¹å€¼
console.log(afterToRef.value) // 'shift_child' toRef å‡ºä¾†çš„ç‰©ä»¶ä¹Ÿè¢«æ›´æ–°
```

### 3-8. toValue() ( vue 3.3+)

**è¨»: é€™æ˜¯ Vue 3.3 ç‰ˆæœ¬å¾Œæ‰æœ‰çš„åŠŸèƒ½**

åŠŸèƒ½æ˜¯å›å‚³ç´”å€¼ï¼Œå…¶èˆ‡ unref åŠŸèƒ½å¾ˆåƒï¼Œä½†åœ¨æ–¼ getter éƒ¨åˆ†çš„è§£æ³•ä¸ä¸€æ¨£ 

( ä½† ref èˆ‡ computed, unref èˆ‡ toValue éƒ½å¯ä»¥è§£ï¼Œreactive ä¸ç®¡å“ªä¸€å€‹éƒ½ä¸èƒ½è§£(æœƒè¿”å› proxy è€Œéç´”å€¼ ))

```jsx
const num = ref(2)
const testGetter = computed({
  get: () => num.value
})

	console.log('unref',  unref(testGetter)) // 2
  console.log('toValue', toValue(testGetter))//2
  num.value = 3 // ç•¶ computed æ”¹è®Šæ™‚å…©è€…éƒ½ä¸€æ¨£æœƒéŸ¿æ‡‰
  console.log('unref',  unref(testGetter)) //3
  console.log('toValue', toValue(testGetter)) //3

// ä½†ç”¨ getter æ¸¬è©¦
  console.log('unref',  unref(()=>4)) // ()=>4 
  console.log('toValue', toValue(()=>4)) //4 åªæœ‰ toValue å¯ä»¥è§£
```

## å››ã€é€²éšéŸ¿æ‡‰å¼èªæ³•ä»‹ç´¹

**å®˜ç¶²**: [https://vuejs.org/api/reactivity-advanced.html](https://vuejs.org/api/reactivity-advanced.html)

### 4-1. shallowRef()

èªªæ˜: ç›¸è¼ƒæ–¼ ref() çš„æ·±å±¤éŸ¿æ‡‰ï¼ŒshallowRef() åªèƒ½æ·ºå±¤ï¼Œæ‰€ä»¥ç›¸è¼ƒä¹‹ä¸‹çš„å½±éŸ¿æ˜¯

- ç‰©ä»¶å…§çš„å±¬æ€§å°±ç®—è¢«ä¿®æ”¹ä¹Ÿä¸æœƒè§¸ç™¼ç•«é¢é—œè¯çš„è³‡è¨Šæ›´æ–°
- æ‰€ä»¥åªæœ‰æ˜¯ç´”å€¼ï¼Œæˆ–æ˜¯ç‰©ä»¶çš„æ•´å€‹æŒ‡å‘åƒè€ƒè¢«æ”¹è®Š ( ç‰©ä»¶æ•´å€‹è¢«é‡æ–°è³¦å€¼ ) æ‰æœƒè§¸ç™¼ç•«é¢é—œè¯è³‡è¨Šçš„æ›´æ–°

é€šå¸¸æ˜¯ç”¨æ–¼å¤§å‹æ•¸æ“šçš„æ€§èƒ½å„ªåŒ– ( é¿å…è§¸ç™¼å¤ªå¤šæ¬¡ç•«é¢æ›´æ–°è€Œå½±éŸ¿æ•´é«”æ•ˆèƒ½ ) è€Œä½¿ç”¨

è£œå……: é€²éšé–±è®€ **[æŒ‡å— - å‡å°‘å¤§å‹ä¸å¯å˜ç»“æ„çš„å“åº”æ€§å¼€é”€](https://cn.vuejs.org/guide/best-practices/performance.html#reduce-reactivity-overhead-for-large-immutable-structures)**

```jsx
const state = shallowRef({ count: 1 })

// æ”¹è®Šç‰©ä»¶å…§çš„å±¬æ€§ä¸æœƒè§¸ç™¼ç•«é¢æ›´æ–°
state.value.count = 2

// æ”¹è®Šæ•´å€‹ç‰©ä»¶æŒ‡å‘ ( é‡æ–°è³¦å€¼ ) æœƒè§¸ç™¼ç•«é¢æ›´æ–°
state.value = { count: 2 }
```

### 4-2. triggerRef()

å¼·åˆ¶è§¸ç™¼ shallowRef() çš„å‰¯ä½œç”¨ ( æ¯”å¦‚å°æ–¼ shallowRef çš„å°è±¡ç‰©ä»¶é€²è¡Œå±¬æ€§ä¿®æ”¹ ) ä½¿å…¶å¼·åˆ¶è§¸ç™¼å°æ‡‰çš„ç•«é¢æ›´æ–°

```jsx
const shallow = shallowRef({
  greet: 'Hello, world'
})

 
watchEffect(() => {
  // ç¬¬ä¸€æ¬¡è§¸ç™¼æœƒåˆ—å° 'Hello, world'
	console.log(shallow.value.greet)
})

// ç”±æ–¼ shallowRef æ˜¯æ·ºå±¤éŸ¿æ‡‰ï¼Œå› æ­¤ç‰©ä»¶ä¿®æ”¹å±¬æ€§å€¼æœ¬ä¸è©²è§¸ç™¼ç•«é¢é—œè¯è³‡æ–™çš„æ›´æ–°
shallow.value.greet = 'Hello, universe'

// ä½¿ç”¨ triggerRef å¼·åˆ¶è§¸ç™¼æ·ºå±¤çš„ shallowRef æ›´æ–°
triggerRef(shallow) // å› æ­¤æœƒæ‰“å°å‡ºä¿®æ”¹å¾Œçš„ 'Hello, universe'
```

### 4-3. shallowReactive()

ç›¸å°æ–¼ reactive å°æ–¼ç‰©ä»¶çš„æ·±å±¤éŸ¿æ‡‰ï¼Œé€™æ˜¯ç›¸å°æ–¼æ­¤æ¦‚å¿µçš„æ·ºå±¤éŸ¿æ‡‰

ä½†éœ€è¦æ³¨æ„çš„æ˜¯: ç”±æ–¼ reactive æœ¬èº«å°±æ˜¯é‡å°ç‰©ä»¶çš„éŸ¿æ‡‰å¼å‡½å¼ï¼Œå› æ­¤å…¶æ‰€è¬‚çš„æ·ºå±¤éŸ¿æ‡‰æ˜¯æŒ‡è©²ç‰©ä»¶çš„ç¬¬ä¸€å±¤å±¬æ€§æ˜¯éŸ¿æ‡‰çš„ï¼Œå¾€ä¸‹å‰‡ä¸æ˜¯ ( ç›¸å°æ–¼ shallowRef å…¶æœ¬èº«åŸé‡å°ç´”å€¼ï¼Œæ‰€ä»¥æ·ºå±¤éŸ¿æ‡‰çš„ç¯„åœåœ¨æ–¼æ›¿æ›ç´”å€¼èˆ‡ç‰©ä»¶é‡æ–°çš„æŒ‡å‘ä¸åŒ )

é ˆå°å¿ƒä½¿ç”¨ï¼Œå› ç‚ºæ­¤å‡½å¼æœ‰ä¸ä¸€è‡´çš„éŸ¿æ‡‰å±¤ç´šèˆ‡å°æ‡‰çš„è¡Œç‚ºï¼Œå®¹æ˜“é€ æˆæ··æ·†

```jsx
const state = shallowReactive({
  foo: 1,
  nested: {
    bar: 2
  }
})

// æ›´æ”¹ reactive ç¬¬ä¸€å±¤æ•¸è¡Œå±¬æ–¼éŸ¿æ‡‰å¼çš„
state.foo++

// ä½†å¾€ä¸‹çš„å±¤ç´šå°±ä¸æ˜¯éŸ¿æ‡‰å¼çš„äº†
isReactive(state.nested) // false

// ç”±æ–¼ä¸æ˜¯éŸ¿æ‡‰å¼çš„æ‰€ä»¥å°æ‡‰çš„ç•«é¢ä¸æœƒæ›´æ–°
state.nested.bar++
```

### 4-4. shallowReadonly()

ç›¸å°æ–¼ readonly çš„æ·ºå±¤éŸ¿æ‡‰å‡½å¼

èˆ‡ shallowReactive çš„ç‹€æ³é›·åŒï¼Œå…¶é‡å°çš„æ˜¯ç‰©ä»¶çš„ç¬¬ä¸€å±¤å±¬æ€§ç‚º readonly ä½†ç¬¬äºŒå±¤ä»¥ä¸‹å°±ä¸æ˜¯

é ˆå°å¿ƒä½¿ç”¨ï¼Œå› ç‚ºæ­¤å‡½å¼æœ‰ä¸ä¸€è‡´çš„éŸ¿æ‡‰å±¤ç´šèˆ‡å°æ‡‰çš„è¡Œç‚ºï¼Œå®¹æ˜“é€ æˆæ··æ·†

```jsx
const state = shallowReadonly({
  foo: 1,
  nested: {
    bar: 2
  }
})

// ç¬¬ä¸€å±¤å±¬æ€§å› ç‚ºæ˜¯ readonly æ‰€ä»¥æ›´æ”¹æœƒå¤±æ•—
state.foo++

// ä½†æ˜¯å†å¾€ä¸‹ä¸€å±¤å°±ä¸æ˜¯ readonly äº†
isReadonly(state.nested) // false

// ç¬¬äºŒå±¤ä»¥ä¸‹å› ç‚ºä¸å†æ˜¯ readonly æ‰€ä»¥å¯ä»¥æ›´æ”¹
state.nested.bar++
```

### 4-5. toRaw()

å…¶å¯ä»¥è¿”å›ç”± reactive(), readonly(), shallowReactive(), shallowReadonly() ç•¶æ™‚å»ºç«‹æ™‚æ‰€å°æ‡‰çš„ä»£ç†å°è±¡

```jsx
const foo = {}
const reactiveFoo = reactive(foo)

console.log(toRaw(reactiveFoo) === foo) // true
```

### 4-6. **effectScope()**

å‰µå»ºä¸€å€‹ effect ä½œç”¨åŸŸï¼Œå…¶æœƒæ•æ‰å…¶å…§è¨­å®šçš„æ‰€æœ‰éŸ¿æ‡‰å¼è¡Œç‚º ( æ¯”å¦‚éŸ¿æ‡‰å¼å±¬æ€§èˆ‡ç›£è½å™¨ )ï¼Œå¦‚æ­¤æ–¹ä¾¿é€™äº›éŸ¿æ‡‰å¼è¡Œç‚ºä¸€èµ·è™•ç†ï¼Œæ¯”å¦‚ä¸€èµ·åœæ­¢éŸ¿æ‡‰å¼

```jsx
// template

	<button type='button' @click='addCounter' > counter åŠ  1 </button>

// script setup

const counter = ref(1)
scope.run(()=> {
  const doubled = computed(()=> counter.value*2)
  watch(doubled, ()=> console.log('watch',doubled.value))
  watchEffect(()=>console.log('counter.value' ,counter.value,'double.value', doubled.value))
})
const addCounter = function () {
  counter.value += 1
}

watchEffect(() => {
  if(counter.value >5){ // è¨­å®šåœæ­¢éŸ¿æ‡‰ & ç›£è½çš„æ¢ä»¶
    scope.stop() // ä¹‹å¾Œå°±ä¸æœƒæœ‰ scope å…§çš„ éŸ¿æ‡‰å¼èˆ‡ç›£è½è¡Œç‚º
  }
})

```

## äº”ã€Composition API çš„ç”Ÿå‘½é€±æœŸ

**å®˜ç¶²**: [https://vuejs.org/api/composition-api-lifecycle.html](https://vuejs.org/api/composition-api-lifecycle.html)

- ç›¸è¼ƒæ–¼option api  composition api åŠ å…¥ç”Ÿå‘½é€±æœŸåªè¦åœ¨è©²æ–¹æ³•å‰é¢æ–°å¢ **on** å°±è¡Œ
- ç‰¹è‰²:  åœ¨åŒå€‹ setup() ä¸­èƒ½å¤ æœ‰**å¤šå€‹ç›¸åŒçš„ç”Ÿå‘½é€±æœŸ** ex: onMounted *2 ä»¥ä¸Š

ä»¥ä¸‹åœ–è¡¨å–è‡ª: **[é‡æ–°èªè­˜ Vue.js | Kuro Hso](https://book.vue.tw/CH1/1-7-lifecycle.html)**

![https://i.imgur.com/JAaQy5d.jpg[/img]](https://i.imgur.com/JAaQy5d.jpg[/img])

### 5-1. setup

- ç›¸ç­‰æ–¼ option api ä¸­çš„  beforeCreate, created
- æ­¤éšæ®µçš„ Vue å¯¦é«”å‰›è¢«å»ºç«‹ï¼Œä½†å°šæœªæ›è¼‰ ( ä½†ç”±æ–¼ç‹€æ…‹èˆ‡äº‹ä»¶å·²åˆå§‹åŒ–ï¼Œæ‰€ä»¥å¯ä»¥å–åˆ° props, computed, dataâ€¦ )

```jsx
import { ref } from 'vue';

export default {
  setup() {
    const count = ref(0);

    return {
      count,
    };
  },
}
```

### 5-2. **`onBeforeMount` å’Œ `onMounted`**

- ç›¸ç­‰æ–¼ option api ä¸­çš„ beforeMount èˆ‡ mounted
- onBeforemount å°šæœªèˆ‡ DOM ç¶å®š
- onMounted çµ„ä»¶å·²æ›è¼‰åœ¨ DOM ä¸Š

```jsx
import { onBeforeMount, onMounted } from 'vue';

export default {
  setup() {
    onBeforeMount(() => {
      console.log('Component will mount soon');
    });

    onMounted(() => {
      console.log('Component is now mounted');
    });
  },
};
```

### 5-3. **`onBeforeUpdate` å’Œ `onUpdated`**

- ç›¸ç­‰æ–¼ option api ä¸­çš„ beforeUpdate èˆ‡ updated
- onBeforeUpdate åœ¨ç‹€æ…‹è¢«æ›´æ–°å‰è§¸ç™¼
- onUpdated åœ¨ç‹€æ…‹æ›´æ–°å¾Œè§¸ç™¼

```jsx
import { onBeforeUpdate, onUpdated } from 'vue';

export default {
  setup() {
    onBeforeUpdate(() => {
      console.log('Component will update soon');
    });

    onUpdated(() => {
      console.log('Component is updated');
    });
  },
};
```

### 5-4. **`onBeforeUnmount` å’Œ `onUnmounted`**

- ç›¸ç­‰æ–¼ option api ä¸­çš„  beforeUnmount, unmounted ( ä¹Ÿç­‰æ–¼ vue2 çš„ beforeDestroy, destroyed )
- onBeforeUnmount : åœ¨ Vue å¯¦é«”ç‰©ä»¶è¢«éŠ·æ¯€å‰
- onUnmounted: åœ¨ Vue å¯¦é«”ç‰©ä»¶è¢«éŠ·æ¯€å¾Œ

```jsx
import { onBeforeUnmount, onUnmounted } from 'vue';

export default {
  setup() {
    onBeforeUnmount(() => {
      console.log('Component will be unmounted soon');
    });

    onUnmounted(() => {
      console.log('Component is now unmounted');
    });
  },
};
```

## å…­ã€Composition API Injection å¯«æ³•

**å®˜ç¶²**: [https://vuejs.org/api/composition-api-dependency-injection.html](https://vuejs.org/api/composition-api-dependency-injection.html)

å®˜ç¶²: [https://cn.vuejs.org/guide/components/provide-inject.html](https://cn.vuejs.org/guide/components/provide-inject.html)

åŸºæœ¬ä¸Š Composition api ä¸­çš„ provide èˆ‡ inject èˆ‡ opsition api ä¸€æ¨£ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯èƒ½å¤ å¾å¤–å±¤å‚³åˆ°ç›®æ¨™å±¤ï¼Œä¹Ÿå°±æ˜¯èªªèƒ½å¤ å¤šå±¤å‚³é ( é™åˆ¶æ˜¯ä¸èƒ½å¹³è¡Œå‚³éï¼Œåªèƒ½ä¸Šä¸‹å‚³é )

![https://cn.vuejs.org/assets/provide-inject.3e0505e4.png](https://cn.vuejs.org/assets/provide-inject.3e0505e4.png)

- **Provide**
    - åœ¨å¤–å±¤å‚³éè³‡æ–™åˆ©ç”¨ provide å‚³éçµ¦æ‰€æœ‰å­å…ƒä»¶
    
    ```jsx
    import { provide } from 'vue';
    
    export default {
      setup() {
        const someData = 'Hello from parent!';
    		
    		// åƒæ•¸ 1:æ˜¯å­—ä¸²ä½œç‚º inject key
    		// åƒæ•¸ 2:æ˜¯å‚³å…¥å…§éƒ¨çš„è³‡æ–™
        provide('someKey', someData);
    
        return {};
      },
    };
    ```
    
- **Inject**
    - åœ¨å…§å±¤ç”¨ inject æ¥æ”¶ provide ä¾†çš„æ•¸æ“š
    
    ```jsx
    import { inject } from 'vue';
    
    export default {
      setup() {
    		// ä½¿ç”¨è®Šæ•¸å»æ¥ inject é€²ä¾†çš„è³‡æ–™
    		// inject çš„åƒæ•¸å¸¶èˆ‡ parent (å¤–å±¤) ç›¸åŒçš„ inject key
        const receivedData = inject('someKey');
    
        console.log(receivedData); // è¾“å‡ºï¼šHello from parent!
    
        return {};
      },
    };
    ```
    

## ä¸ƒã€çµ„åˆå¼å‡½æ•¸ ( Composables )

**å®˜ç¶²:** [https://cn.vuejs.org/guide/reusability/composables.html](https://cn.vuejs.org/guide/reusability/composables.html)

æ­¤ç« ç¯€çš„ç›®æ¨™æ˜¯ä»‹ç´¹ Composition API å¦‚ä½•é€éå°è£é‚è¼¯é”åˆ°æ›´å¥½çš„å…ƒä»¶æ¨¡çµ„åŒ–ä»¥åŠè¤‡ç”¨æ€§ï¼Œä»¥åŠèªªæ˜ç‚ºä½•ä½¿ç”¨ Composition API å¾Œå°±å¯ä»¥æ£„ç”¨ Option API ä¸­çš„ Mixins çš„ä¸»è¦åŸå› 

- composition api å¯ä»¥å»ºç«‹æœ‰ç‹€æ…‹ ( stateful ) çš„å…±ç”¨é‚è¼¯: åœ¨é–‹ç™¼å‰ç«¯ç¨‹å¼æ™‚ï¼Œæˆ‘å€‘æ™‚å¸¸æœƒå°‡å¸¸ç”¨çš„å·¥å…·é‚è¼¯æŠ½å–å‡ºä¾†ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç„¡ç‹€æ…‹ ( stateless ) é‚è¼¯çš„å‡½å¼åº« ( ex: loadsh, date-fnsâ€¦etc. ) ä¾†è¼”åŠ©é–‹ç™¼ç¨‹å¼ï¼Œè€Œæ­é… Vue3 çš„ composition api ä¹Ÿæ›´å®¹æ˜“å°‡æœ‰ç‹€æ…‹çš„å…±ç”¨é‚è¼¯æŠ½å–å‡ºä¾†ï¼Œä»¥å¢åŠ å‡½å¼çš„è¤‡ç”¨æ€§ä»¥åŠæ¨¡çµ„åŒ–æ›´ç‚ºæ–¹ä¾¿å¾ŒçºŒçš„ç¶­è­·èˆ‡ç®¡ç†ã€‚

 

<aside>
ğŸ’¡ Stateful logic ( æœ‰ç‹€æ…‹é‚è¼¯ ) & Stateless logic ( ç„¡ç‹€æ…‹é‚è¼¯ ) èªªæ˜:
1. **Stateful Logicï¼ˆæœ‰ç‹€æ…‹çš„é‚è¼¯ï¼‰:** 
   **** ä»£è¡¨è©²å‡½å¼å…§æœ‰ç›´æ¥å¼•ç”¨å¤–éƒ¨çš„è®Šæ•¸ï¼Œé€™äº›å¤–éƒ¨è®Šæ•¸å¯èƒ½åŒ…å«æœƒåœ¨å‡½å¼åŸ·è¡Œæ™‚ç”¢ç”Ÿè®ŠåŒ–ï¼Œé€²è€Œå½±éŸ¿å¤–éƒ¨è®Šæ•¸çš„å€¼èˆ‡ç‹€æ…‹ï¼Œè€Œé€™äº›æ‰€è¬‚çš„å¤–éƒ¨è®Šæ•¸é€šå¸¸æ˜¯ç”¨ä¾†è¿½è¹¤ç”¨æˆ¶è¡Œç‚º ( ex: è¼¸å…¥â€¦ )ã€ä½œç‚ºç³»çµ±è®Šé‡æˆ–è€…æ˜¯ç´€éŒ„ api è«‹æ±‚çµæœç­‰

    ****ç‰¹é» 1. åŸ·è¡Œéç¨‹ä¸­å¯èƒ½æœƒå°è‡´å¤–éƒ¨ç‹€æ…‹ ( è®Šæ•¸  ) 
    ç‰¹é» 2. è¨ˆç®—çµæœæœƒå› ç‚ºæ‰€ä¾è³´çš„å¤–éƒ¨è®Šæ•¸ç‹€æ…‹çš„æ”¹è®Šè€Œæ”¹è®Š
    ç‰¹é» 3. å› ç‚ºä»¥ä¸Šç‰¹æ€§æ‰€ä»¥æ›´å®¹æ˜“ç”¢ç”Ÿ side effect ( å‰¯ä½œç”¨ )

ex: 
let counter = 0 // å¤–éƒ¨è®Šæ•¸
function incrementCounter() \{
  counter++ // å¤–éƒ¨è®Šæ•¸è¢«æ”¹è®Šç‹€æ…‹
\}

2. **Stateless Logicï¼ˆç„¡ç‹€æ…‹çš„é‚è¼¯ï¼‰ï¼š**
   æ˜¯æŒ‡ä¸ä¾è³´å¤–éƒ¨è®Šæ•¸ï¼Œå…¶è¼¸å‡ºçµæœå®Œå…¨ç”±è¼¸å…¥çš„åƒæ•¸æ±ºå®šï¼Œè€Œé€™ç¨®å‡½å¼å› ç‚ºç›¸å°ç¨ç«‹ï¼Œä¸”ä¸ä¾é™„æ–¼å¤–éƒ¨çš„é‚è¼¯ï¼Œæ‰€ä»¥é€šå¸¸æ›´å®¹æ˜“æ¸¬è©¦èˆ‡æ¨¡çµ„åŒ–ä½œç‚ºå…±ç”¨çš„å·¥å…·é‚è¼¯
è¨»: ä½†ä¸¦ä¸æ˜¯èªªç„¡ç‹€æ…‹é‚è¼¯å°±ä¸èƒ½æ”¹è®Šå¤–éƒ¨è®Šæ•¸ï¼Œè‹¥ç›´æ¥å°‡å…¶è¼¸å‡ºçµæœåœ¨å‡½å¼å¤–éƒ¨ä½œç‚ºå¤–éƒ¨è®Šæ•¸çš„è³¦å€¼å…¶ä¹Ÿå¯ä»¥æ”¹è®Šå¤–éƒ¨è®Šæ•¸çš„ç‹€æ…‹ï¼Œå…¶å®šç¾©ç„¡ç‹€æ…‹é‚è¼¯çš„ç‰¹é»æ˜¯å…¶å‡½å¼å…§éƒ¨å®šç¾©ä¸¦**æ²’æœ‰ç›´æ¥ä½¿ç”¨åˆ°å¤–éƒ¨çš„è®Šæ•¸æ‰€ç‚ºé‚è¼¯è¨ˆç®—çš„éç¨‹**ï¼Œè€Œæ˜¯è—‰ç”±**åƒæ•¸çš„å‚³å…¥**èˆ‡å¤–éƒ¨ä½œç‚ºäº’å‹•ï¼Œä¹Ÿå› æ­¤è¼¸å‡ºçš„çµæœæ›´å®¹æ˜“è¢«æ¸¬è©¦èˆ‡é æ¸¬

****ç‰¹é» 1: å‡½å¼å…§éƒ¨å®šç¾©çš„é‚è¼¯ä¸ä¾è³´å¤–éƒ¨çš„è®Šæ•¸
ç‰¹é» 2: è¼¸å‡ºçš„çµæœå®Œå…¨ç”±å¸¶å…¥çš„åƒæ•¸è€Œå®š

****ex: 
function add(a, b) \{

  return a+b

**\}**

</aside>

<aside>
ğŸ’¡ **å‰¯ä½œç”¨ ( side effect ) ä»‹ç´¹**

æ‰€è¬‚çš„å‰¯ä½œç”¨æ˜¯æŒ‡è©²å‡½å¼çš„æ“ä½œå°æ–¼ç³»çµ±æˆ–å¤–éƒ¨è®Šæ•¸ç”¢ç”Ÿé æœŸå¤–çš„å½±éŸ¿ï¼Œå‰¯ä½œç”¨åŒ…å«ä½†ä¸é™æ–¼ä»¥ä¸‹æƒ…æ³
1. ä¿®æ”¹å¤–éƒ¨çš„è®Šæ•¸æˆ–ç‹€æ…‹
2. å°æ–¼å¤–éƒ¨çš„ç³»çµ±èª¿ç”¨ ( ex: ç¶²è·¯è«‹æ±‚ã€æ•¸æ“šåº«æ“ä½œ â€¦ )
3. è‹¥è©²å‡½å¼ç›´æ¥æ”¹è®Šå‚³å…¥çš„åƒæ•¸ ( å¦‚ç‰©ä»¶çš„å‚³åƒè€ƒç‰¹æ€§ )ï¼Œè€Œä¸æ˜¯å–®ç´”çš„ç”¢ç”Ÿä¸€å€‹æ–°å€¼ï¼Œé‚£ä¹Ÿè¢«èªå®šç‚ºæ˜¯æœ‰å‰¯ä½œç”¨çš„
4. å¯èƒ½å¼•ç™¼ç•°å¸¸: æ¯”å¦‚ç”¢ç”ŸéŒ¯èª¤æ™‚æ²’æœ‰åŠæ™‚æ•ç²ã€ç”¢ç”Ÿçš„å€¼å‹æ…‹ä¸å¦‚é æœŸ( null, undefined )è€Œæ²’æœ‰è¢«å¦¥å–„è™•ç†ï¼Œè€Œé€²è€Œç”¢ç”Ÿç¨‹å¼ä¸­æ–· éƒ½ç®—æ˜¯

</aside>

è€Œåœ¨ Option API ä¸­æœ‰å€‹ Mixins çš„åŠŸèƒ½èˆ‡æˆ‘å€‘å³å°‡ä»‹ç´¹çš„ composition api ä¸­æŠ½å‡ºå…±ç”¨é‚è¼¯çš„éƒ¨åˆ†ç›¸ä¼¼ï¼Œé›–ç„¶ Mixins å¯ä»¥å¾ˆå¥½çš„è¤‡ç”¨é‚è¼¯ä½†ä¹Ÿç”¢ç”Ÿäº†éé æœŸçš„å•é¡Œ
1. å…¨åŸŸè®Šæ•¸çš„æ±™æŸ“: Mixins çš„å•é¡Œæ˜¯ç•¶å¼•å…¥æ™‚æ˜¯æ•´åŒ…å¼•å…¥ï¼Œè€Œä¸èƒ½å–®ç´”åªå¼•å…¥æƒ³å¼•å…¥çš„ç›®æ¨™é‚è¼¯ï¼Œè€Œå°è‡´çš„å•é¡Œæ˜¯é€™äº›éç›®æ¨™çš„è®Šæ•¸èˆ‡å‡½å¼å¯èƒ½æœƒé€ æˆèˆ‡ç•¶å‰çµ„ä»¶çš„è®Šæ•¸åç¨±è¡çªæˆ–æ±™æŸ“ï¼Œä¸¦ç”¢ç”Ÿéé æœŸçš„çµæœ
2. å‘†æ¿åªèƒ½æ•´åŒ…å¼•å…¥: èˆ‡ composition api çš„å…±ç”¨é‚è¼¯ä¸åŒï¼Œå…¶ä¸èƒ½åªå–ç”¨éƒ¨åˆ†è€Œæ˜¯å¿…é ˆæ•´åŒ…å¼•å…¥ä¹Ÿæ¸›å°‘äº†è©²çµ„å…±ç”¨é‚è¼¯çš„è¤‡ç”¨æ€§

3.é™¤éŒ¯ä¸æ˜“: ç”±æ–¼ Mixins è™•æœƒåŒæ™‚å¼•å…¥éç›®æ¨™çš„é‚è¼¯ï¼Œå°è‡´å‡ºéŒ¯æ™‚å› è©²é‚è¼¯æˆ–è®Šæ•¸ä¸¦æ²’æœ‰ç›´æ¥åœ¨è©²çµ„ä»¶ä¸­è¢«å¼•ç”¨ï¼Œå› æ­¤åœ¨æŸ¥æ‰¾éŒ¯èª¤æ™‚æ›´ç‚ºä¸æ˜“ 

### 7-1. çµ„åˆå¼å‡½å¼ç¯„ä¾‹

7**-1-1. è‹¥æˆ‘å€‘éœ€è¦åœ¨ vue çµ„ä»¶æŠ½å‡ºä¸¦è¤‡ç”¨ä»¥ä¸‹æ»‘é¼ è¿½è¹¤åŠŸèƒ½çš„é‚è¼¯ï¼Œæˆ‘å€‘è¦æ€éº¼åšå‘¢ ?**

```jsx
// index.vue
<template>
...
	Mouse position is at: {{ x }}, {{ y }}
...
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
...
const x = ref(0)
const y = ref(0)
function update(event) {
  x.value = event.pageX
  y.value = event.pageY
}
...
onMounted(() => window.addEventListener('mousemove', update))
onUnmounted(() => window.removeEventListener('mousemove', update))
...
</script>

```

- æˆ‘å€‘å¯ä»¥ç›´æ¥å°‡è©²é‚è¼¯éƒ¨åˆ†é€²è¡ŒæŠ½å–æˆä¸€ä»½ js æ–‡ä»¶
    - è‹¥æ˜¯ä½¿ç”¨ nuxt åšç‚ºé–‹ç™¼çš„æ¡†æ¶ï¼Œæˆ‘å€‘å¯ä»¥åœ¨å¹³è¡Œæ–¼ pages çš„éšå±¤ä¸­ï¼Œæ‰¾åˆ° composables çš„è³‡æ–™å¤¾ï¼Œå…±ç”¨é‚è¼¯ä¸€èˆ¬éƒ½å­˜æ”¾åœ¨ä¸€èµ·
    
    ```jsx
    // mouse.js
    import { ref, onMounted, onUnmounted } from 'vue'
    
    // æŒ‰ç…§æƒ¯ä¾‹ï¼Œç»„åˆå¼å‡½å¼çš„å‘½åçš†ä»¥ â€œuseâ€ ä½œç‚ºé–‹é ­
    export function useMouse() {
      // è¢«ç»„åˆå¼å‡½å¼å°è£…å’Œç®¡ç†çš„ç‹€æ…‹
      const x = ref(0)
      const y = ref(0)
    
      // ç»„åˆå¼å‡½å¼çš„æ“ä½œé‚è¼¯ã€‚
      function update(event) {
        x.value = event.pageX
        y.value = event.pageY
      }
    
      // ä¹Ÿå¯ä»¥æ›è¼‰æˆ–å¸è¼‰ç”Ÿå‘½é€±æœŸ
      onMounted(() => window.addEventListener('mousemove', update))
      onUnmounted(() => window.removeEventListener('mousemove', update))
    
      // é€šè¿‡å›å‚³å€¼ä¾†å®šç¾©éœ€è¦å…±ç”¨çš„ç‹€æ…‹æˆ–å‡½å¼
      return { x, y }
    }
    ```
    
- ä»¥ä¸‹æ˜¯å…¶ä»–çµ„ä»¶æƒ³è¦ä½¿ç”¨æ­¤é‚è¼¯çš„æ–¹å¼
    
    ```jsx
    // example.vue
    
    <template>
    ....
    Mouse position is at: {{ x }}, {{ y }}
    ....
    </template>
    
    <script setup>
    import { useMouse } from './mouse.js'
    
    const { x, y } = useMouse() 
    // å› ç‚ºåœ¨å®šç¾©æ™‚ x èˆ‡ y éƒ½æ˜¯ ref éŸ¿æ‡‰å¼å®šç¾©ï¼Œå› æ­¤ç›´æ¥è§£æ§‹å‡ºä¾†ä»å¯ç¶­æŒæ­¤ç‰¹æ€§
    </script>
    ```
    

7**-1-2. è€Œåœ¨è¢«è¤‡ç”¨çš„é‚è¼¯ä¸­ä¹Ÿå¯ä»¥å¼•å…¥å…¶ä»–è¤‡ç”¨çš„é‚è¼¯ï¼Œå¯¦ç¾æ›´å°ä¸”åŠŸèƒ½æ›´æ¸…æ™°çš„æ¨¡çµ„åŒ–ï¼Œæ›´æ–¹ä¾¿çµ„ä»¶é–“çš„è¤‡ç”¨æ€§**

- èˆ‰ä¾‹ä¾†èªª: æˆ‘å€‘å¯ä»¥é‡å°ä¸Šè¿°çš„å…±ç”¨é‚è¼¯ç¯„ä¾‹ä¸­å†æŠ½å‡ºç”Ÿå‘½é€±æœŸ  ( é‡å° DOM ) çš„ç›£è½è¡Œç‚º
    
    ```jsx
    // event.js
    import { onMounted, onUnmounted } from 'vue'
    
    export function useEventListener(target, event, callback) {
      // å¦‚æœä½ æƒ³çš„è¯ï¼Œ
      // ä¹Ÿå¯ä»¥ç”¨å­—ç¬¦ä¸²å½¢å¼çš„ CSS é€‰æ‹©å™¨æ¥å¯»æ‰¾ç›®æ ‡ DOM å…ƒç´ 
      onMounted(() => target.addEventListener(event, callback))
      onUnmounted(() => target.removeEventListener(event, callback))
    }
    ```
    
- ç„¶å¾Œåœ¨åŸæœ¬çš„å…±ç”¨é‚è¼¯ mouse.js å°å…¥
    
    ```jsx
    // mouse.js
    import { ref } from 'vue'
    import { useEventListener } from './event' //è¢«æŠ½å‡ºçš„å…±ç”¨é‚è¼¯
    
    export function useMouse() {
      const x = ref(0)
      const y = ref(0)
    
    // event.js å®šç¾©çš„ useEventListener(target, event, callback)
      useEventListener(window, 'mousemove', (event) => {
        x.value = event.pageX
        y.value = event.pageY
      })
    
      return { x, y }
    }
    ```
    

<aside>
ğŸ’¡ åœ¨æ¯ä¸€å€‹çµ„ä»¶ä¸­ä½¿ç”¨å…±ç”¨é‚è¼¯å°å…¥çš„è®Šæ•¸ ( ex:  ç¯„ä¾‹ä¸­çš„ x, y ) å…¶ç‹€æ…‹ ( å€¼ ) ç‚ºè©²æ¨¡çµ„ç¨æœ‰ï¼Œä¸¦ä¸æœƒå› ç‚ºæ¨¡çµ„é–“å…±ç”¨é‚è¼¯è€Œäº’ç›¸å½±éŸ¿ ( è‹¥é ˆå…±äº«ç‹€æ…‹ï¼Œè«‹å¦å¤–ä½¿ç”¨ç‹€æ…‹ç®¡ç†å·¥å…· ex: Pinia, Vuexâ€¦etc. )

</aside>

### 7-2. ç•°æ­¥ç¨‹å¼ç¢¼æŠ½æˆå…±ç”¨é‚è¼¯ç¯„ä¾‹

7-2-1. ä½†è‹¥æˆ‘å€‘æƒ³è¦æŠ½å–æœƒè³¦å€¼çš„ç•°æ­¥ç¨‹å¼ç¢¼å…±ç”¨éƒ¨åˆ†å‘¢ ? åŸä»£ç¢¼å¦‚ä¸‹

```jsx
// index.vue
<script setup>
import { ref } from 'vue'

const data = ref(null)
const error = ref(null)

fetch('...')
  .then((res) => res.json())
  .then((json) => (data.value = json))
  .catch((err) => (error.value = err))
</script>

<template>
  <div v-if="error">Oops! Error encountered: {{ error.message }}</div>
  <div v-else-if="data">
    Data loaded:
    <pre>{{ data }}</pre>
  </div>
  <div v-else>Loading...</div>
</template>
```

- è‹¥æ¯æ¬¡è¦ç²å–è³‡æ–™éƒ½è¦å¢åŠ é€™äº›ç¨‹å¼ç¢¼ä¹Ÿæ˜¯å›°æ“¾ï¼Œæˆ‘å€‘å¯ä»¥æŠ½å‡ºå…±ç”¨éƒ¨åˆ†å¦‚ä¸‹

```jsx
// fetch.js
import { ref } from 'vue'

export function useFetch(url) {
  const data = ref(null)
  const error = ref(null)

  fetch(url)
    .then((res) => res.json())
    .then((json) => (data.value = json))
    .catch((err) => (error.value = err))

  return { data, error }
}
```

- æ¥ä¸‹ä¾†åœ¨å…¶ä»–çµ„ä»¶ä½¿ç”¨æ™‚å¯ä»¥ä»¥å¦‚ä¸‹æ–¹å¼å¼•å…¥

```jsx
// example.vue

<script setup>
import { useFetch } from './fetch.js'

const { data, error } = useFetch('...')
</script>
```

- è‹¥å¸Œæœ›å°‡æ­¤å…±ç”¨é‚è¼¯æ”¹æˆéŸ¿æ‡‰å¼çš„å‘¢ ? ç•¶å¸¶å…¥çš„åƒæ•¸ url æ”¹è®Šæ™‚ï¼Œå‰‡æœƒè‡ªå‹•åµæ¸¬ä¸¦é‡æ–°åŸ·è¡Œ ?

```jsx
// åœ¨åŸæœ¬çš„å…±ç”¨é‚è¼¯ fetch.js ä¸Šæ”¹æˆå¦‚ä¸‹

import { ref, watchEffect, toValue } from 'vue'

export function useFetch(url) {
  const data = ref(null)
  const error = ref(null)

  const fetchData = () => {
    // reset state before fetching..
    data.value = null
    error.value = null

		// unref æœƒå°‡ ref å±¬æ€§è½‰æˆç´”å€¼
    fetch(unref(url))
      .then((res) => res.json())
      .then((json) => (data.value = json))
      .catch((err) => (error.value = err))
  }

// watchEffect æœƒåµæ¸¬å…¶å…§éƒ¨å‡½å¼æ‰€å¸¶å…¥çš„åƒæ•¸æ”¹è®Šè€ŒåŸ·è¡Œ
  watchEffect(() => {
    fetchData()
  })

  return { data, error }
}
```

## å…«ã€å„ç¨®æ•¸æ“šå‚³éæ–¹å¼ä»‹ç´¹

### emit å¯«æ³•

- vue2 åœ¨å­çµ„ä»¶ä¸­çš„ v-on éƒ½æ˜¯è‡ªè¨‚äº‹ä»¶ï¼Œä¸¦é DOM çš„åŸç”Ÿäº‹ä»¶ï¼Œå› æ­¤è¦å®šç¾©æ¸…æ¥š ( ex: åœ¨å­çµ„ä»¶ä¸Šçš„ @click ä¸¦ä¸æ˜¯åŸç”Ÿ DOM çš„é»æ“Šäº‹ä»¶ï¼Œéœ€è¦è‡ªè¡Œå®šç¾© )ï¼Œé™¤éåŠ ä¸Š .native ä¿®é£¾
- vue3 åœ¨å­çµ„ä»¶çš„ v-on å¯ä»¥æ˜¯ DOM çš„åŸç”Ÿäº‹ä»¶ ( ex:@click å°±æ˜¯ DOM åŸç”Ÿçš„é»æ“Šäº‹ä»¶ )
    - event åœ¨ vue ä¸­å–çš„è£œå……
        
        åœ¨ template ä¸­ä½¿ç”¨è¦åŠ  $ å­—è™Ÿï¼Œ$event
        
        æ³¨æ„: event åƒæ•¸çš„å¯«æ³•
        
        ```jsx
        <template>
            <div class="login">
                <div class="login-content">
                    <div class="login-form login-item">
                        <p class="login-title">é›»é‡æ™ºèƒ½ç›£æ§</p>
                        <el-button type="primary"  @click="clickHandler(1,2,3, $event)">Primary</el-button>
                    </div>
                </div>
            </div>
        </template>
        
        <script lang='ts' setup>
        function clickHandler(a:number, b:number, c:number, $event):void{
            console.log(a, b,c, $event)
        }
        
        </script>
        ```
        

```jsx
// çˆ¶çµ„ä»¶
<template>
    <div class="login">
        <div class="login-content">
            <div class="login-form login-item">
                <p class="login-title">é›»é‡æ™ºèƒ½ç›£æ§</p>
                <!-- åŸç”Ÿ DOM äº‹ä»¶ -->
                <el-button type="primary"  @click="clickHandler(1,2,3, $event)">Primary</el-button>
                <!-- vue2 ä¸­å­çµ„ä»¶ç›´æ¥ç”¨ click ç‚ºè‡ªå®šç¾©äº‹ä»¶ï¼Œä½†å¯ä»¥é€šé .native ä¿®é£¾ç¬¦è®Šç‚ºåŸç”Ÿ DOM äº‹ä»¶ -->
                <!-- vue3 ä¸­ å­çµ„ä»¶ç›´æ¥ç”¨ click å³ç‚º åŸç”Ÿçš„ DOM äº‹ä»¶ ( ä»–æ˜¯æ›åœ¨è©²å­çµ„ä»¶çš„æ ¹ç¯€é»( root node ) ) -->
                <!-- ç¯„ä¾‹å¦‚ä¸‹ï¼Œç›´æ¥é»å³æœƒæœ‰ click äº‹ä»¶ç‚ºåŸç”Ÿçš„ DOM äº‹ä»¶ -->
                <Event @click="clickHandler(1,2,3, $event)" />
                <!-- vue3 çš„è‡ªå®šç¾©å¯«æ³• -->
                <Event2 @xxx='handler3' />
            </div>
        </div>
    </div>
</template>

<script lang='ts' setup>
import { reactive} from 'vue'

function clickHandler(a:number, b:number, c:number, $event):void{
    console.log(a, b,c, $event)
}

const handler3 = (param1: string)=>{
    console.log(param1 )
}

</script>
```

å­çµ„ä»¶

```jsx
//Event2

<template>
    <div class="son">
        <p>æˆ‘æ˜¯å­çµ„ä»¶ 2</p>
        <el-button type="primary"  @click="handler">é»æ“Šæˆ‘è§¸ç™¼å­çµ„ä»¶</el-button>
    </div>
</template>

<script lang="ts" setup>
// åˆ©ç”¨ defineEmits æ–¹æ³•ç›´æ¥è§¸ç™¼è‡ªå®šç¾©äº‹ä»¶
// defineEmits ä¸éœ€è¦å¼•å…¥ä½¿ç”¨

let $emit = defineEmits(['xxx'])

const handler = ()=>{
    // ç¬¬ä¸€å€‹åƒæ•¸: äº‹ä»¶çš„é¡å‹ï¼Œå…¶å¾Œéƒ½æ˜¯æ³¨å…¥çš„æ•¸æ“š
    $emit('xxx', 'é›„é¢¨é£›å½ˆ')
}

</script>

<style scoped>
.son{
    width: 400px;
    height: 400px;
    background: pink;
}
</style>
```

### v-model å¯¦ç¾çˆ¶å­æ•¸æ“šé›™å‘ç¶å®š

å¯ä»¥ç”¨ v-model ä¾†å¯¦ç¾çˆ¶å­çµ„ä»¶æ•¸æ“šçš„é›™å‘ç¶å®šï¼Œå› ç‚ºå…¶åŒæ™‚æ˜¯ props ä»¥åŠ update çš„ç°¡å¯«æ–¹å¼

```jsx
// çˆ¶çµ„ä»¶
<template>
    <div class="login">
        <h1>v-model</h1>
        <p>çˆ¶çµ„ä»¶éŒ¢æ•¸ {{money}}</p>
        <input type="text" v-model="info" />
        // props çˆ¶è¦ªçµ¦å…’å­çš„æ•¸æ“š
        // æ–¹æ³•ä¸€ 
        <child :modelValue="money" @update:modelValue="handler"/>
        // æ–¹æ³•äºŒ åªç”¨ v-model
        // ä¸Šä¸‹å…©å€‹æ–¹æ³•çµæœç›¸åŒ 
        // å› ç‚º v-model ä¹Ÿå°±åŒç­‰æ–¼ props[modelValue] ä»¥åŠç¶å®šäº† update:modelValue é€™å…©å€‹
        // æ³¨æ„ä¸Šæ–¹çš„åç¨±ä¸èƒ½æ›¿æ› 
        <child v-model="money"/>
        <hr />

				// çˆ¶å±¤å‚³éå¤šå€‹ v-model
        <p>çˆ¶å±¤ pageNo {{ pageNo }}</p>
        <p>çˆ¶å±¤ pageSize {{ pageSize }}</p>
        <!-- ç›¸ç•¶æ–¼çµ¦äº† child 2 props[pageNo, pageSize] ä»¥åŠ @update:pageNo å’Œ @update:pageSize -->
        <child2 v-model:pageNo="pageNo" v-model:pageSize="pageSize" />
    </div>
</template>

<script lang='ts' setup>
//  v-model ä¹Ÿå¯ä»¥å¯¦ç¾çˆ¶å­çµ„ä»¶çš„å³æ™‚é€šè¨Š
import child from './child.vue';
import child2 from './child2.vue';
import {ref} from 'vue';

let info = ref('')

//  çˆ¶çµ„ä»¶çš„æ•¸æ“š
let money = ref(10000);

//  è‡ªå®šç¾©äº‹ä»¶çš„å›èª¿
const handler =(num) => {
    // å°‡ä¾†æ¥å—å­çµ„ä»¶å‚³ééä¾†çš„æ•¸æ“š
    console.log(num)
    // çˆ¶æ›¾åˆ©ç”¨è‡ªå®šç¾©äº‹ä»¶çš„å›èª¿æ¥å—åŒæ­¥å­çµ„ä»¶çš„æ›´æ–°
    money.value =num
}

// child2 å¤šå€‹ v-model ç¯„ä¾‹

let pageNo = ref(1);
let pageSize = ref(3);

</script>
```

æ–¹æ³• 1 & 2 å°æ‡‰çš„å­çµ„ä»¶

```jsx
// child1

<template>
    <div class="son">
        <p>æˆ‘æ˜¯å­çµ„ä»¶</p>
        <p>å­çµ„ä»¶éŒ¢æ•¸{{modelValue}}</p>
        <el-button type="primary"  @click="handler">äº’å‹•</el-button>
    </div>
</template>

<script lang="ts" setup>
// æ¥æ”¶ props 
let props = defineProps(['modelValue']);
let $emit = defineEmits(['update:modelValue'])

const handler = () => {
    // è§¸ç™¼è‡ªå®šç¾©äº‹ä»¶
    // æ­¤å¯«æ³•è®Šå‹•æ˜¯åœ¨å­çµ„ä»¶
    $emit('update:modelValue', props.modelValue+1000)
}

</script>

<style scoped>
.son{
    width: 400px;
    height: 400px;
    background: skyblue;
}
</style>
```

å‚³éå¤šå€‹ v-model å°æ‡‰çš„å­çµ„ä»¶ç¯„ä¾‹

```jsx
// child2 

<template>
    <div class="son">
        <h1>åŒæ™‚ç¶å®šå¤šå€‹ v-model</h1>
        <p>æˆ‘æ˜¯å­çµ„ä»¶</p>
        <p>å­å±¤ pageNo {{ pageNo }}</p>
        <p>å­å±¤ pageSize {{ pageSize }}</p>

        <el-button type="primary"  @click="handler">pageNoäº’å‹•</el-button>
        <el-button type="secondary"  @click="handler2">pageSizeäº’å‹•</el-button>
    </div>
</template>

<script lang="ts" setup>
// æ¥æ”¶ props 
let props = defineProps(['pageNo', 'pageSize']);
let $emit = defineEmits(['update:pageNo', 'update:pageSize'])

const handler = () => {
    // è§¸ç™¼è‡ªå®šç¾©äº‹ä»¶
    // æ­¤å¯«æ³•è®Šå‹•æ˜¯åœ¨å­çµ„ä»¶
    $emit('update:pageNo', props.pageNo+1)
}
const handler2 = ()=> {
    $emit('update:pageSize', props.pageSize+1)
}

</script>

<style scoped>
.son{
    width: 400px;
    height: 400px;
    background: hotpink;
}
</style>
```

### useAttrs ç²å–çµ„ä»¶èº«ä¸Šçš„å±¬æ€§èˆ‡äº‹ä»¶

useAttrs å¯ä»¥å–å¾—çˆ¶çµ„ä»¶ä¸Šçš„å±¬æ€§èˆ‡äº‹ä»¶ ( æ–¹æ³• )ï¼Œä½†è‹¥æœ‰ props æ¥æ”¶åŒæ¨£çš„å±¬æ€§çš„è©± é‚£ useAttrs å°±æ‹¿ä¸åˆ°å°æ‡‰çš„å±¬æ€§

```jsx
// çˆ¶çµ„ä»¶ç¯„ä¾‹
<template>
    <div>
        <h1>useAttrs</h1>
        <el-button type="primary" size="small" :icon="Edit">Primary</el-button>
        <!-- è‡ªå®šç¾©çµ„ä»¶ -->
        <HintButton type="primary" size="small" :icon="Edit" title="ç·¨è¼¯æŒ‰éˆ•"></HintButton> 
    </div>
</template>

<script lang="ts" setup>
// vue3 æä¾›äº† useAttrs å¯ä»¥ç”¨ä¾†å–å¾—çµ„ä»¶å…§çš„å±¬æ€§ä»¥åŠæ–¹æ³•

// element-plus å…§éƒ¨çš„åœ–æ¨™çµ„ä»¶
import {
  Check,
  Delete,
  Edit,
  Message,
  Search,
  Star,
} from '@element-plus/icons-vue'

import HintButton from './HintButton.vue'

</script>
```

è‡ªå®šç¾©çµ„ä»¶å¯«æ³•ç¯„ä¾‹

```jsx
<template>
    <div :title="$attrs.title">
        <h1>è‡ªè¨‚çµ„ä»¶</h1> 
        <!-- <el-button :type="$attrs.type" :size="$attrs.size" :icon="$attrs.icon">è‡ªè¨‚çµ„ä»¶æŒ‰éˆ•</el-button> -->
        <!-- ä¸‹é¢é€™å¯«æ³•ç­‰æ–¼ a=1 b=2 -->
        <h2 :="{a:1, b:2}">123</h2>
        <!-- æ‰€ä»¥ä¸Šæ–¹ el-button çš„å¯«æ³•å°±å¯ä»¥ç¸®å¯«å¦‚ä¸‹ -->
        <el-button :="$attrs">è‡ªè¨‚çµ„ä»¶æŒ‰éˆ•</el-button>

    </div>
</template>

<script setup lang="ts">
// æ¥æ”¶çˆ¶çµ„ä»¶å‚³ééä¾†çš„æ•¸æ“š
// defineProps(['type', 'size', 'icon'])
// å¼•å…¥ useAttrs æ–¹æ³•:ç²å–çˆ¶çµ„ä»¶æ¨™ç±¤ä¸Šå±¬æ€§èˆ‡äº‹ä»¶(æ–¹æ³•)
import {useAttrs} from "vue"
console.log('useAttrs', useAttrs)
// æ­¤æ–¹æ³•åŸ·è¡Œæœƒè¿”å›ä¸€å€‹å°è±¡
let $attrs = useAttrs() // æ˜¯ Proxy Object
console.log('$attrs', $attrs)
// æ³¨æ„: $attrs åªæœƒæ‹¿åˆ°æ²’æœ‰ props é€²ä¾†çš„å±¬æ€§ï¼Œä¹Ÿå°±æ˜¯èªªæœ‰ props æ¥å—çš„è©± $attrs å°±æœƒæ‹¿ä¸åˆ°
</script>
```

### ref() èˆ‡ $parent

æ­é… defineExpose å°±å¯ä»¥

- åœ¨çˆ¶çµ„ä»¶ä¸­ä½¿ç”¨ ref() åœ¨çˆ¶çµ„ä»¶ä¸­æ‹¿åˆ°å­çµ„ä»¶å…§éƒ¨çš„å±¬æ€§èˆ‡æ–¹æ³•
- åœ¨å­çµ„ä»¶ä¸­ä½¿ç”¨ $parent å°±å¯ä»¥åœ¨å­çµ„ä»¶ä¸­å–å¾—çˆ¶çµ„ä»¶çš„å±¬æ€§èˆ‡æ–¹æ³•

```jsx
// çˆ¶çµ„ä»¶
<template>
    <div class="box">
        <h1>refèˆ‡$parent</h1>
        <h2>æˆ‘æ˜¯çˆ¶è¦ªå¤ªé™½ï¼Œæœ‰è³‡ç”¢ {{money}}</h2>
        <el-button type="warning" @click="handler">æˆ‘èˆ‡å…’å­ä¸ä¸å€Ÿ 10 å¡ŠéŒ¢</el-button>
        <hr />
				// Son æ˜¯ä½¿ç”¨ ref çš„ç¯„ä¾‹
        <Son ref="son" />
				// Dau æ˜¯ä½¿ç”¨ $parent çš„ç¯„ä¾‹
        <Dau ref="dau" />
    </div>
</template>

<script setup lang="ts">
//  ref: å¯ä»¥ç²å–åˆ°çœŸå¯¦ DOM çš„ç¯€é»ï¼Œä¸¦å¯ä»¥ç²å–åˆ°å­çµ„ä»¶çš„å¯¦ä¾‹ VC ( vue component )
// $parent: å¯ä»¥åœ¨å­çµ„ä»¶çš„å…§éƒ¨ç²å¾—çˆ¶çµ„ä»¶çš„å¯¦ä¾‹ VC

import {ref} from 'vue'
import Son from './son.vue'
import Dau from './Daughter.vue'
let money = ref(10000000);
// ç²å–å­çµ„ä»¶ vc
const son = ref()
const dau = ref()

// çˆ¶çµ„ä»¶æŒ‰éˆ•é»æ“Šå›èª¿
const handler = () => {
    money.value += 10
    console.log(son.value)
    // å…’å­çš„éŒ¢æ•¸æ¸›å» 10
    son.value.money -=10 
    son.value.fly()

}

// çˆ¶çµ„ä»¶å…§éƒ¨çš„å±¬æ€§ç²å–å°å¤–æ˜¯é—œé–‰çš„
// è‹¥è¦æš´éœ²ä¸€æ¨£è¦ç”¨ defineExpose

defineExpose({ money })
</script>

<style scoped>
.box {
    height: 500px;
    width: 500px;
    background: skyblue;
}

</style>
```

son å­çµ„ä»¶ ( æ­é… ref å–å­çµ„ä»¶å±¬æ€§ç¯„ä¾‹ )

```jsx
// son.vue
<template>
    <div class="son">
        <h2>æˆ‘æ˜¯å­çµ„ä»¶: ä¸ä¸ æœ‰è³‡ç”¢:{{money}}</h2>
    </div>
</template>

<script lang="ts" setup>
import {ref} from 'vue';

let money = ref(666)

const fly = () => {
    console.log('æˆ‘èµ·é£›äº†~')
}

// å­çµ„ä»¶å…§éƒ¨çš„æ•¸æ“šæ˜¯å°å¤–é—œé–‰çš„ï¼Œåˆ¥äººä¸èƒ½è¨ªå•
// å¦‚æœæƒ³è®“å¤–éƒ¨è¨ªå•éœ€è¦é€šé defineExpose æ–¹æ³•å°å¤–æš´éœ²
defineExpose({money, fly})

</script>

<style scoped>
.son{
    width: 400px;
    height: 200px;
    background: cyan;
}
</style>
```

dau å­çµ„ä»¶ ( æ­é… $parent ç¯„ä¾‹ )

```jsx
// Daughter.vue

<template>
    <div class="dau">
        <h2>æˆ‘æ˜¯é–¨å¥³: æ‹‰æ‹‰ æœ‰è³‡ç”¢:{{money}}</h2>
        <!-- $parent å¯ä»¥ç²å–åˆ°çˆ¶çµ„ä»¶çš„å…§éƒ¨è³‡æ–™ -->
        <el-button type="primary" @click="handler($parent)">é»æ“Šæˆ‘çˆ¸çˆ¸çµ¦æˆ‘ 10000 å…ƒ </el-button>
    </div>
</template>

<script lang="ts" setup>
import {ref} from 'vue';

let money = ref(9999999)

const fly = () => {
    console.log('æˆ‘è¿«é™äº†~')
}

const handler = ($parent) => {
    money.value +=10000;
    console.log('$parent', $parent)
    console.log('$parent.money', $parent.money)
    $parent.money -= 10000;
}

// å­çµ„ä»¶å…§éƒ¨çš„æ•¸æ“šæ˜¯å°å¤–é—œé–‰çš„ï¼Œåˆ¥äººä¸èƒ½è¨ªå•
// å¦‚æœæƒ³è®“å¤–éƒ¨è¨ªå•éœ€è¦é€šé defineExpose æ–¹æ³•å°å¤–æš´éœ²
defineExpose({money, fly})

</script>

<style scoped>
.dau{
    width: 400px;
    height: 200px;
    background: hotpink;
}
</style>
```

### provide & inject

vue3 æä¾› provide èˆ‡ inject åŠŸèƒ½ï¼Œå¯ä»¥å¯¦ç¾éš”å¤šå€‹çµ„ä»¶å‚³éçš„åŠŸèƒ½ï¼Œä¸¦ä¸”å¯ä»¥å¯¦ç¾æ•¸æ“šçš„é›™å‘é€£å‹• ( è‹¥æ•¸æ“šæœ‰è¢«æ›´æ”¹ï¼Œå…¶é¤˜æœ‰ç”¨åˆ°çš„åœ°æ–¹çš†æœƒä¸€åŒè¢«ä¿®æ”¹ )

```jsx
// çˆºçˆºçµ„ä»¶ provide ä¾†æºç¯„ä¾‹
<template>
    <div class="box">
        <h1>provide èˆ‡ inject</h1>
        <h2>ä»¥ä¸‹æ˜¯çƒé¾œå®¶åº­</h2>
        <hr />
        <h3>çˆºçˆºæœ‰ {{car}}</h3>  
      <Child />
    </div>
</template>

<script setup lang="ts">
import Child from "./Child.vue"
//  vue3 æä¾› provide èˆ‡ inject åŠŸèƒ½ï¼Œå¯ä»¥å¯¦ç¾éš”å¤šå€‹çµ„ä»¶å‚³éçš„åŠŸèƒ½
import {ref, provide } from 'vue'
let car = ref('å°æ‘©æ‰˜')

// provide éœ€è¦å…©å€‹åƒæ•¸
// ç¬¬ä¸€å€‹åƒæ•¸: æä¾›å°æ‡‰æ•¸æ“šçš„ key ( ç”¨ä¾†è¾¨è­˜æ˜¯å“ªçµ„æ•¸æ“š )
// ç¬¬äºŒå€‹åƒæ•¸: ç¥–å…ˆæä¾›çš„æ•¸æ“š
provide('TOKEN', car)
</script>

<style scoped>
.box{
    width: 100vw;
    height: 600px;
    background: skyblue;
}
</style>
```

Child.vue å­çµ„ä»¶ï¼Œå…§æ›è¼‰å­«çµ„ä»¶

```jsx
// Child.vue
<template>
    <div class="child">
        <h1>æˆ‘æ˜¯é¾œå…’å­</h1>
      <GrandChild />
    </div>
</template>

<script setup lang="ts">
import GrandChild from './GrandChild.vue';

</script>

<style scoped>

.child{
width: 300px;
height: 400px;
background: yellowgreen;
}

</style>
```

å­«çµ„ä»¶ GrandChild.vue

```jsx
<template>
    <div class="grand-child">
        <h1>é¾œå­«å­</h1>
        <h3>é¾œå­«å­ç¹¼æ‰¿ {{car}}</h3>
        <el-button type="primary" @click="updateCar">æ›´æ–°é¾œçˆºçˆºæ•¸æ“š</el-button>
    </div>
</template>

<script setup lang="ts">
import {inject} from 'vue'
// inject å‚³å…¥çš„ç‚º provide çš„ keyï¼Œå…¶è¿”å›çš„å°±æ˜¯ provide å‚³éä¾†çš„æ•¸æ“š
let car = inject('TOKEN')
console.log('car', car)

// å­«è¼©äº¦å¯è®Šå‹•å‚³å…¥çš„æ•¸æ“š (ç¥–è¼©çš„æ•¸æ“šæœƒè¢«é€£å‹•)
const updateCar = () => {
    car.value = 'ç©å…·è»Šè»Š'
}
</script>

<style scoped>
.grand-child{
    width: 200px;
    height: 200px;
    background: red;
}

</style>
```

### pinia

pinia ä¹Ÿæ˜¯ vue çš„ç‹€æ…‹ç®¡ç†å·¥å…·ï¼Œèˆ‡ vuex çš„æ ¸å¿ƒæ¦‚å¿µæ¯”è¼ƒå¦‚ä¸‹

vuex æ ¸å¿ƒæ¦‚å¿µ: stateã€mutationsã€actionsã€gettersã€modules

pinia æ ¸å¿ƒæ¦‚å¿µ: stateã€actionsã€getters

- åŸºæœ¬åœ¨ vue ( vite ) ä¸­çš„é…ç½®
    
    ```
    // å®‰è£æŒ‡ä»¤
    yarn add pinia
    ```
    
- å‰µå»ºèˆ‡ views åŒä¸€éšå±¤çš„è³‡æ–™å¤¾ä¸¦å‘½åç‚º storeï¼Œä¸¦åœ¨å…¶å…§æ”¾å…¥
    - **modules è³‡æ–™å¤¾**
        
        å…§æ”¾ç½®å„ repo çš„å…·é«”é…ç½®ï¼Œé€™é‚Šä»¥ info.tsç‚ºä¾‹
        
        - **option api å¯«æ³•**
            
            ```tsx
            // option api çš„å¯«æ³•
            // å®šç¾©å°å€‰åº«
            import {defineStore} from "pinia"
            
            //  ç¬¬ä¸€å€‹åƒæ•¸: å°å€‰åº«çš„åå­—
            // ç¬¬äºŒå€‹åƒæ•¸: å°å€‰åº«çš„å…·é«”é…ç½®
            // defineStore æ–¹æ³•åŸ·è¡Œæœƒè¿”å›ä¸€å€‹å‡½æ•¸ï¼Œå‡½æ•¸ä½œç”¨å°±æ˜¯å¯ä»¥è®“çµ„ä»¶ç²å–åˆ°å€‰åº«çš„æ•¸æ“š
            let useInfoStore = defineStore('info', {
                // å­˜å–æ•¸æ“š state
                state: ()=>{
                    return {
                        count: 99,
                        arr: [1,5,10]
                    }
                },
                actions: {
                    // æ³¨æ„ç›¸è¼ƒæ–¼ vuex , pinia actions ä¸­çš„åƒæ•¸æ²’æœ‰äº† context é€™åƒæ•¸
                    // ä¹Ÿä¸ç”¨ commit, mutation å»ä¿®æ”¹æ•¸æ“š
                    // è€Œç›¸è¼ƒæ–¼ vuex åªèƒ½åœ¨ action å¸¶ä¸€å€‹åƒæ•¸ï¼Œpinia å¯ä»¥å¸¶å¤šå€‹åƒæ•¸ 
                    updateNum(a:number, b: number){
                        console.log('updateNum', this, a, b)
                        // å¯ä»¥ç”¨ this èª¿ç”¨è‡ªèº«å…¶ä»–çš„ state æˆ– actions
                        this.count++;
                    }
                },
                getters: {
                    total(): number{
                    let result = this.arr.reduce((prev:number, next:number):number=>{
                            return prev + next
                        },0)
                    return result
                    }
                }
            })
            
            // å°å¤–è¼¸å‡º
            export default useInfoStore
            ```
            
        - **composition api å¯«æ³•**
            
            ```tsx
            // composition api çš„å¯«æ³•
            // å®šç¾©å°å€‰åº«
            import {defineStore} from "pinia"
            import {ref, computed} from 'vue'
            
            // å‰µå»ºå°å€‰åº«
            let useTodoStore = defineStore('todo', ()=>{
                //  state ä½¿ç”¨ ref
                let todos = ref([{id: 1, title: 'åƒé£¯'}, {id: 2, title: 'ç¡è¦º'},   {id: 3, title: 'æ‰“è±†è±†'}])
                // getters ä½¿ç”¨ computed
                let arr =ref([1,5,10])
                const total = computed(()=>{
                    return arr.value.reduce((prev:number, next:number)=>prev+next,0)
                })
                // å‹™å¿…è¦ return ä¸€å€‹ object å…§å«å±¬æ€§èˆ‡æ–¹æ³• 
                return {
                    todos,
                    arr,
                    total,
                    // actions ( ä¹Ÿå¯ä»¥å®šç¾©å®Œå¾Œé€™é‚Šæ–¹è®Šæ•¸ï¼Œçµæœæ˜¯ä¸€æ¨£çš„ )
                    updateTodos() {
                        todos.value.push({id: 4, title: 'æ²»ç™‚è±†è±†'})
                    }
                }
            })
            
            export default useTodoStore;
            ```
            
    - **index.ts**
        
        ```tsx
        import {createPinia} from 'pinia'
        // createPinia å¯ä»¥è¢«ç”¨æ–¼å‰µå»ºå¤§å€‰åº«
        let store = createPinia();
        // å°å¤–æš´éœ²
        export default store;
        ```
        
- åœ¨ main.ts ä¸­æ›è¼‰
    
    ```tsx
    import { createApp } from 'vue'
    import './style.scss'
    import App from './App.vue'
    import router from './router'
    import store from './store' // æ›è¼‰åœ¨é€™
    
    createApp(App).use(router).use(store).mount('#app')
    ```
    
- å¯¦éš›åœ¨çµ„ä»¶ä¸­ä½¿ç”¨ç¯„ä¾‹ ( ç¤ºç¯„ä¿®æ”¹æ•¸æ“šçš„æ–¹æ³• )
    
    ```tsx
    <template>
        <div class="child">
            <h1>è è˜¿å­©å­1</h1>
            <p>{{ infoStore.total }}</p>
            <p>{{ infoStore.count }}</p>
            <el-button type="primary" @click="updateCount">count åŠ åŠ </el-button>
        </div>
    </template>
    
    <script setup lang="ts">
    import useInfoStore from '../../store/modules/info'
    console.log('useInfoStore', useInfoStore)
    let infoStore = useInfoStore()
    //  ä¿®æ”¹æ•¸æ“šæ–¹æ³•
    const updateCount = ()=> {
        // 1. ç›´æ¥ç”¨ store.å±¬æ€§
        // infoStore.count ++;
        // // 2. ä¹Ÿå¯ä»¥ç”¨ $patch
        // infoStore.$patch({
        //     count: 111111
        // })
        //  3. ä¹Ÿå¯ä»¥èª¿ç”¨å€‰åº«ä¸­çš„æ–¹æ³•ä¾†æ”¹è®Šå€‰åº«æ•¸
        infoStore.updateNum(16, 20)
    
    }
    
    </script>
    
    <style scoped>
    .child{
        width: 200px;
        height: 200px;
        background: yellowgreen;
    }
    </style>
    ```
    

### slot æ’æ§½

slot å¸¸è¦‹çš„æœ‰ä¸‰ç¨®ç”¨æ³•

1. é»˜èªæ’æ§½
2. å…·åæ’æ§½
3. ä½œç”¨åŸŸæ’æ§½:  å¯ä»¥å‚³éæ•¸æ“šçš„æ’æ§½ï¼Œå­çµ„ä»¶å¯ä»¥è—‰æ­¤å°‡æ•¸æ“šå›å‚³çµ¦çˆ¶çµ„ä»¶ï¼Œç”±çˆ¶çµ„ä»¶æ±ºå®šæ‰€å›å‚³çš„æ•¸æ“šæ˜¯ä»¥ä½•ç¨®çµæ§‹æˆ–æ˜¯å¤–è§€åœ¨çµ„ä»¶å…§éƒ¨å»å±•ç¤º
- **é»˜èªæ’æ§½ & å…·åæ’æ§½ç¯„ä¾‹** ( v-slot: ç°¡å¯«æ˜¯ #  )
    
    ```tsx
    // çˆ¶çµ„ä»¶
    <template>
        <div class="box">
            <h1>slot</h1>
            <SlotTest>
                <!-- é»˜èªæ’æ§½å¡«å……æ³• -->
                <div>
                    <!-- åœ¨ pre å…§éƒ¨æœƒç…§åŸæœ¬åŸæœ¬å‘ˆç¾çš„å…§å®¹å‘ˆç¾ï¼Œè‹¥æœ‰ç©ºæ ¼æˆ–æ–·è¡Œä¹Ÿä¸éœ€è¦ç©ºæ ¼æˆ–æ–·è¡Œç¬¦è™Ÿå°±æœƒç…§å¯¦å‘ˆç¾ -->
                    <pre>å¤§æ±Ÿæ±å»æµªæ¿¤ç›¡ï¼Œåƒå¤é¢¨æµäººç‰©</pre>
                </div>
                <!-- å…·åæ’æ§½å¡«å……æ³• -->
                <template v-slot:a>
                    <div>
                        <pre>æˆ‘æ˜¯å¡«å……å…·åæ’æ§½çš„ a çµæ§‹</pre>
                    </div>
                </template>
                <!-- v-slot: ç°¡å¯«æ˜¯ # -->
                <template #b>
                    <div>
                        <pre>æˆ‘æ˜¯å¡«å……å…·åæ’æ§½çš„ b çµæ§‹</pre>
                    </div>
                </template>
            </SlotTest>
        </div>
    </template>
    
    <script setup lang="ts">
    import SlotTest from './SlotTest.vue'
    
    </script>
    ```
    
    SlotTest çµ„ä»¶
    
    ```tsx
    <template>
        <div class="box">
            <h1>æˆ‘æ˜¯å­çµ„ä»¶é»˜èªæ’æ§½</h1>
            <!-- é»˜èªæ’æ§½ -->
            <slot></slot>
            <h1>æˆ‘æ˜¯å­çµ„ä»¶é»˜èªæ’æ§½</h1>
            <!-- å…·åæ’æ§½ -->
            <h1>å…·åæ’æ§½</h1>
            <slot name='a'></slot>
            <slot name='b'></slot>
            <h1>å…·åæ’æ§½</h1>
        </div>
    </template>
    
    <script setup lang="ts">
    
    </script>
    
    <style scoped>
    .box{
        width: 100vw;
        height: 600px;
        background: skyblue;
    }
    </style>
    ```
    
- **ä½œç”¨åŸŸæ’æ§½**
    
    é€™é‚Šå±•ç¤ºçš„ç”¨æ³•æ˜¯è—‰ç”±çˆ¶çµ„ä»¶å°‡è³‡æ–™å‚³å…¥å¾Œï¼Œå†ç”±å­çµ„ä»¶å°‡è³‡æ–™å‚³å‡ºï¼Œç”±çˆ¶çµ„ä»¶ä¾†å®šç¾©æ¨£å¼ ( é€™åœ¨ element plus é€™ css library å¾ˆå¸¸ä½¿ç”¨ )
    
    ```tsx
    // çˆ¶çµ„ä»¶
    <template>
        <div class="box">
            <h1>slot</h1>
            <ScopeSlot :todos="todos">
                <template v-slot="{$row, $index}">
                    <p :style="{color:$row.done? 'green':'red'}">{{ $row.title }}--{{$index}}</p>
                </template>
            </ScopeSlot>
        </div>
    </template>
    
    <script setup lang="ts">
    import ScopeSlot from './ScopeSlot.vue'
    // ä½œç”¨åŸŸæ’æ§½ï¼Œå°±æ˜¯æŒ‡å¯ä»¥å‚³éæ•¸æ“šçš„æ’æ§½ï¼Œå­çµ„ä»¶å¯ä»¥è—‰æ­¤å°‡æ•¸æ“šå›å‚³çµ¦çˆ¶çµ„ä»¶
    // ç”±çˆ¶çµ„ä»¶æ±ºå®šæ‰€å›å‚³çš„æ•¸æ“šæ˜¯ä»¥ä½•ç¨®çµæ§‹æˆ–æ˜¯å¤–è§€åœ¨çµ„ä»¶å…§éƒ¨å»å±•ç¤º
    import {ref} from 'vue'
    let todos = ref([
    {id: 1, title: 'åƒé£¯', done:true}, {id: 2, title: 'ç¡è¦º', done: false},   {id: 3, title: 'æ‰“è±†è±†', done: true}
    ])
    
    </script>
    ```
    
    ä½œç”¨åŸŸæ’æ§½çš„ç¯„ä¾‹  
    
    ```
    <template>
        <div class="box">
            <h1>ä½œç”¨åŸŸæ’æ§½</h1>
            <p>{{ todos }}</p>
            <ul>
                <li  v-for="(item, index) in todos" :key="item.id">
                    <!-- ä½œç”¨åŸŸæ’æ§½: å¯ä»¥å°‡æ•¸æ“šå›å‚³çµ¦çˆ¶çµ„ä»¶ -->
                    <slot :$row='item' :$index='index'></slot>
                </li>
            </ul>
        </div>
    </template>
    
    <script setup lang="ts">
    // é€šé props å»æ¥å—çˆ¶çµ„ä»¶å‚³éçš„æ•¸æ“š
    defineProps(['todos'])
    
    </script>
    
    <style scoped>
    .box{
        width: 100vw;
        height: 400px;
        background: hotpink;
    }
    </style>
    ```
    

### mitt å¥—ä»¶ ( event bus )

å¯ä»¥è—‰ç”±å®‰è£ mitt å¥—ä»¶ ( [é€£çµ](https://www.npmjs.com/package/mitt) ) ä¾†å¯¦ç¾ vue2 ä¸­åŸæœ¬çš„ event bus åŠŸèƒ½ï¼Œé”æˆè³‡æ–™çš„æ©«å‘å‚³é

- **åœ¨ vue ( vite ) ä¸­çš„åŸºæœ¬é…ç½®**
    
    ```powershell
    #å®‰è£ mitt
    yarn add mitt
    ```
    
    åœ¨ src è³‡æ–™å¤¾ä¸­å‰µå»ºäº† åç‚º bus çš„è³‡æ–™å¤¾å…§éƒ¨æ”¾ä¸€å€‹ index.tsï¼Œè¨­ç½®å¦‚ä¸‹
    
    ```tsx
    //  å¼•å…¥ mitt æ’ä»¶: mitt ä¸€å€‹æ–¹æ³•ï¼Œæ–¹æ³•åŸ·è¡Œæœƒè¿”å› bus å°è±¡
    import mitt from 'mitt';
    
    const $bus = mitt();
    
    export default $bus;
    ```
    
- **å¯¦éš›ä½¿ç”¨ç¯„ä¾‹**
    
    å‡è¨­æˆ‘å€‘è¦åœ¨ child2 çµ„ä»¶ä¸­å‚³éè³‡æ–™çµ¦ child1
    
    ```tsx
    // çˆ¶çµ„ä»¶
    <template>
        <div class="box">
            <h1>mitt</h1>
            <p>å…¨å±€äº‹ä»¶ç¸½ç·š Eventbus $bus</p>
            <hr />
            <div class='container'>
                <Child1></Child1>
                <Child2></Child2>
            </div>
        </div>
    </template>
    
    <script setup lang="ts">
    import Child1 from "./child1.vue"
    import Child2 from "./child2.vue"
    
    </script>
    
    <style scoped>
    .box{
        width: 100vw;
        height: 600px;
        background: skyblue;
    }
    .container{
        display: flex;
    }
    </style>
    ```
    
    child1 çµ„ä»¶
    
    ```tsx
    <template>
        <div class="child1">
            <h1>child1</h1>
        </div>
    </template>
    
    <script setup lang="ts">
    import $bus from '../../bus'
    import {onMounted} from 'vue'
    console.log('$bus', $bus)
    // mittä½¿ç”¨ä¸Šå…ˆç­‰çµ„ä»¶æ›è¼‰å®Œç•¢å¾Œï¼Œå°‡å…¶ç¶å®šæŒ‡å®šäº‹ä»¶ï¼Œæ–¹ä¾¿å¾Œä¾†æ¥æ”¶çµ„ä»¶å‚³éçš„æ•¸æ“š
    onMounted(()=>{
    		// on ç‚ºæ¥æ”¶
        // ç¬¬ä¸€å€‹åƒæ•¸æ˜¯æŒ‡å®šäº‹ä»¶åç¨±
        // ç¬¬äºŒå€‹åƒæ•¸å‰‡ç‚ºäº‹ä»¶çš„å›èª¿
        $bus.on('car', (car)=>{
            console.log('car', car)
        })
    })
    </script>
    
    <style scoped>
    .child1{
        width: 400px;
        height: 400px;
        background: yellowgreen;
    }
    
    </style>
    ```
    
    child2 çµ„ä»¶
    
    ```tsx
    <template>
        <div class="child2">
            <h1>child2</h1>
            <el-button type="primary" @click="handler">é»æ“Šå¾Œæˆ‘çµ¦å…„å¼Ÿé€ç¦®å“</el-button>
        </div>
    </template>
    
    <script setup lang="ts">
    import $bus from "../../bus"
    const handler = () => {
        $bus.emit('car', {
            car: 'æ³•æ‹‰åˆ©'
        })
    }
    
    </script>
    
    <style scoped>
    .child2{
        width: 400px;
        height: 400px;
        background: hotpink;
    }
    </style>
    ```
    

## ä¹ã€ä½¿ç”¨ vite å»ºç«‹å°ˆæ¡ˆèˆ‡å„é …é…ç½®

### å»ºç«‹å°ˆæ¡ˆ

- ä½¿ç”¨ node 16 ä»¥ä¸Š
- vite å»ºç«‹æ–°å°ˆæ¡ˆ
    
    ```tsx
    yarn create vite
    ```
    
- åœ¨ package.json ä¸­
    
    ```tsx
    {
    ...
    "scripts": {
    		"dev": "vite --open" // åŠ ä¸Š --openå­—æ¨£ï¼Œæœƒåœ¨å°ˆæ¡ˆå•Ÿå‹•æ™‚é †ä¾¿é–‹å•Ÿç€è¦½å™¨
    	}
    ...
    }
    ```
    

### é…ç½® eslint

- åŠ ä¸Š eslint
    
    ```tsx
    yarn add eslint -D
    ```
    
- ç”Ÿæˆé…ç½®æ–‡ä»¶ eslint.cjs
    
    ```tsx
    npx eslint --init
    ```
    
    - é€™æœƒå•Ÿå‹• eslint é…ç½®ï¼ŒåŒ…å«è¨­ç½® eslint ä½¿ç”¨çš„ç›®çš„é¸æ“‡ã€ç¢ºèªç›®å‰è¦ä½¿ç”¨çš„ç¨‹å¼èªè¨€ï¼Œä»¥åŠå»ºè­°å®‰è£çš„å°æ‡‰å¥—ä»¶ ex: eslint-plugin-vue, typescript-eslintâ€¦etc.
    - eslint.cjs å…§éƒ¨é…ç½®çš„ä»‹ç´¹
        
        ```tsx
        module.exports = {
            "env": { // eslint å·¥ä½œçš„ç’°å¢ƒ
                "browser": true, // ç€è¦½å™¨
                "es2021": true // eslint çš„ es ç‰ˆæœ¬èªæ³•
            },
            "extends": [ // è¦å‰‡çš„å»¶ä¼¸
                "eslint:recommended",
                "plugin:@typescript-eslint/recommended", // æª¢æŸ¥ ts çš„èªæ³•
                "plugin:vue/vue3-essential" // æª¢æŸ¥ vue3 çš„èªæ³•
            ],
            "overrides": [ // è¦ç‚ºç‰¹å®šé¡å‹çš„æ–‡ä»¶æŒ‡å®šè™•ç†å™¨
                {
                    "env": {
                        "node": true
                    },
                    "files": [
                        ".eslintrc.{js,cjs}"
                    ],
                    "parserOptions": {
                        "sourceType": "script"
                    }
                }
            ],
            "parserOptions": {
                "ecmaVersion": "latest", // ts è§£æå™¨ es ç‰ˆæœ¬é…ç½®
                "parser": "@typescript-eslint/parser", // æŒ‡å®šè§£æå™¨
                "sourceType": "module" // æœ‰å…©ç¨® script èˆ‡ moduleï¼Œä¹Ÿå°±æ˜¯æœƒæ ¡é©— ESCMAScript ä¸­çš„èªæ³•
            },
            "plugins": [ // æ’ä»¶
                "@typescript-eslint",
                "vue"
            ],
        		// eslint è¦å‰‡é…ç½®
            "rules": {
            }
        }
        ```
        
        è¨»: parser è§£æå™¨æœ‰ä¸‰ç¨®é¸é …
        
        - Esprima é»˜èªè§£æå™¨
        - Babel-Eslint babel è§£æå™¨
        - @typescript-eslint/parser ts è§£æå™¨

- å®‰è£å¸¸ç”¨çš„ vue3 ç’°å¢ƒä»£ç¢¼æ’ä»¶
    
    ```powershell
    #è®“æ‰€æœ‰èˆ‡ prettier è¦å‰‡å­˜åœ¨è¡çªçš„ Eslint rule å¤±æ•ˆï¼Œä¸¦ä½¿ç”¨ prettier é€²è¡Œä»£ç¢¼æª¢æŸ¥
    "eslint-config-prettier": "^8.6.0",
    "eslint-plugin-import": "^2.27.5",
    "eslint-plugin-node": "^11.1.0",
    #é‹è¡Œæ›´æ¼‚äº®çš„ Eslintï¼Œä½¿ prettier çš„è¦å‰‡å„ªå…ˆç´šæ›´é«˜ï¼ŒEslint å„ªå…ˆåºè¼ƒä½
    "eslint-plugin-prettier": "^4.2.1",
    #vue.js çš„ Eslint æ’ä»¶ ( æŸ¥æ‰¾ vue èªæ³•éŒ¯èª¤ï¼Œç™¼ç¾éŒ¯èª¤æŒ‡ä»¤)
    "eslint-plugin-vue": "^9.9.0",
    #è©²è§£æå™¨å…è¨±ä½¿ç”¨ Eslint  æ ¡é©—æ‰€æœ‰ babel code
    "@babel/eslint-parser": "^7.19.1",
    ```
    
- å®‰è£æŒ‡ä»¤
    
    ```powershell
    yarn add -D eslint-plugin-import eslint-plugin-vue eslint-plugin-node eslint-plugin-prettier eslint-config-prettier eslint-plugin-node @babel/eslint-parser
    ```
    
- **ä¿®æ”¹ eslintrc.cjs é…ç½®æ–‡ä»¶**
    
    ```jsx
    module.exports = {
        "env": {
            "browser": true,
            "es2021": true,
    				"node": true,
    				"jest": true,
        },
    		/* ç»§æ‰¿å·²æœ‰çš„è§„åˆ™ */
        "extends": [
            "eslint:recommended",
            "plugin:@typescript-eslint/recommended",
            "plugin:vue/vue3-essential",
    				"plugin:prettier/recommended",
        ],
        "overrides": [
            {
                "env": {
                    "node": true
                },
                "files": [
                    ".eslintrc.{js,cjs}"
                ],
                "parserOptions": {
                    "sourceType": "script"
                }
            }
        ],
    		/* æŒ‡å®šå¦‚ä½•è§£æè¯­æ³• */
    		"parser": 'vue-eslint-parser',
    		/** ä¼˜å…ˆçº§ä½äº parse çš„è¯­æ³•è§£æé…ç½® */
        "parserOptions": {
            "ecmaVersion": "latest",
            "parser": "@typescript-eslint/parser",
            "sourceType": "module",
    				"jsxPragma": 'React',
    				"ecmaFeatures": {
    					"jsx": true,
    			},
        },
        "plugins": [
            "@typescript-eslint",
            "vue"
        ],
    		/*
       * "off" æˆ– 0    ==>  å…³é—­è§„åˆ™
       * "warn" æˆ– 1   ==>  æ‰“å¼€çš„è§„åˆ™ä½œä¸ºè­¦å‘Šï¼ˆä¸å½±å“ä»£ç æ‰§è¡Œï¼‰
       * "error" æˆ– 2  ==>  è§„åˆ™ä½œä¸ºä¸€ä¸ªé”™è¯¯ï¼ˆä»£ç ä¸èƒ½æ‰§è¡Œï¼Œç•Œé¢æŠ¥é”™ï¼‰
       */
        "rules": {
    			// eslintï¼ˆhttps://eslint.bootcss.com/docs/rules/ï¼‰
        'no-var': 'error', // è¦æ±‚ä½¿ç”¨ let æˆ– const è€Œä¸æ˜¯ var
        'no-multiple-empty-lines': ['warn', { max: 1 }], // ä¸å…è®¸å¤šä¸ªç©ºè¡Œ
        'no-console': process.env.NODE_ENV === 'production' ? 'error' : 'off',
        'no-debugger': process.env.NODE_ENV === 'production' ? 'error' : 'off',
        'no-unexpected-multiline': 'error', // ç¦æ­¢ç©ºä½™çš„å¤šè¡Œ
        'no-useless-escape': 'off', // ç¦æ­¢ä¸å¿…è¦çš„è½¬ä¹‰å­—ç¬¦
    
        // typeScript (https://typescript-eslint.io/rules)
        '@typescript-eslint/no-unused-vars': 'error', // ç¦æ­¢å®šä¹‰æœªä½¿ç”¨çš„å˜é‡
        '@typescript-eslint/prefer-ts-expect-error': 'error', // ç¦æ­¢ä½¿ç”¨ @ts-ignore
        '@typescript-eslint/no-explicit-any': 'off', // ç¦æ­¢ä½¿ç”¨ any ç±»å‹
        '@typescript-eslint/no-non-null-assertion': 'off',
        '@typescript-eslint/no-namespace': 'off', // ç¦æ­¢ä½¿ç”¨è‡ªå®šä¹‰ TypeScript æ¨¡å—å’Œå‘½åç©ºé—´ã€‚
        '@typescript-eslint/semi': 'off',
    
        // eslint-plugin-vue (https://eslint.vuejs.org/rules/)
        'vue/multi-word-component-names': 'off', // è¦æ±‚ç»„ä»¶åç§°å§‹ç»ˆä¸º â€œ-â€ é“¾æ¥çš„å•è¯
        'vue/script-setup-uses-vars': 'error', // é˜²æ­¢<script setup>ä½¿ç”¨çš„å˜é‡<template>è¢«æ ‡è®°ä¸ºæœªä½¿ç”¨
        'vue/no-mutating-props': 'off', // ä¸å…è®¸ç»„ä»¶ propçš„æ”¹å˜
        'vue/attribute-hyphenation': 'off', // å¯¹æ¨¡æ¿ä¸­çš„è‡ªå®šä¹‰ç»„ä»¶å¼ºåˆ¶æ‰§è¡Œå±æ€§å‘½åæ ·å¼
        },
    }
    ```
    
- ç”Ÿæˆ **.eslintignore** æ–‡ä»¶
    
    ```
    dist
    node_modules
    ```
    
- é‹è¡Œè…³æœ¬
    
    åœ¨ **package.json** ä¸­æ–°å¢å…©å€‹ script æŒ‡ä»¤
    
    ```
    "scripts": {
    	...
    	"lint": "eslint src", // æœƒè‡ªå‹•è·‘é src è³‡æ–™å¤¾ä¸¦å ±å‡ºç•¶ä¸­çš„ eslint éŒ¯èª¤
    	"fix": "eslint src --fix" // æœƒç›´æ¥å¹«å¿™ä¿®æ­£ eslint æœ‰å•é¡Œçš„éƒ¨åˆ†
    	...
    }
    ```
    

### é…ç½® Prettier

eslint ä¸»è¦é‡å°çš„æ˜¯ javascriptï¼Œä»–æ˜¯ä¸€æª¢æ¸¬å·¥å…·ï¼ŒåŒ…å«äº† js èªæ³•ä»¥åŠå°‘éƒ¨åˆ†çš„æ ¼å¼å•é¡Œï¼Œåœ¨ eslint çœ‹ä¾†ï¼Œèªæ³•å°äº†å°±èƒ½ä¿è­‰ä»£ç¢¼æ­£å¸¸é‹è¡Œï¼Œæ ¼å¼å•é¡Œåè€Œæ˜¯å…¶æ¬¡

prettier å‰‡è¼ƒå±¬æ–¼æ ¼å¼åŒ–å·¥å…·ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯çµ±ä¸€æ ¼å¼ç¢¼æ›¸å¯«æ ¼å¼ï¼Œå…¶å¤– prettier ä¹Ÿæ”¯æŒåŒ…å« js åœ¨å…§ç­‰å¤šç¨®èªè¨€

ç¸½çµä¾†èªªï¼Œeslint èˆ‡ prettier ä¸€å€‹ç®¡ js ç¨‹å¼ç¢¼çš„è³ªé‡ï¼Œå¦ä¸€å€‹å‰‡æ˜¯ä¿è­‰ç¾è§€

- **å®‰è£ä¾è³´**
    
    ```
    yarn add -D eslint-plugin-prettier prettier eslint-config-prettier
    ```
    
- .**prettierrc.json** è¦å‰‡çš„æ·»åŠ 
    
    ```json
    {
    	"singleQuote": true, // å­—ä¸²å¿…æ˜¯å–®å¼•è™Ÿ
      "semi": false, // åˆ†è™Ÿéœ€è¦èˆ‡å¦
      "bracketSpacing": true,
      "htmlWhitespaceSensitivity": "ignore",
      "endOfLine": "auto",
      "trailingComma": "all",
      "tabWidth": 2 // ç¸®æ’çš„ç©ºæ ¼æ•¸
    }
    ```
    
- æ–°å¢ **.prettierignore** å¿½ç•¥æ–‡ä»¶
    
    ```json
    /dist/*
    /html/*
    .local
    /node_modules/**
    **/*.svg
    **/*.sh
    /public/*
    ```
    

### é…ç½® stylelint

stylelint ç‚º css çš„ lint å·¥å…·ï¼Œå¯ä»¥æ ¼å¼åŒ– css ä»£ç¢¼ï¼Œæª¢æŸ¥ css éŒ¯èª¤æˆ–ä¸åˆç†çš„å¯«æ³•ï¼Œä¸¦æŒ‡å®š css çš„æ›¸å¯«é †åº

```powershell
yarn add sass sass-loader stylelint postcss postcss-scss postcss-html postcss-html stylelint-config-prettier stylelint-config-recess-order stylelint-config-recommended-scss stylelint-config-standard stylelint-config-standard-vue stylelint-scss stylelint-order stylelint-config-standard-scss -D
```

- .**stylelintrc.cjs é…ç½®æ–‡ä»¶**

å®˜ç¶²: [https://stylelint.io/](https://stylelint.io/)

```jsx
// @see https://stylelint.bootcss.com/

module.exports = {
  extends: [
    'stylelint-config-standard', // é…ç½®stylelintæ‹“å±•æ’ä»¶
    'stylelint-config-html/vue', // é…ç½® vue ä¸­ template æ ·å¼æ ¼å¼åŒ–
    'stylelint-config-standard-scss', // é…ç½®stylelint scssæ’ä»¶
    'stylelint-config-recommended-vue/scss', // é…ç½® vue ä¸­ scss æ ·å¼æ ¼å¼åŒ–
    'stylelint-config-recess-order', // é…ç½®stylelint csså±æ€§ä¹¦å†™é¡ºåºæ’ä»¶,
    'stylelint-config-prettier', // é…ç½®stylelintå’Œprettierå…¼å®¹
  ],
  overrides: [
    {
      files: ['**/*.(scss|css|vue|html)'],
      customSyntax: 'postcss-scss',
    },
    {
      files: ['**/*.(html|vue)'],
      customSyntax: 'postcss-html',
    },
  ],
  ignoreFiles: [
    '**/*.js',
    '**/*.jsx',
    '**/*.tsx',
    '**/*.ts',
    '**/*.json',
    '**/*.md',
    '**/*.yaml',
  ],
  /**
   * null  => å…³é—­è¯¥è§„åˆ™
   * always => å¿…é¡»
   */
  rules: {
    'value-keyword-case': null, // åœ¨ css ä¸­ä½¿ç”¨ v-bindï¼Œä¸æŠ¥é”™
    'no-descending-specificity': null, // ç¦æ­¢åœ¨å…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§çš„é€‰æ‹©å™¨åå‡ºç°è¢«å…¶è¦†ç›–çš„è¾ƒä½ä¼˜å…ˆçº§çš„é€‰æ‹©å™¨
    'function-url-quotes': 'always', // è¦æ±‚æˆ–ç¦æ­¢ URL çš„å¼•å· "always(å¿…é¡»åŠ ä¸Šå¼•å·)"|"never(æ²¡æœ‰å¼•å·)"
    'no-empty-source': null, // å…³é—­ç¦æ­¢ç©ºæºç 
    'selector-class-pattern': null, // å…³é—­å¼ºåˆ¶é€‰æ‹©å™¨ç±»åçš„æ ¼å¼
    'property-no-unknown': null, // ç¦æ­¢æœªçŸ¥çš„å±æ€§(true ä¸ºä¸å…è®¸)
    'block-opening-brace-space-before': 'always', //å¤§æ‹¬å·ä¹‹å‰å¿…é¡»æœ‰ä¸€ä¸ªç©ºæ ¼æˆ–ä¸èƒ½æœ‰ç©ºç™½ç¬¦
    'value-no-vendor-prefix': null, // å…³é—­ å±æ€§å€¼å‰ç¼€ --webkit-box
    'property-no-vendor-prefix': null, // å…³é—­ å±æ€§å‰ç¼€ -webkit-mask
    'selector-pseudo-class-no-unknown': [
      // ä¸å…è®¸æœªçŸ¥çš„é€‰æ‹©å™¨
      true,
      {
        ignorePseudoClasses: ['global', 'v-deep', 'deep'], // å¿½ç•¥å±æ€§ï¼Œä¿®æ”¹elementé»˜è®¤æ ·å¼çš„æ—¶å€™èƒ½ä½¿ç”¨åˆ°
      },
    ],
  },
}
```

- è¨­ç½® **.stylelintignore**
    
    ```jsx
    /node_modules/*
    /dist/*
    /html/*
    /public/*
    ```
    
- é‹è¡Œè…³æœ¬
    
    åœ¨ **package.json** ä¸­æ–°å¢å…©å€‹ script æŒ‡ä»¤
    
    ```jsx
    "scripts": {
    	...
    		"format": "prettier --write \"./**/*.{html,vue,ts,js,json,md}\"",
        "lint:eslint": "eslint src/**/*.{ts,vue} --cache --fix",
        "lint:style": "stylelint src/**/*.{css,scss,vue} --cache --fix"
    	...
    }
    ```
    

### é…ç½® husky

husky çš„åŠŸèƒ½æ˜¯é¿å…æœ‰äººå°‡æ²’æœ‰è¢«æ ¼å¼åŒ–çš„ç¨‹å¼ç¢¼æ¨åˆ° repoï¼Œåˆ©ç”¨é€™å·¥å…·å°±èƒ½å¼·åˆ¶è®“é–‹ç™¼äººå“¡éµå¾ªä»£ç¢¼è¦ç¯„ä¾†æäº¤ä»£ç¢¼

è¦åšåˆ°é€™ä»¶äº‹ï¼Œå°±è¦åˆ©ç”¨ husky åœ¨ä»£ç¢¼æäº¤å‰è§¸ç™¼ git hook ( git åœ¨å®¢æˆ¶ç«¯çš„é‰¤å­ )ï¼Œç„¶å¾ŒåŸ·è¡Œ yarn run format ä¾†è‡ªå‹•æ ¼å¼åŒ–æˆ‘å€‘çš„ä»£ç¢¼

å®‰è£ ( **æ³¨æ„: è¦å…ˆæ¨ä¸Š gitï¼Œhusky æ‰æœ‰ git hook å¯ä»¥æŠ“ï¼Œæ‰æœƒå®‰è£æˆåŠŸ** )

```jsx
yarn add -D husky
```

åŸ·è¡Œ

```jsx
npx husky-init
```

åŸ·è¡Œå¾Œæœƒåœ¨æ ¹ç›®éŒ„ä¸‹ç”Ÿæˆä¸€å€‹ .husky ç›®éŒ„ï¼Œè€Œé€™ç›®éŒ„ä¸‹é¢æœƒæœ‰ä¸€å€‹ pre-commit æ–‡ä»¶ï¼Œè€Œé€™æ–‡ä»¶çš„å‘½ä»¤æœƒåœ¨æ¯æ¬¡æˆ‘å€‘ commit æ™‚å°±æœƒåŸ·è¡Œ

åœ¨ .husky/pre-commit æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å‘½ä»¤:

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

#åœ¨ commit å‰æ ¼å¼åŒ–ä»£ç¢¼
yarn run format
```

### é…ç½® commitlint

åœ¨å¸Œæœ›åœ˜éšŠå…§éƒ¨çš„æˆå“¡çµ±ä¸€ æ¯æ¬¡ commit çš„æ ¼å¼ (åŠå…¶éœ€æ¶µè“‹çš„è³‡è¨Š)ï¼Œæ­¤æ™‚å°±å¯ä»¥ä½¿ç”¨ commitlint ä¾†å¯¦ç¾

- å®‰è£

```bash
yarn add @commitlint/config-conventional @commitlint/cli -D
```

- æ·»åŠ é…ç½®æ–‡ä»¶ï¼Œæ–°å»º **commitlint.config.cjs**ï¼Œç„¶å¾Œåœ¨æ­¤æª”æ¡ˆä¸­æ·»åŠ ä»¥ä¸‹é…ç½®

```jsx
module.exports = {
  extends: ['@commitlint/config-conventional'],
  //   æ ¡é©—è¦å‰‡
  rules: {
    'type-enum': [
      2,
      'always',
      [
        'feat',
        'fix',
        'docs',
        'style',
        'refactor',
        'pref',
        'test',
        'chore',
        'revert',
        'build',
      ],
    ],
    'type-case': [0],
    'type-empty': [0],
    'scope-empty': [0],
    'scope-case': [0],
    'subject-full-stop': [0, 'never'],
    'subject-case': [0, 'never'],
    'header-max-length': [0, 'always', 72],
  },
}
```

- åœ¨ package.json é…ç½®å°æ‡‰çš„ script æŒ‡ä»¤

```jsx
{
...
"scripts": {
	...
	"commitlint": "commitlint --config commitlint.config.cjs -e -V",
	...
	}
...
}
```

- é…ç½®çµæŸï¼Œç•¶æˆ‘å€‘å¡«å¯« commit æ™‚ï¼Œå‰é¢å°±å¿…å¸¶ä¸‹é¢ä¸»é¡Œ ( subject )

```
'feat', // æ–°ç‰¹æ€§, æ–°åŠŸèƒ½
'fix', //ä¿®æ”¹ bug
'docs', // æ–‡æª”ä¿®æ”¹
'style', // é€™è£¡æŒ‡çš„æ˜¯ä»£ç¢¼æ ¼å¼ä¿®æ”¹ï¼Œä¸æ˜¯ css ä¿®æ”¹
'refactor', // ä»£ç¢¼é‡è³¼
'pref', // å„ªåŒ–ç›¸é—œï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€é«”é©—
'test', // æ¸¬è©¦ç”¨æ¡ˆä¾‹
'chore', // å…¶ä»–ä¿®æ”¹ï¼Œæ¯”å¦‚æ”¹è®Šæ§‹å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾è³´ã€å·¥å…·ç­‰
'revert', // å›åˆ°ä¸Šä¸€å€‹ç‰ˆæœ¬
'build', // ç·¨è­¯ç›¸é—œçš„ä¿®æ”¹ï¼Œä¾‹å¦‚ç‰ˆæœ¬ç™¼å¸ƒã€å°é …ç›®æ§‹å»ºæˆ–ä¾è³´çš„æ”¹å‹•
```

- é…ç½® husky

```
npx husky add .husky/commit-msg
```

- åœ¨æ–°ç”Ÿæˆçš„ commit-msg æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹æŒ‡ä»¤

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

yarn commitlint
```

### å¼·åˆ¶å°‡ node  å¥—ä»¶ç®¡ç†å·¥å…·çµ±ä¸€

å› ç‚ºåœ˜éšŠå¥—ä»¶ç®¡ç†å·¥å…·è‹¥ä¸ç›¸åŒï¼Œå…¶ä¸‹è¼‰çš„ä¾è³´ä¹Ÿå¯èƒ½æœƒæœ‰ä¸åŒï¼Œè€Œæœ€å¾Œç”¢ç”Ÿå‡º bug å› æ­¤å»ºè­°åœ˜éšŠè¦çµ±ä¸€å°æ‡‰çš„åŒ…ç®¡ç†å·¥å…·ï¼Œé€™é‚Šä»¥ pnpm ä½œç‚ºç¯„ä¾‹

åœ¨å°ˆæ¡ˆè·Ÿç›®éŒ„ä¸‹å»ºç«‹ scripts/preinstall.js æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å…§å®¹

```jsx
// !/pnpm/ ä»£è¡¨è‹¥åŒ…ç®¡ç†å·¥å…·ä¸æ˜¯ pnpm 
if (!/pnpm/.test(process.env.npm_execpath || '')) {
  console.warn(
    `\u001b[33mThis repository must using pnpm as the package manager ` +
      ` for scripts to work properly.\u001b[39m\n`,
  )
  process.exit(1) // å‰‡ç›´æ¥çµæŸï¼Œç„¡æ³•åŸ·è¡Œ
}
```

é…ç½®å‘½ä»¤ï¼Œåœ¨ package.json ä¸­åŠ å…¥

```jsx
{
...
"scripts": {
		...
		"preinstall": "node ./scripts/preinstall.js",
		...
	}
...
}
```

è‹¥é€™æ¨£è¨­å®šï¼Œç•¶ä½¿ç”¨è€…ä¸‹è¼‰ä¸¦é€²è¡Œå®‰è£æ™‚ï¼Œè‹¥ä½¿ç”¨é pnpm çš„å¥—ä»¶ç®¡ç†å·¥å…·å‰‡éƒ½æœƒå‡ºéŒ¯

### å®‰è£ element-plus çµ„ä»¶

å®˜ç¶²: [https://element-plus.org/zh-CN/guide/quickstart.html#ç”¨æ³•](https://element-plus.org/zh-CN/guide/quickstart.html#%E7%94%A8%E6%B3%95)

- å®‰è£
    
    ```jsx
    yarn add element-plus
    ```
    
- åœ¨ main.js åšæ›è¼‰
    
    ```jsx
    // main.ts
    import { createApp } from 'vue'
    import ElementPlus from 'element-plus' // å¼•å…¥ element æ’ä»¶
    import 'element-plus/dist/index.css' // å¼•å…¥å°æ‡‰æ¨£å¼
    import App from './App.vue'
    
    const app = createApp(App) // ç²å–å¯¦ä¾‹å°è±¡
    // å®‰è£ element-plus æ’ä»¶
    app.use(ElementPlus)
    app.mount('#app') // æ›è¼‰
    ```
    
- å®‰è£ element-plus å°æ‡‰çš„ icon æ’ä»¶
    
    ```jsx
    yarn add @element-plus/icons-vue
    ```
    
- i18n é…ç½® ( [å®˜ç¶²](https://element-plus.org/zh-CN/guide/i18n.html) )
    
    ```jsx
    import { createApp } from 'vue'
    import './style.css'
    import ElementPlus from 'element-plus' // å¼•å…¥ element æ’ä»¶
    import 'element-plus/dist/index.css' // å¼•å…¥å°æ‡‰æ¨£å¼
    // i18n é…ç½®ï¼Œä½†ç”±æ–¼é€™æ®µæ²’æœ‰ ts declare çš„ å‹åˆ¥ï¼Œæ‰€ä»¥æœƒæœ‰ç´…å­—
    // è€Œæ­¤æ™‚è‹¥é‹è¡Œ run build ä¹Ÿæœƒå› ç‚ºæœŸæ²’æœ‰å°æ‡‰çš„ ts declaration è€Œæœƒæ‰“åŒ…å¤±æ•—
    // æœ€ç°¡ä¾¿çš„è§£æ³•æ˜¯ ä½¿ç”¨ @ts-ignore ä¾†å¿½ç•¥æ­¤é …ç›®æ²’æœ‰ type çš„é¡å‹æª¢æ¸¬ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹
    //@ts-ignore
    import zhTw from 'element-plus/dist/locale/zh-tw.mjs' 
    import App from './App.vue'
    
    const app = createApp(App)
    app.use(ElementPlus, {
     locale: zhTw, // åŠ å…¥é€™æ®µ
    })
    app.mount('#app')
    ```
    
    è¨»: åœ¨ node_modules/element-plus/dist/locale è³‡æ–™å¤¾ä¸­ï¼Œæœ‰å„ç¨®èªè¨€ mjs æª”ï¼Œè‹¥éœ€è¦æ™‚ä¹Ÿå¯ä¸€åŒå¼•å…¥
    

### src è·¯å¾‘åˆ¥åè¨­ç½®

å¦‚è‹¥æ²’æœ‰è¨­ç½®çš„ç¾åœ¨ï¼Œæ¯æ¯è¦å¯« src è·¯å¾‘æ™‚ï¼Œéƒ½è¦ä½¿ç”¨ â€œ../../â€ ç­‰çµ•å°è·¯å¾‘åšè¨­ç½®ï¼Œå…¶å¯¦å¾ˆéº»ç…©ï¼Œæ‰€ä»¥é€™é‚Šçš„ä½œæ³•æ˜¯å°‡è·¯å¾‘è¨­åˆ¥å ( alias ) ä»¥é¿å…å¾ŒçºŒçš„éº»ç…©

```jsx
// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import path from 'path' // å¼•å…¥ path ( node æä¾›çš„æ¨¡å¡Šï¼Œå¯ä»¥ç²å–åˆ°æŸå€‹æ–‡ä»¶å¤¾å…·é«”çš„è·¯å¾‘ ( çµ•å°è·¯å¾‘ æˆ– ç›¸å°è·¯å¾‘) )

export default defineConfig({
  plugins: [vue()],
	resolve: { alias: { '@': path.resolve('./src') } }, // ç›¸å°è·¯å¾‘åˆ¥åé…ç½®ï¼Œä½¿ç”¨ @ ä»£æ›¿ src
})
```

typescript ç·¨è­¯é…ç½®

```jsx
//tsconfig.json
{
  "compilerOptions": {
		...
    "baseUrl": "./", // è§£æéç›¸å¯¹æ¨¡å—çš„åŸºåœ°å€ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½•
    "paths": {
      //è·¯å¾„æ˜ å°„ï¼Œç›¸å¯¹äºbaseUrl
      "@/*": ["src/*"]
    },
		...
	},
	...
}
```

è¨»: è‹¥é€™äº›éƒ½è¨­å®šå®Œå¾Œï¼Œåœ¨è·¯å¾‘çš„ä½ç½®ä¸Šé‚„æ˜¯æœ‰ç´…ç·šï¼Œæœ‰å¯èƒ½æ˜¯å› ç‚ºæœ‰å®‰è£ Vetur é€™æ’ä»¶ï¼Œè€Œé€™æ’ä»¶ä¸¦ä¸å¤ªæ”¯æ´ vue3 èªæ³•ï¼Œæ‰€ä»¥å°‡æ­¤æ’ä»¶å¸è¼‰é‡å•Ÿå³å¯ ( vue3 è¼ƒæ¨è–¦å®‰è£çš„æ˜¯ volar )

### ç’°å¢ƒè®Šé‡çš„è¨­ç½®

ä¸€èˆ¬å¸¸è¦‹çš„ç’°å¢ƒæœ‰ä¸‰ç¨®

- é–‹ç™¼ç’°å¢ƒ: é–‹ç™¼ä½¿ç”¨ç’°å¢ƒï¼Œæ¯ä½é–‹ç™¼äººå“¡åœ¨å„è‡ªçš„åˆ†æ”¯ä¸Šé€²è¡Œé–‹ç™¼æœ€å¾Œåˆä½µ
- æ¸¬è©¦ç’°å¢ƒ: æ¸¬è©¦è€…ä½¿ç”¨çš„ç’°å¢ƒï¼Œä¸€èˆ¬ä¾†èªªæ˜¯ç”±æ¸¬è©¦çµ„ç¹”éƒ¨å±¬ï¼Œé€šå¸¸æ­¤ç’°å¢ƒæ˜¯ç”¨ä¾†ä»£ç¢¼æ¸¬è©¦
- ç”Ÿç”¢ç’°å¢ƒ: æ­£å¼å°å¤–ç’°å¢ƒï¼Œä¸€èˆ¬æœƒé—œæ‰éŒ¯èª¤å ±å‘Šï¼Œæ‰“é–‹éŒ¯èª¤æ—¥èªŒ ( æ­£æ˜¯æä¾›çµ¦å®¢æˆ¶ä½¿ç”¨çš„ç’°å¢ƒ )

```
.env.developement
.env.production
.env.test
```

ä»¥ä¸‹æ˜¯ .env ä¸­å¯æ”¾çš„è®Šé‡ç¯„ä¾‹

```
#åœ¨ vite ä¸­ï¼Œè®Šé‡å¿…é ˆä»¥ VITE_ ç‚ºå‰ç¶´å‘½åå¤–éƒ¨æ‰èƒ½å¤ è®€å–
NODE_ENV = 'development'
VITE_APP_TITLE = 'å¾Œè‡ºç‡Ÿé‹å¹³å°'
VITE_APP_BASE_API = '/dev-api'
```

```
# production
NODE_ENV = 'production'
VITE_APP_TITLE = 'å¾Œè‡ºç‡Ÿé‹å¹³å°'
VITE_APP_BASE_API = '/prod-api'
```

```
# test
NODE_ENV = 'test'
VITE_APP_TITLE = 'å¾Œè‡ºç‡Ÿé‹å¹³å°'
VITE_APP_BASE_API = '/test-api'
```

- åœ¨ package.json å»é…ç½®å°æ‡‰çš„é‹è¡Œå‘½ä»¤

```json
{
	"scripts": {
		...
		"dev": "vite --open",
		"build:test": "vue-tsc && vite build --mode test", // è¨˜å¾—åŠ  :test
    "build:pro": "vue-tsc && vite build --mode production", // è¨˜å¾—åŠ  :pro
		...
	}
}
```

- åœ¨æ–‡ä»¶çš„å…¶ä»–åœ°æ–¹èª¿ç”¨ env å…§çš„è®Šé‡ï¼Œå¯ä»¥é€é **`import.meta.env`** ç²å–

### SVG åœ–æ¨™é…ç½®

**å…è²» SVG è³‡æºç¶²ç«™ 1**: [https://www.iconfont.cn/?spm=a313x.search_index.i3.d4d0a486a.4d513a81BewhXD](https://www.iconfont.cn/?spm=a313x.search_index.i3.d4d0a486a.4d513a81BewhXD) ( éœ€è¦ç¶æ‰‹æ©Ÿè™Ÿ )

**å…è²» SVG è³‡æºç¶²ç«™ 2**:[https://www.svgrepo.com/](https://www.svgrepo.com/)

ä½¿ç”¨ SVG çŸ¢é‡åœ–ï¼Œå¯ä»¥æ¸›ä¸Šé é¢ä¸ŠåŠ è¼‰åœ–ç‰‡è³‡æºçš„éœ€æ±‚ï¼Œé€²è€Œæå‡é é¢çš„æ•ˆèƒ½

ç›¸è¼ƒæ–¼åœ–ç‰‡è³‡æºï¼ŒSVG çš„å®¹é‡ä¹Ÿç›¸å°çš„å°äº†å¾ˆå¤š

```powershell
yarn add vite-plugin-svg-icons -D
```

- åœ¨ vite.config.ts ä¸­é…ç½®å¥—ä»¶

```tsx
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import path from 'path'
// å¼•å…¥svg
import { createSvgIconsPlugin } from 'vite-plugin-svg-icons'

export default defineConfig({
plugins: [
    vue(),
    createSvgIconsPlugin({
      // specify the icon folder to be cached svg æ”¾ç½®ä½ç½®
      iconDirs: [path.resolve(process.cwd(), 'src/assets/icons')],
      // specify symbolId format
      symbolId: 'icon-[dir]-[name]',
    }),
  ],
  resolve: { alias: { '@': path.resolve('./src') } },
})
```

- åœ¨ main.ts é€™å…¥å£æ–‡ä»¶å»å°å…¥

```tsx
// svgæ’ä»¶éœ€è¦é…ç½®ä»£ç 
import 'virtual:svg-icons-register'
```

- æ­¤æ™‚ï¼Œåªè¦ç¢ºä¿æˆ‘å€‘çš„ svg æ”¾ç½®çš„ä½ç½®åœ¨ src/assets/iconsï¼Œæˆ‘å€‘å°±å¯ä»¥ä½¿ç”¨èªæ³• **`#icon-åœ–æ¨™åç¨±`** ç›´æ¥ä½¿ç”¨ svg æª”æ¡ˆ

```tsx
<template>
  <div>
    <!-- svg: æ˜¯ svg åœ–ç‰‡çš„å¤–å±¤å®¹å™¨ç¯€é»ï¼Œå…§ä¸éœ€è¦æ­é… use æ¨™ç±¤çµåˆä½¿ç”¨ -->
    <svg style="width:30px; height:30px">
      <!-- xlink:href æŒ‡å®šåŸ·è¡Œå“ªä¸€å€‹åœ–æ¨™å…¶å€¼å‹™å¿…ä»¥ ä½¿ç”¨ -->
      <!-- åœ¨ use ä¸­è¨­ç½® fill å¯ä»¥æ”¹è®Šåœ–æ¨™çš„é¡è‰² -->
      <!-- è¦ fill æ”¹é¡è‰²æœ‰ç”¨è¨˜å¾—å°‡ svg ä¸­çš„ path ä¸èƒ½æœ‰ fill å±¬æ€§ï¼Œé€™é‚Šæ‰æ”¹çš„å‹• -->
      <use xlink:href="#icon-phone" fill="red"></use>
    </svg>
  </div>
</template>
```

- ä½†æ¯æ¬¡è¦ä½¿ç”¨éƒ½è¦å¦å¤–æ’°å¯« svg èˆ‡ use tag å› æ­¤å»ºè­°åŒ…æˆä¸€å€‹å¯è¤‡ç”¨çš„çµ„ä»¶ï¼Œé€™é‚Šå»ºç«‹ä¸€å€‹ åç‚º SvgIcon çš„ vue çµ„ä»¶ components/SvgIcon/index.vue

```tsx
<script setup lang="ts">
// æ¥æ”¶çˆ¶çµ„ä»¶å‚³ééä¾†çš„åƒæ•¸
defineProps({
  // xlink:href å±¬æ€§å€¼çš„å‰ç¶´
  prefix: {
    type: String,
    default: '#icon-',
  },
  // æä¾›ä½¿ç”¨åœ–æ¨™å
  name: String,
  color: {
    type: String,
    default: '',
  },
  width: {
    type: String,
    default: '16px',
  },
  height: {
    type: String,
    default: '16px',
  },
})
</script>

<template>
  <div>
    <!-- svg: æ˜¯ svg åœ–ç‰‡çš„å¤–å±¤å®¹å™¨ç¯€é»ï¼Œå…§ä¸éœ€è¦æ­é… use æ¨™ç±¤çµåˆä½¿ç”¨ -->
    <svg :style="{ width, height }">
      <!-- xlink:href æŒ‡å®šåŸ·è¡Œå“ªä¸€å€‹åœ–æ¨™å…¶å€¼å‹™å¿…ä»¥ #icon-åœ–æ¨™åç¨±ä½¿ç”¨ -->
      <!-- åœ¨ use ä¸­è¨­ç½® fill å¯ä»¥æ”¹è®Šåœ–æ¨™çš„é¡è‰² -->
      <!-- è¦ fill æ”¹é¡è‰²æœ‰ç”¨è¨˜å¾—å°‡ svg ä¸­çš„ path ä¸èƒ½æœ‰ fill å±¬æ€§ï¼Œé€™é‚Šæ‰æ”¹çš„å‹• -->
      <use :xlink:href="prefix + name" :fill="color"></use>
    </svg>
  </div>
</template>

<style scoped></style>
```

- è‹¥è¦ä½¿ç”¨æ™‚ï¼Œå…ˆå¼•å…¥å†å‚³å…¥æƒ³è¨­å®šçš„åƒæ•¸
- æ­¤æ™‚è‹¥ä¸æƒ³è¦æ¯æ¬¡è¦ä½¿ç”¨æ™‚éƒ½è¦å¦å¤–å¼•å…¥ï¼Œå°±å¯ä»¥å°‡å…¶ä½œç‚ºå…¨åŸŸçµ„ä»¶åœ¨å…¥å£ main.ts è™•æ›è¼‰

```tsx
import { createApp } from 'vue'
import './style.css'
import ElementPlus from 'element-plus' 
import 'element-plus/dist/index.css' 
//@ts-ignore
import zhTw from 'element-plus/dist/locale/zh-tw.mjs' 
import App from '@/App.vue'
// svgæ’ä»¶éœ€è¦é…ç½®ä»£ç 
import 'virtual:svg-icons-register'
import SvgIcon from '@/components/SvgIcon/index.vue'

const app = createApp(App)
app.use(ElementPlus, {
  locale: zhTw,
})
// ä¸€èˆ¬ çµ„ä»¶å…¨å±€æ›è¼‰çš„æ–¹å¼
app.component('SvgIcon', SvgIcon)
app.mount('#app')
```

å¦‚æ­¤åœ¨ä½¿ç”¨æ™‚å°±ä¸ç”¨ç‰¹åˆ¥å¼•å…¥ï¼Œä½†å»¶ä¼¸äº†å¦ä¸€å€‹å•é¡Œï¼Œä½†å•é¡Œæ˜¯ä¸€æ¬¡è¦æ›è¼‰å¾ˆå¤šå…¨åŸŸçµ„ä»¶æ™‚é€™æ¨£æ›¸å¯«å¤ªæ²’æœ‰æ•ˆç‡

å› æ­¤é€™é‚Šæœ‰å¦ä¸€å€‹æ›è¼‰æ–¹å¼: å°‡æ‰€æœ‰å…¨åŸŸçµ„ä»¶åŒ…è£æˆä¸€å€‹æ’ä»¶ï¼Œåœ¨å…¥å£ main.js ä½¿ç”¨ app.use å®‰è£è¨»å†Šï¼Œè©³ç´°å¯«æ³•å¦‚ä¸‹

- åœ¨ **components** è³‡æ–™å¤¾ä¸­å»ºç«‹ **index.ts**
    
    ```tsx
    // è¨»å†Šæˆå…¨åŸŸçµ„ä»¶çš„æ–¹å¼
    import SvgIcon from './SvgIcon/index.vue'
    import Pagination from './Pagination/index.vue'
    
    // æ•´æˆä¸€å€‹å°è±¡
    const allGlobalComponent = { SvgIcon, Pagination }
    
    //  å°å¤–æ›éœ²æ’ä»¶å°è±¡
    export default {
      // å¿…é ˆè¦å« install
      // å…¶åƒæ•¸æœ‰ app é€™åƒæ•¸ï¼Œå…¶å…§å« component é€™æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥ç”¨æ­¤æ–¹æ³•è¨»å†Š
      install(app) {
        // install å…§éƒ¨çš„å‡½å¼æœƒåœ¨å…¥å£ main.ts ä¸­æ›è¼‰ (app.use) æ™‚åŸ·è¡Œ
        console.log(app, 123)
        // é€å€‹è¨»å†Šé …ç›®
        Object.keys(allGlobalComponent).forEach((key) => {
          console.log(key)
          app.component(key, allGlobalComponent[key])
        })
      },
    }
    ```
    
- åœ¨å°ˆæ¡ˆå…¥å£ **main.ts** è¨»å†Šä½¿ç”¨
    
    ```tsx
    //  main.ts
    // å¼•å…¥è‡ªå®šç¾©æ’ä»¶å°è±¡: è¨»å†Šæ•´å€‹é …ç›®çš„å…¨å±€çµ„ä»¶
    import globalComponent from '@/components'
    // å®‰è£è‡ªè¨‚ç¾©æ’ä»¶
    app.use(globalComponent)
    ```
    

### é›†æˆ sass

ç›®å‰æ­¤é …ç›®ç”±æ–¼å‰é¢åœ¨é…ç½® stylelint æ™‚ï¼Œå°±å·²ç¶“å®‰è£é sass çš„å¥—ä»¶ sass, sass-loader

- åœ¨ä½¿ç”¨æ™‚è¨˜å¾—åŠ ä¸Š `lang = 'scss'`

```html
<style scoped lang="scss"></style>
```

- **è¨­ç½®å…¨å±€æ¨£å¼æ–‡ä»¶**
    
    åœ¨ src/styles ç›®éŒ„ä¸‹å‰µå»ºä¸€å€‹ index.scss æ–‡ä»¶ï¼Œç•¶ç„¶é …ç›®ä¸­ä¹Ÿè¦è¨˜å¾—æ¸…é™¤åŸé»˜èªçš„æ¨£å¼è¨­å®šï¼Œå› æ­¤åœ¨ index.scss å¼•å…¥ reset.scss
    
    - åœ¨ main.js å…¥å£æ–‡ä»¶ä¸­å¼•å…¥å…¨å±€æ¨£å¼
        
        ```jsx
        import '@/styles/index.scss'
        ```
        
- **æ¸…é™¤é»˜èªæ¨£å¼** **reset.scss**
    - å»ºç«‹ styles/reset.scss æª”æ¡ˆ
    - åœ¨ npm å®˜ç¶²ä¸­ï¼Œä»¥é—œéµå­— reset.scss å°‹æ‰¾å°æ‡‰å¥—ä»¶ ( **[é€£çµ](https://www.npmjs.com/package/reset.scss?activeTab=code)** ) å¾Œï¼Œåœ¨ code ä¸­æ‰¾åˆ°ä»¥ä¸‹ scss é…ç½®ç¨‹å¼ç¢¼ï¼Œè²¼åˆ°æˆ‘å€‘åœ¨ styles å…§å‰µå»ºå°æ‡‰çš„ reset.scss æª”ä¸­
        - **reset.scss**
            
            ```scss
            /**
             * ENGINE
             * v0.2 | 20150615
             * License: none (public domain)
             */
            
            *,
            *:after,
            *:before {
                box-sizing: border-box;
            
                outline: none;
            }
            
            html,
            body,
            div,
            span,
            applet,
            object,
            iframe,
            h1,
            h2,
            h3,
            h4,
            h5,
            h6,
            p,
            blockquote,
            pre,
            a,
            abbr,
            acronym,
            address,
            big,
            cite,
            code,
            del,
            dfn,
            em,
            img,
            ins,
            kbd,
            q,
            s,
            samp,
            small,
            strike,
            strong,
            sub,
            sup,
            tt,
            var,
            b,
            u,
            i,
            center,
            dl,
            dt,
            dd,
            ol,
            ul,
            li,
            fieldset,
            form,
            label,
            legend,
            table,
            caption,
            tbody,
            tfoot,
            thead,
            tr,
            th,
            td,
            article,
            aside,
            canvas,
            details,
            embed,
            figure,
            figcaption,
            footer,
            header,
            hgroup,
            menu,
            nav,
            output,
            ruby,
            section,
            summary,
            time,
            mark,
            audio,
            video {
                font: inherit;
                font-size: 100%;
            
                margin: 0;
                padding: 0;
            
                vertical-align: baseline;
            
                border: 0;
            }
            
            article,
            aside,
            details,
            figcaption,
            figure,
            footer,
            header,
            hgroup,
            menu,
            nav,
            section {
                display: block;
            }
            
            body {
                line-height: 1;
            }
            
            ol,
            ul {
                list-style: none;
            }
            
            blockquote,
            q {
                quotes: none;
                &:before,
                &:after {
                    content: '';
                    content: none;
                }
            }
            
            sub,
            sup {
                font-size: 75%;
                line-height: 0;
            
                position: relative;
            
                vertical-align: baseline;
            }
            sup {
                top: -.5em;
            }
            sub {
                bottom: -.25em;
            }
            
            table {
                border-spacing: 0;
                border-collapse: collapse;
            }
            
            input,
            textarea,
            button {
                font-family: inhert;
                font-size: inherit;
            
                color: inherit;
            }
            
            select {
                text-indent: .01px;
                text-overflow: '';
            
                border: 0;
                border-radius: 0;
            
                -webkit-appearance: none;
                   -moz-appearance: none;
            }
            select::-ms-expand {
                display: none;
            }
            
            code,
            pre {
                font-family: monospace, monospace;
                font-size: 1em;
            }
            ```
            
    - åœ¨ index.scss ä¸­å¼•å…¥
        
        ```scss
        @import './reset.scss'
        ```
        
- **è¨­ç½®å…¨åŸŸè®Šæ•¸** **variable.scss**
    - é…ç½®åˆ°ä¸Šè¿°éšæ®µï¼Œè‹¥æƒ³è¦ä½¿ç”¨å…¨å±€è®Šé‡ $ï¼Œå°±ç®—ä½ æœ‰åœ¨ index.scss ä¸­è¨­å®šå°æ‡‰ **$è®Šæ•¸**ï¼Œä½ æœƒç™¼ç¾åœ¨å„å…ƒä»¶å¯¦éš›æ’°å¯« scss æ™‚åƒä¸åˆ°è©²å…¨å±€è®Šé‡çš„æ¨£å¼ ( æœƒè·³éŒ¯ )
    - å…ˆå»ºç«‹ styles/**variable.scss**
    - **vite.config.ts** åšä»¥ä¸‹è¨­ç½®
        
        ```tsx
        import { defineConfig } from 'vite'
        import vue from '@vitejs/plugin-vue'
        import path from 'path'
        // https://vitejs.dev/config/
        export default defineConfig({
          plugins: [
            vue(),
            createSvgIconsPlugin({
              // specify the icon folder to be cached
              iconDirs: [path.resolve(process.cwd(), 'src/assets/icons')],
              // specify symbolId format
              symbolId: 'icon-[dir]-[name]',
            }),
          ],
          resolve: { alias: { '@': path.resolve('./src') } },
        	// æ–°å¢ä»¥ä¸‹ scss å…¨å±€è®Šé‡çš„é…ç½®
        	css: {
              preprocessorOptions: {
                scss: {
                  javascriptEnabled: true,
                  additionalData: '@import "./src/styles/variable.scss";',
                },
              },
            },
        })
        ```
        
    

### mock æ•¸æ“š

åœ¨é–‹ç™¼å¾Œå°æ™‚åœ¨é‚„æ²’æœ‰ api æä¾›æ•¸æ“šæ™‚ï¼Œé›£å…éœ€è¦äº›å‡æ•¸æ“šä¾†è¼”åŠ©å‰ç«¯é–‹ç™¼

- **vite-plugin-mock å¥—ä»¶ npm é€£çµ**: [https://www.npmjs.com/package/vite-plugin-mock](https://www.npmjs.com/package/vite-plugin-mock)
- **vite-plugin-mock å¥—ä»¶å®˜ç¶²**:  **[vite-plugin-mock](https://github.com/vbenjs/vite-plugin-mock)**

```bash
yarn add -D vite-plugin-mock@2.9.6 mockjs
```

**è¨»: è‹¥ç›´æ¥ä¸‹  vite-plugin-mock ä¸æŒ‡å®šç‰ˆæœ¬çš„è©±ï¼Œæœƒå› ç‚ºä¸ç›¸å®¹è€Œå ±éŒ¯èª¤ï¼Œä½¿ç”¨ 2.9.6 ç‰ˆæœ¬ç›®å‰ä½¿ç”¨ä¸Šæ²’æœ‰å•é¡Œ**

- åœ¨ vite.config.ts é…ç½®æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹è¨­ç½®ç”¨ä»¥å•Ÿå‹•æ’ä»¶

```tsx
import { ConfigEnv, UserConfigExport, loadEnv } from 'vite'
import { viteMockServe } from 'vite-plugin-mock'

import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [
    vue(),
		viteMockServe({
        localEnabled: command === 'serve',
      }),
  ],
})
```

- åœ¨å°ˆæ¡ˆè·Ÿç›®éŒ„ä¸Šå‰µå»º mock è³‡æ–™å¤¾ï¼Œç”¨ä¾†ä½œç‚º mock æ•¸æ“šå°æ‡‰çš„ä¾†æº
- åœ¨ mock æ–‡ä»¶å¤¾ä¸­å»ºç«‹ä¸€ä»½ user.ts æ–‡ä»¶
    - **user.ts**
        
        ```tsx
        // mock/user.ts
        // ç”¨æˆ¶è¨Šæ¯æ•¸æ“š
        // createUserList: æ­¤å‡½å¼åŸ·è¡Œå›è¿”å›ä¸€å€‹æ•¸çµ„ï¼Œæ•¸çµ„å…§éƒ¨åŒ…å«å…©å€‹ç”¨æˆ¶ä¿¡æ¯
        function createUserList() {
          return [
            {
              userId: 1,
              avatar:
                'https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif',
              username: 'admin',
              password: '123456',
              desc: 'å¹³å°ç®¡ç†å“¡',
              roles: ['å¹³å°ç®¡ç†å“¡'],
              buttons: ['cuser.detail'],
              routes: ['home'],
              token: 'Admin Token',
            },
            {
              userId: 2,
              avatar:
                'https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif',
              username: 'system',
              password: '123456',
              desc: 'ç³»ç»Ÿç®¡ç†å“¡',
              roles: ['ç³»ç»Ÿç®¡ç†å“¡'],
              buttons: ['cuser.detail', 'cuser.user'],
              routes: ['home'],
              token: 'System Token',
            },
          ]
        }
        
        // å°å¤–æš´éœ²ä¸€å€‹æ•¸çµ„ï¼Œæ•¸çµ„å…§éƒ¨åŒ…å«å…©å€‹ api æ¥å£
        // ç™»å…¥å‡çš„ api æ¥å£
        // ç²å–ç”¨æˆ¶ä¿¡æ¯çš„å‡çš„ api æ¥å£
        export default [
          // ç”¨æˆ·ç™»å…¥ api
          {
            url: '/api/user/login', 
            method: 'post', 
            response: ({ body }) => {
        			// ç²å– request body å¸¶éä¾†çš„ç”¨æˆ¶åèˆ‡å¯†ç¢¼
              const { username, password } = body
              // åˆ¤æ–·æ˜¯å¦æœ‰æ­¤ç”¨æˆ¶
              const checkUser = createUserList().find(
                (item) => item.username === username && item.password === password,
              )
              //æ²¡æœ‰è©²ç”¨æˆ·è¿”å›å¤±æ•—ä¿¡æ¯
              if (!checkUser) {
                return { code: 201, data: { message: 'å¸³è™Ÿæˆ–å¯†ç¢¼ä¸æ­£ç¡®' } }
              }
              //å¦‚æœæœ‰è¿”å›æˆåŠŸä¿¡æ¯
              const { token } = checkUser
              return { code: 200, data: { token } }
            },
          },
          // ç²å–ç”¨æˆ¶ä¿¡æ¯ api
          {
            url: '/api/user/info',
            method: 'get',
            response: (request) => {
        			// ç²å– request header ä¸­æ‰€æ”œå¸¶çš„ token
              const token = request.headers.token
              //æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯æ˜¯å¦åŒ…å«æœ‰æ­¤ token çš„ç”¨æˆ·
              const checkUser = createUserList().find((item) => item.token === token)
              //æ²¡æœ‰çš„è©±è¿”å›å¤±æ•—çš„ä¿¡æ¯
              if (!checkUser) {
                return { code: 201, data: { message: 'ç²å–ç”¨æˆ·ä¿¡æ¯å¤±æ•—' } }
              }
              //å¦‚æœæœ‰è¿”å›æˆåŠŸä¿¡æ¯
              return { code: 200, data: { checkUser } }
            },
          },
        ]
        ```
        
- æ¸¬è©¦ç›®å‰ mock è¨­ç½®çš„é‚è¼¯æ˜¯å¦å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œå…ˆå®‰è£ axios
    
    ```tsx
    yarn add axios
    ```
    
- æˆ‘å€‘éš¨æ„åœ¨ main.js ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç¢¼ä¾†æ¸¬è©¦å‡ api æ¥å£çœ‹æ˜¯å¦å¯ç”¨
    
    ```tsx
    // æ¸¬è©¦ä»£ç¢¼ï¼Œç”¨ä¾†æ¸¬è©¦æˆ‘å€‘çš„å‡ api æ¥å£èƒ½å¦ä½¿ç”¨
    import axios from 'axios'
    axios({
      url: '/api/user/login',
      method: 'post',
      data: {
        username: 'admin',
        password: '123456',
      },
    })
    ```
    
    è‹¥æˆ‘å€‘å¾ ç€è¦½å™¨çš„é–‹ç™¼è€…å·¥å…· ( F12 ) ä¸­çš„ Network åˆ†é ä¸­ï¼Œæœ‰çœ‹åˆ°å°æ‡‰çš„ login è«‹æ±‚ç™¼å‡ºä¸”æœ‰æ­£å¸¸è¢«å‡ api æ¥å£å›æ‡‰ï¼Œå°±ä»£è¡¨å‡ api å¯ä»¥æ­£å¸¸é‹ä½œ
    

### axios çš„äºŒæ¬¡å°è£

axios å¯ä»¥ç°¡åŒ–ç¶²è·¯è«‹æ±‚çš„å¯«æ³•ï¼Œè€Œè€ƒé‡åˆ°å…¶å¯¦ç”¨ä»¥åŠè¤‡ç”¨æ€§ï¼Œæˆ‘å€‘å¸¸å°‡ axios åšäºŒæ¬¡å°è£ï¼Œå¥½æ–¹ä¾¿é‡è¤‡ä½¿ç”¨

å°è£çš„å¥½è™•ï¼Œæ–¹ä¾¿åˆ©ç”¨ä»¥ä¸‹å…©å€‹åŠŸèƒ½

1. **è«‹æ±‚æ””æˆªå™¨:** å¯ä»¥åœ¨è«‹æ±‚ç™¼å‡ºå‰æ”¾äº›è™•ç†é‚è¼¯ ( ex: é–‹å§‹é€²åº¦æ¢ã€request headers ä¸­å¡å°æ‡‰çš„å…¬å…±åƒæ•¸å¦‚ token )
2. **éŸ¿æ‡‰æ””æˆªå™¨:** å¯ä»¥åœ¨ api å›æ‡‰æ™‚å¯ä»¥äº‹å…ˆåšäº›è™•ç† ( ex: é€²åº¦æ¢çµæŸã€ç°¡åŒ– & è™•ç†ä¼ºæœå™¨è¿”å›çš„æ•¸æ“šã€è™•ç† http ç¶²è·¯éŒ¯èª¤ )
- **å®‰è£ axios**
    
    ```tsx
    yarn add axios
    ```
    
- åœ¨ **src** ç›®éŒ„ä¸‹å‰µå»º **utils/request.ts**
    - **request.ts**
        
        ```tsx
        // äºŒæ¬¡å°è£… axios: ä½¿ç”¨è«‹æ±‚èˆ‡éŸ¿æ‡‰å¼æ””æˆªå™¨
        import axios from 'axios'
        import { ElMessage } from 'element-plus' // element ä¸­ç”¨ä¾†å‘ˆç¾ api è¨Šæ¯çš„çµ„ä»¶
        // import useUserStore from '@/store/modules/user'
        // ç¬¬ä¸€æ­¥: åˆ©ç”¨ axios å°è±¡çš„ create æ–¹æ³•ï¼Œå»å‰µå»º axios å¯¦ä¾‹å°è±¡
        // å¦‚æ­¤å¯æ–¹ä¾¿äº›åŠŸèƒ½é…ç½® ex: åŸºç¤è·¯å¾‘ã€æ˜¯å¦æœ‰è¶…æ™‚
        const request = axios.create({
          // é…ç½®åŸºç¤è·¯å¾‘
          baseURL: import.meta.env.VITE_APP_BASE_API, // åŸºç¤è·¯å¾‘æœƒå”å¸¶æˆ‘å€‘åœ¨ mock å‰µçš„ '/api'
          timeout: 5000, // è¶…æ™‚çš„æ™‚é–“è¨­ç½® ( é™åˆ¶åœ¨5ç§’å…§éœ€è™•ç†å®Œæˆ )
        })
        
        // ç¬¬äºŒæ­¥: request å¯¦ä¾‹ä¸­æ·»åŠ è«‹æ±‚æ””æˆªå™¨
        // request.interceptors.request.use((config)=>{return config})
        request.interceptors.request.use(
          (config) => {
            // ä½¿ç”¨é…ç½®å°è±¡ config
            // let userStore = useUserStore()
        
            //if (userStore.token) {
            // config çš„ headers å±¬æ€§ï¼Œé€šå¸¸çµ¦ä¼ºæœå™¨çš„å…¬å…±åƒæ•¸å¯åœ¨é€™è¨­ç½®
            //config.headers.token = userStore.token
            //}
        
            return config // å¿…é ˆè¨˜å¾—è¦ return config å›ä¾†ï¼Œå¦å‰‡å¯èƒ½è«‹æ±‚é€£ç™¼éƒ½ç™¼ä¸å‡ºå»
          },
          (error) => {
            return Promise.reject(error)
          },
        )
        
        // ç¬¬ä¸‰æ­¥: request å¯¦ä¾‹ä¸­æ·»åŠ éŸ¿æ‡‰æ””æˆªå™¨
        // response ä¸­è¦æ”¾å…©å€‹ callback åƒæ•¸ ç¬¬ä¸€å€‹æ˜¯æˆåŠŸçš„ï¼Œç¬¬äºŒå€‹æ˜¯å¤±æ•—çš„
        // request.interceptors.response.use((repsone)=>{}, (error)=>{})
        request.interceptors.response.use(
          (response) => {
            // è§£æ & ç°¡åŒ–æ•¸æ“š
            if (response.status === 200) {
              return Promise.resolve(response.data)
            } else {
              return Promise.reject(response.data)
            }
          },
          (error) => {
            // å¤±æ•—çš„ callback é€šå¸¸è™•ç† http ç¶²è·¯éŒ¯èª¤
            // å®šä¸€å€‹è®Šé‡ç”¨ä¾†å­˜å„²ç¶²è·¯éŒ¯èª¤çš„ä¿¡æ¯
            let message = ''
            // http ç‹€æ…‹ç¢¼
            const status = error.response.status
            switch (status) {
              // 401 token éæœŸ
              case 401:
                message = 'token éæœŸ'
                break
              case 403:
                message = 'ç„¡æ¬Šè¨ªå•'
                break
              case 404:
                message = 'è«‹æ±‚åœ°å€éŒ¯èª¤'
                break
              case 500:
                message = 'ä¼ºæœå™¨å‡ºç¾å•é¡Œ'
                break
              default:
                message = 'ç¶²è·¯å‡ºç¾å•é¡Œ'
                // message = error.response.data.message
                break
            }
            // æç¤ºçš„éŒ¯èª¤ä¿¡æ¯ ( é€™é‚Šä½¿ç”¨ element plus çš„å¥—ä»¶ )
            ElMessage({
              type: 'error',
              message,
            })
            // éœ€ return å¤±æ•—çš„ Promise ä¾†çµ‚çµæ­¤ promise
            return Promise.reject(error)
          },
        )
        // å°å¤–æš´éœ²
        export default request
        ```
        
        **è¨»: æˆ‘å€‘å°è£çš„ axios å¯¦ä¾‹ request å¯¦éš›ä¸Šå…¶èˆ‡ axios æ˜¯ç›¸åŒçš„åŠŸèƒ½ä¹Ÿç›¸åŒï¼Œå·®åˆ¥åœ¨æ–¼ request ä¸­æœ‰æˆ‘å€‘é å…ˆè¨­å®šçš„æ””æˆªå™¨ï¼Œæ–¹ä¾¿æˆ‘å€‘é‡å° request èˆ‡ response é å…ˆåšè™•ç†**
        
- å¯¦éš›ä½¿ç”¨ & é©—è­‰æ˜¯å¦å¯ç”¨çš„ç¯„ä¾‹ç¨‹å¼ç¢¼
    - **xxx.vue**
        
        ```tsx
        <script setup lang="ts">
        import request from '@/utils/request'
        import { onMounted } from 'vue'
        
        onMounted(() => {
          request({
            url: '/user/login',
            method: 'post',
            data: {
              username: 'admin',
              password: '123456',
            },
          }).then((res) => {
            console.log(res)
          })
        })
        </script>
        
        <template>
          <div>
            <h2>æ¸¬è©¦axiosäºŒæ¬¡å°è£</h2>
          </div>
        </template>
        ```
        

### API æ¥å£é‚è¼¯çµ±ä¸€ç®¡ç†

å°‡å„ç¨® api é€£æ¥é‚è¼¯çµ±ä¸€ç®¡ç†

å‰µå»º src/api è³‡æ–™å¤¾ä½œç‚ºçµ±ä¸€ç®¡ç†çš„æ‰€åœ¨

```
#æ•™å­¸ä¸­ä½¿ç”¨çš„åˆ†é¡é‚è¼¯
user #æ”¾ç½®èˆ‡ç”¨æˆ¶ç›¸é—œçš„ api é‚è¼¯
product # æ”¾ç½®èˆ‡ç”¢å“ç›¸é—œçš„ api é‚è¼¯
acl # æ”¾ç½®æ¬Šé™ç®¡ç† api é‚è¼¯
```

- å‰µå»º src/api/user/index.ts ä»¥åŠ src/api/user/type.ts æ­¤å…©è€…æ–‡ä»¶ï¼Œindex.ts ç”¨ä¾†å®šç¾© api é‚è¼¯ï¼Œè€Œ type.ts å‰‡æ˜¯å®šç¾© index.ts ä¸­æœ‰ç”¨åˆ°çš„å‹åˆ¥é¡å‹
- **src/api/user/index.ts**
    
    ```tsx
    // çµ±ä¸€ç®¡ç†ç”¨æˆ¶ç›¸é—œçš„ api é‚è¼¯
    import request from '@/utils/request'
    import type { loginForm, loginResponseData, userResponseData } from './type'
    // import type ç›¸è¼ƒæ–¼ import åªæœƒå¸¶å…¥é¡å‹ä¿¡æ¯ï¼Œç›¸è¼ƒæ–¼ä½¿ç”¨ import, import type å¯ä»¥å¸¶ä¾†æ›´å¥½çš„æ€§èƒ½èˆ‡ç¶­è­·æ€§
    // çµ±ä¸€ç®¡ç†æ¥å£
    enum API {
      LOGIN_URL = '/user/login',
      USERINFO_URL = '/user/info',
    }
    // æš´éœ²è«‹æ±‚å‡½å¼
    // ç™»å…¥ API æ–¹æ³•
    export const reqLogin = (data: loginForm) =>
      request.post<any, loginResponseData>(API.LOGIN_URL, data)
    // ç²å–ç”¨æˆ¶ä¿¡æ¯ api æ–¹æ³•
    export const reqUserInfo = () =>
      request.get<any, userResponseData>(API.USERINFO_URL)
    ```
    
- **src/api/user/type.ts**
    
    ```tsx
    // ç”¨æˆ¶ç›¸é—œçš„ api é‚è¼¯å‹åˆ¥è²æ˜
    // ç™»å…¥ API é‚è¼¯å‹åˆ¥
    export interface loginForm {
      username: string
      password: string
    }
    interface dataType {
      token: string
    }
    
    // ç™»å…¥ api response çš„æ•¸æ“šå‹åˆ¥
    export interface loginResponseData {
      code: number
      data: dataType
    }
    
    // å®šç¾©ä¼ºæœå™¨å›å‚³èˆ‡ç”¨æˆ¶ç›¸é—œçš„æ•¸æ“šé¡å‹
    interface userInfo {
      userId: number
      avatar: string
      username: string
      password: string
      desc: string
      roles: string[]
      buttons: string[]
      routes: string[]
      token: string
    }
    
    interface user {
      checkUser: userInfo
    }
    
    export interface userResponseData {
      code: number
      data: user
    }
    ```
    
- å¯¦éš›ä½¿ç”¨ & é©—è­‰æ˜¯å¦å¯ç”¨çš„ç¯„ä¾‹ç¨‹å¼ç¢¼
    - **xxx.vue**
        
        ```tsx
        <script setup lang="ts">
        import { onMounted } from 'vue'
        import { reqLogin } from './api/user'
        
        onMounted(() => {
          reqLogin({ username: 'admin', password: '123456' })
        })
        </script>
        
        <template>
          <div>
            <h2>æ¸¬è©¦axiosäºŒæ¬¡å°è£</h2>
          </div>
        </template>
        ```
        
        ä½¿ç”¨ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·è§€å¯Ÿï¼Œå°±èƒ½é©—è­‰æ˜¯å¦è©² api æœ‰æ­£ç¢ºæ‰“å‡º
        
    

### æ¨¡æ¿å¸¸è¦‹è·¯ç”±é…ç½®

ä»¥ä¸‹æ˜¯æ¨¡æ¿å¸¸è¦‹çš„è·¯ç”±é…ç½®

```tsx
# login ç™»å…¥
# dashboard å±•ç¤º
# 404 é é¢
# ä»»æ„è·¯ç”±
```

- å®‰è£
    
    ```bash
    yarn add vue-router
    ```
    
- åœ¨ src ç›®éŒ„ä¸­æ–°å»º **views** è³‡æ–™å¤¾
- å»ºç«‹è·¯ç”±é è¨ˆæœƒå°æ‡‰åˆ°åˆ°çš„ vue é é¢
    
    ```
    # login ç™»å…¥ => src/views/login/index.vue
    # dashboard å±•ç¤º => src/views/home/index.vue
    # 404 é é¢  => src/views/404/index.vue
    # ä»»æ„è·¯ç”± => src/views/404/index.vue
    ```
    
- åœ¨ src ç›®éŒ„ä¸­æ–°å»º router è³‡æ–™å¤¾
    - å»ºç«‹ **src/router/index.ts**
        
        ```tsx
        // åˆ©ç”¨ vue-router å¥—ä»¶ä¾†å¯¦ç¾æ¨¡æ¿è·¯ç”±é…ç½®
        // createWebHashHistory å°æ‡‰ è·¯ç”±æ¨¡å¼ hash
        // createWebHistory å°æ‡‰ è·¯ç”±æ¨¡å¼ history
        import { createRouter, createWebHashHistory } from 'vue-router'
        import { constantRoute } from './routes'
        // å‰µå»ºè·¯ç”±å™¨
        const router = createRouter({
          // è·¯ç”±æ¨¡å¼ hash æˆ–æ˜¯ history
          history: createWebHashHistory(),
          routes: constantRoute,
          // æ»¾å‹•è¡Œç‚º
          scrollBehavior() {
            return {
              left: 0,
              top: 0,
            }
          },
        })
        
        export default router
        ```
        
    - å»ºç«‹ **src/router/routes.ts**
        
        ```tsx
        // å°å¤–æš´éœ²çš„é…ç½®è·¯ç”± ( å¸¸é‡è·¯ç”± )
        
        export const constantRoute = [
          {
            // ç™»å…¥
            path: '/login',
            component: () => import('@/views/login/index.vue'),
            name: 'login', //å‘½åè·¯ç”±
          },
          {
            // ç™»å…¥æˆåŠŸå¾Œçš„ dashboard
            path: '/',
            component: () => import('@/views/home/index.vue'),
            name: 'home', //å‘½åè·¯ç”±
          },
          {
            // 404
            path: '/404',
            component: () => import('@/views/404/index.vue'),
            name: '404', //å‘½åè·¯ç”±
          },
          {
            // ä»»æ„è·¯ç”±
            path: '/:pathMatch(.*)*',
            redirect: '/404',
            name: 'Any', //å‘½åè·¯ç”±
          },
        ]
        ```
        
    - åœ¨ App.vue ä¸­æ”¾å…¥ router-view çµ„ä»¶
        
        ```tsx
        <template>
          <div>
            <h1>æˆ‘æ˜¯ APP æ ¹çµ„ä»¶</h1>
            <router-view></router-view>
          </div>
        </template>
        ```
        